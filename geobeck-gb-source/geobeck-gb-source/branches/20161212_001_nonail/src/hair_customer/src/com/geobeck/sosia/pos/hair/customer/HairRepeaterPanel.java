/*
 * HairRepeaterPanel.java
 *
 * Created on 2007/03/29, 9:09
 */

package com.geobeck.sosia.pos.hair.customer;

import java.util.*;
import java.util.logging.*;
import javax.swing.*;
import javax.swing.table.*;

import com.geobeck.swing.*;
import com.geobeck.util.*;
import com.geobeck.sosia.pos.mail.*;
import com.geobeck.sosia.pos.master.company.*;
import com.geobeck.sosia.pos.master.customer.*;
import com.geobeck.sosia.pos.hair.mail.*;
import com.geobeck.sosia.pos.system.*;
import com.geobeck.sosia.pos.swing.*;
import com.geobeck.sosia.pos.util.*;

/**
 *
 * @author  katagiri
 */
public class HairRepeaterPanel extends com.geobeck.sosia.pos.swing.AbstractImagePanelEx implements SelectMailAddressDialogOpener
{
	
	/** Creates new form HairRepeaterPanel */
	public HairRepeaterPanel()
	{
		initComponents();
		this.init();
	}
	
	/** This method is called from within the constructor to
	 * initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is
	 * always regenerated by the Form Editor.
	 */
        // <editor-fold defaultstate="collapsed" desc=" Generated Code">//GEN-BEGIN:initComponents
        private void initComponents() {
                repeaterButtonGroup = new javax.swing.ButtonGroup();
                jPanel1 = new javax.swing.JPanel();
                shopLabel = new javax.swing.JLabel();
                target = new com.geobeck.sosia.pos.swing.JComboBoxLabel();
                targetLabel = new javax.swing.JLabel();
                repeater = new javax.swing.JRadioButton();
                notRepeater = new javax.swing.JRadioButton();
                termtLabe = new javax.swing.JLabel();
                termFrom = new jp.co.flatsoft.fscomponent.FSCalenderCombo();
                termtLabe1 = new javax.swing.JLabel();
                termTo = new jp.co.flatsoft.fscomponent.FSCalenderCombo();
                termtLabe2 = new javax.swing.JLabel();
                totalTo = new jp.co.flatsoft.fscomponent.FSCalenderCombo();
                termtLabe3 = new javax.swing.JLabel();
                totalFrom = new jp.co.flatsoft.fscomponent.FSCalenderCombo();
                jScrollPane1 = new javax.swing.JScrollPane();
                repeaterList = new javax.swing.JTable();
                jPanel2 = new javax.swing.JPanel();
                searchButton = new javax.swing.JButton();
                btnOutput = new javax.swing.JButton();
                mailButton = new javax.swing.JButton();
                jPanel4 = new javax.swing.JPanel();
                selectAllButton0 = new javax.swing.JButton();
                releaseAllButton0 = new javax.swing.JButton();
                jPanel3 = new javax.swing.JPanel();
                jLabel1 = new javax.swing.JLabel();
                jLabel2 = new javax.swing.JLabel();

                jPanel1.setOpaque(false);
                shopLabel.setText("\u5e97\u8217");

                target.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));

                targetLabel.setText("\u5bfe\u8c61\u9867\u5ba2");

                repeaterButtonGroup.add(repeater);
                repeater.setText("\u518d\u6765\u5e97\u8005");
                repeater.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 0, 0, 0));
                repeater.setMargin(new java.awt.Insets(0, 0, 0, 0));
                repeater.setOpaque(false);

                repeaterButtonGroup.add(notRepeater);
                notRepeater.setSelected(true);
                notRepeater.setText("\u5931\u5ba2\u5019\u88dc\u8005");
                notRepeater.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 0, 0, 0));
                notRepeater.setMargin(new java.awt.Insets(0, 0, 0, 0));
                notRepeater.setOpaque(false);

                termtLabe.setText("\u5bfe\u8c61\u671f\u9593");

                termFrom.setDate(new java.util.Date());
                termFrom.addItemListener(new java.awt.event.ItemListener() {
                        public void itemStateChanged(java.awt.event.ItemEvent evt) {
                                termFromItemStateChanged(evt);
                        }
                });

                termtLabe1.setText("\uff5e");

                termTo.setDate(new java.util.Date());

                termtLabe2.setText("\u96c6\u8a08\u671f\u9593");

                totalTo.setDate(new java.util.Date());

                termtLabe3.setText("\uff5e");

                totalFrom.setEnabled(false);
                totalFrom.setDate(new java.util.Date());

                org.jdesktop.layout.GroupLayout jPanel1Layout = new org.jdesktop.layout.GroupLayout(jPanel1);
                jPanel1.setLayout(jPanel1Layout);
                jPanel1Layout.setHorizontalGroup(
                        jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                        .add(jPanel1Layout.createSequentialGroup()
                                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                                        .add(jPanel1Layout.createSequentialGroup()
                                                .add(shopLabel, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 70, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                                .add(target, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 305, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                                        .add(jPanel1Layout.createSequentialGroup()
                                                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                                                        .add(jPanel1Layout.createSequentialGroup()
                                                                .add(targetLabel, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 70, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                                                .add(notRepeater, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 100, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                                                        .add(jPanel1Layout.createSequentialGroup()
                                                                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING, false)
                                                                        .add(jPanel1Layout.createSequentialGroup()
                                                                                .add(termtLabe, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 70, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                                                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                                                                .add(termFrom, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                                                                        .add(jPanel1Layout.createSequentialGroup()
                                                                                .add(termtLabe2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 70, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                                                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                                                                .add(totalFrom, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
                                                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                                                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                                                                        .add(termtLabe3)
                                                                        .add(termtLabe1))))
                                                .add(7, 7, 7)
                                                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                                                        .add(termTo, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                                        .add(totalTo, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                                        .add(repeater, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 100, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))))
                                .addContainerGap(21, Short.MAX_VALUE))
                );
                jPanel1Layout.setVerticalGroup(
                        jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                        .add(jPanel1Layout.createSequentialGroup()
                                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                                        .add(shopLabel)
                                        .add(target, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                                        .add(targetLabel)
                                        .add(notRepeater)
                                        .add(repeater))
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING, false)
                                        .add(termtLabe, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 19, Short.MAX_VALUE)
                                        .add(termFrom, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 19, Short.MAX_VALUE)
                                        .add(termtLabe1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .add(termTo, 0, 19, Short.MAX_VALUE))
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                                        .add(org.jdesktop.layout.GroupLayout.TRAILING, jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                                                .add(termtLabe2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 19, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                                .add(termtLabe3, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                                        .add(org.jdesktop.layout.GroupLayout.TRAILING, totalTo, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 19, Short.MAX_VALUE)
                                        .add(totalFrom, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 19, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                                .addContainerGap())
                );

                repeaterList.setModel(new javax.swing.table.DefaultTableModel(
                        new Object [][] {

                        },
                        new String [] {
                                "前回来店日付", "再来店日付", "顧客No.", "氏名", "来店回数", "前回来店時売上", "ﾒｰﾙｱﾄﾞﾚｽ有無", "送信対象"
                        }
                ) {
                        Class[] types = new Class [] {
                                java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.Integer.class, java.lang.Object.class, java.lang.Boolean.class, java.lang.Boolean.class
                        };
                        boolean[] canEdit = new boolean [] {
                                false, false, false, false, false, false, false, true
                        };

                        public Class getColumnClass(int columnIndex) {
                                return types [columnIndex];
                        }

                        public boolean isCellEditable(int rowIndex, int columnIndex) {
                                return canEdit [columnIndex];
                        }
                });
                repeaterList.setRowSelectionAllowed(false);
                repeaterList.getTableHeader().setReorderingAllowed(false);
                repeaterList.setRowHeight(SystemInfo.TABLE_ROW_HEIGHT);
                SwingUtil.setJTableHeaderRenderer(repeaterList, SystemInfo.getTableHeaderRenderer());
                SelectTableCellRenderer.setSelectTableCellRenderer(repeaterList);
                jScrollPane1.setViewportView(repeaterList);

                jPanel2.setOpaque(false);
                searchButton.setIcon(SystemInfo.getImageIcon("/button/search/search_off.jpg"));
                searchButton.setBorderPainted(false);
                searchButton.setContentAreaFilled(false);
                searchButton.setPressedIcon(SystemInfo.getImageIcon("/button/search/search_on.jpg"));
                searchButton.addActionListener(new java.awt.event.ActionListener() {
                        public void actionPerformed(java.awt.event.ActionEvent evt) {
                                searchButtonActionPerformed(evt);
                        }
                });

                btnOutput.setIcon(SystemInfo.getImageIcon("/button/print/output_pdf_off.jpg"));
                btnOutput.setBorderPainted(false);
                btnOutput.setContentAreaFilled(false);
                btnOutput.setPressedIcon(SystemInfo.getImageIcon("/button/print/output_pdf_on.jpg"));
                btnOutput.addActionListener(new java.awt.event.ActionListener() {
                        public void actionPerformed(java.awt.event.ActionEvent evt) {
                                btnOutputActionPerformed(evt);
                        }
                });

                mailButton.setIcon(SystemInfo.getImageIcon("/button/mail/create_mail_off.jpg"));
                mailButton.setBorderPainted(false);
                mailButton.setContentAreaFilled(false);
                mailButton.setPressedIcon(SystemInfo.getImageIcon("/button/mail/create_mail_on.jpg"));
                mailButton.addActionListener(new java.awt.event.ActionListener() {
                        public void actionPerformed(java.awt.event.ActionEvent evt) {
                                mailButtonActionPerformed(evt);
                        }
                });

                org.jdesktop.layout.GroupLayout jPanel2Layout = new org.jdesktop.layout.GroupLayout(jPanel2);
                jPanel2.setLayout(jPanel2Layout);
                jPanel2Layout.setHorizontalGroup(
                        jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                        .add(org.jdesktop.layout.GroupLayout.TRAILING, jPanel2Layout.createSequentialGroup()
                                .add(searchButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 92, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(btnOutput, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 92, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(mailButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 92, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                );
                jPanel2Layout.setVerticalGroup(
                        jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                        .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                                .add(mailButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                .add(btnOutput, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                .add(searchButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                );

                jPanel4.setOpaque(false);
                selectAllButton0.setIcon(SystemInfo.getImageIcon("/button/select/select_all_off.jpg"));
                selectAllButton0.setBorderPainted(false);
                selectAllButton0.setContentAreaFilled(false);
                selectAllButton0.setPressedIcon(SystemInfo.getImageIcon("/button/select/select_all_on.jpg"));
                selectAllButton0.addActionListener(new java.awt.event.ActionListener() {
                        public void actionPerformed(java.awt.event.ActionEvent evt) {
                                selectAllButton0ActionPerformed(evt);
                        }
                });

                releaseAllButton0.setIcon(SystemInfo.getImageIcon("/button/select/release_all_off.jpg"));
                releaseAllButton0.setBorderPainted(false);
                releaseAllButton0.setContentAreaFilled(false);
                releaseAllButton0.setPressedIcon(SystemInfo.getImageIcon("/button/select/release_all_on.jpg"));
                releaseAllButton0.addActionListener(new java.awt.event.ActionListener() {
                        public void actionPerformed(java.awt.event.ActionEvent evt) {
                                releaseAllButton0ActionPerformed(evt);
                        }
                });

                org.jdesktop.layout.GroupLayout jPanel4Layout = new org.jdesktop.layout.GroupLayout(jPanel4);
                jPanel4.setLayout(jPanel4Layout);
                jPanel4Layout.setHorizontalGroup(
                        jPanel4Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                        .add(org.jdesktop.layout.GroupLayout.TRAILING, jPanel4Layout.createSequentialGroup()
                                .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .add(selectAllButton0, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 92, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(releaseAllButton0, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 92, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                );
                jPanel4Layout.setVerticalGroup(
                        jPanel4Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                        .add(jPanel4Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                                .add(releaseAllButton0, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                .add(selectAllButton0, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                );

                jPanel3.setOpaque(false);
                jLabel1.setText("\u203b\u518d\u6765\u5e97\u8005\u3000 \uff1a\u8a2d\u5b9a\u3057\u305f\u5bfe\u8c61\u671f\u9593\u5185\u306b\u6765\u5e97\u3055\u308c\u3001\u96c6\u8a08\u671f\u9593\u306b\u518d\u5ea6\u6765\u5e97\u3055\u308c\u305f\u304a\u5ba2\u69d8");

                jLabel2.setText("\u203b\u5931\u5ba2\u5019\u88dc\u8005\uff1a\u8a2d\u5b9a\u3057\u305f\u5bfe\u8c61\u671f\u9593\u5185\u306b\u6765\u5e97\u3055\u308c\u3001\u96c6\u8a08\u671f\u9593\u306b\u518d\u5ea6\u6765\u5e97\u3055\u308c\u3066\u3044\u306a\u3044\u304a\u5ba2\u69d8");

                org.jdesktop.layout.GroupLayout jPanel3Layout = new org.jdesktop.layout.GroupLayout(jPanel3);
                jPanel3.setLayout(jPanel3Layout);
                jPanel3Layout.setHorizontalGroup(
                        jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                        .add(jPanel3Layout.createSequentialGroup()
                                .addContainerGap()
                                .add(jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                                        .add(jLabel1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 552, Short.MAX_VALUE)
                                        .add(jLabel2))
                                .addContainerGap())
                );
                jPanel3Layout.setVerticalGroup(
                        jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                        .add(org.jdesktop.layout.GroupLayout.TRAILING, jPanel3Layout.createSequentialGroup()
                                .add(jLabel2, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 19, Short.MAX_VALUE)
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(jLabel1)
                                .addContainerGap())
                );

                org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(this);
                this.setLayout(layout);
                layout.setHorizontalGroup(
                        layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                        .add(layout.createSequentialGroup()
                                .addContainerGap()
                                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                                        .add(jScrollPane1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 809, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                        .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
                                                .add(jPanel3, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 30, Short.MAX_VALUE)
                                                .add(jPanel4, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                                        .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
                                                .add(jPanel1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 118, Short.MAX_VALUE)
                                                .add(jPanel2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
                                .addContainerGap())
                );
                layout.setVerticalGroup(
                        layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                        .add(layout.createSequentialGroup()
                                .addContainerGap()
                                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                                        .add(jPanel2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                        .add(jPanel1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                                        .add(jPanel4, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                        .add(jPanel3, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 514, Short.MAX_VALUE)
                                .addContainerGap())
                );
        }// </editor-fold>//GEN-END:initComponents

    private void termFromItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_termFromItemStateChanged
        totalFrom.setDate(termFrom.getDate());
    }//GEN-LAST:event_termFromItemStateChanged

	private void mailButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_mailButtonActionPerformed
	{//GEN-HEADEREND:event_mailButtonActionPerformed
		this.sendMail();
	}//GEN-LAST:event_mailButtonActionPerformed

	private void selectAllButton0ActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_selectAllButton0ActionPerformed
	{//GEN-HEADEREND:event_selectAllButton0ActionPerformed
		this.changeSelectAll(true);
	}//GEN-LAST:event_selectAllButton0ActionPerformed

	private void releaseAllButton0ActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_releaseAllButton0ActionPerformed
	{//GEN-HEADEREND:event_releaseAllButton0ActionPerformed
		this.changeSelectAll(false);
	}//GEN-LAST:event_releaseAllButton0ActionPerformed

	private void btnOutputActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_btnOutputActionPerformed
	{//GEN-HEADEREND:event_btnOutputActionPerformed
		this.print();
	}//GEN-LAST:event_btnOutputActionPerformed

	private void searchButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_searchButtonActionPerformed
	{//GEN-HEADEREND:event_searchButtonActionPerformed
		this.search();
	}//GEN-LAST:event_searchButtonActionPerformed
	
	
        // Variables declaration - do not modify//GEN-BEGIN:variables
        private javax.swing.JButton btnOutput;
        private javax.swing.JLabel jLabel1;
        private javax.swing.JLabel jLabel2;
        private javax.swing.JPanel jPanel1;
        private javax.swing.JPanel jPanel2;
        private javax.swing.JPanel jPanel3;
        private javax.swing.JPanel jPanel4;
        private javax.swing.JScrollPane jScrollPane1;
        private javax.swing.JButton mailButton;
        private javax.swing.JRadioButton notRepeater;
        private javax.swing.JButton releaseAllButton0;
        private javax.swing.JRadioButton repeater;
        private javax.swing.ButtonGroup repeaterButtonGroup;
        private javax.swing.JTable repeaterList;
        private javax.swing.JButton searchButton;
        private javax.swing.JButton selectAllButton0;
        private javax.swing.JLabel shopLabel;
        private com.geobeck.sosia.pos.swing.JComboBoxLabel target;
        private javax.swing.JLabel targetLabel;
        private jp.co.flatsoft.fscomponent.FSCalenderCombo termFrom;
        private jp.co.flatsoft.fscomponent.FSCalenderCombo termTo;
        private javax.swing.JLabel termtLabe;
        private javax.swing.JLabel termtLabe1;
        private javax.swing.JLabel termtLabe2;
        private javax.swing.JLabel termtLabe3;
        private jp.co.flatsoft.fscomponent.FSCalenderCombo totalFrom;
        private jp.co.flatsoft.fscomponent.FSCalenderCombo totalTo;
        // End of variables declaration//GEN-END:variables
	
	private	HairRepeaterManager		rm		=	new HairRepeaterManager();
	
	private	Integer selectedAddress					=	-1;
	
	public void setSelectedAddress(Integer selectedAddress)
	{
		this.selectedAddress	=	selectedAddress;
	}
	
	private void init()
	{
		this.setSize(833, 691);
		this.setPath("顧客管理");
		this.setTitle("再来状況");
		SystemInfo.initGroupShopComponents(target, 3);
	}
	
	private void search()
	{
		if(!this.checkInput())
		{
			return;
		}
		
		this.setData();
		
		rm.load();
		
		this.showData();
	}
	
	private boolean checkInput()
	{
		if(!termFrom.isSelected())
		{
			return	false;
		}
		
		if(!termTo.isSelected())
		{
			return	false;
		}
		
		if(0 < termFrom.getDateStr().compareTo(termTo.getDateStr()))
		{
			return	false;
		}
                
		if(!totalFrom.isSelected())
		{
			return	false;
		}	
                
		if(!totalTo.isSelected())
		{
			return	false;
		}
 		
		if(0 < totalFrom.getDateStr().compareTo(totalTo.getDateStr()))
		{
			return	false;
		}
                
		return	true;
	}
	
	private void setData()
	{
		if(target.getSelectedItem() instanceof MstGroup)
		{
			MstGroup	mg	=	(MstGroup)target.getSelectedItem();
			rm.setTargetName(mg.getGroupName());
			rm.setTargetList(mg.getShopIDListAll());
		}
		else
		{
			MstShop		ms	=	(MstShop)target.getSelectedItem();
			rm.setTargetName(ms.getShopName());
			rm.setTargetList(ms.getShopID().toString());
		}
		
		rm.setRepeater(repeater.isSelected());
		
		rm.setTermFrom(DateUtil.dateToGregorianCalendar(termFrom.getDate()));
		rm.setTermTo(DateUtil.dateToGregorianCalendar(termTo.getDate()));
                rm.setTotalFrom(DateUtil.dateToGregorianCalendar(totalFrom.getDate()));
                rm.setTotalTo(DateUtil.dateToGregorianCalendar(totalTo.getDate()));
	}
	
	private void showData()
	{
		SwingUtil.clearTable(repeaterList);
		
		DefaultTableModel	model	=	(DefaultTableModel)repeaterList.getModel();
		
		for(HairRepeaterData rd : rm)
		{
			Vector<Object>	temp	=	new Vector<Object>();
			
			temp.add(rd.getSalesDateString());
			temp.add(rd.getRepeatDateString());
			temp.add(rd.getCustomerNo());
			temp.add(rd.getFullCustomerName());
			temp.add(rd.getVisitNum());
			temp.add(rd.getSalesValue());
			temp.add(rd.isInputMailAddress());
			temp.add(rd.isSelected());
			
			model.addRow(temp);
		}
	}
	
	private void print()
	{
		if(0 < repeaterList.getRowCount())
		{
			rm.print();
		}
	}
	
	private void sendMail()
	{
		if(0 < repeaterList.getRowCount())
		{
			// 送信メール対象が0件の場合にはエラー表示
			if( getSendMailNum() == 0 )
			{
				// 『送信対象が選択されていません』
				MessageDialog.showMessageDialog(this,
						MessageUtil.getMessage(1102, "送信対象"),
						this.getTitle(),
						JOptionPane.ERROR_MESSAGE);
				return;
			}
			
			SelectMailAddressDialog	smad	=	new SelectMailAddressDialog(
					parentFrame, true, this);
			smad.setVisible(true);
			
			if(selectedAddress == -1)
			{
				return;
			}
			
			ArrayList<MstCustomer> customers	=	rm.getSelectedCustomers(selectedAddress);
			
			if(customers.size() == 0)
			{
				return;
			}
			
			SystemInfo.getLogger().log(Level.INFO, "メール作成");
			HairCommonMailPanel hcmp = new HairCommonMailPanel(target.getSelectedItem(), customers);
			hcmp.setOpener(this);
			this.setVisible(false);
			parentFrame.changeContents(hcmp);
		}
		else
		{
			// 『対象データが存在しません』
			MessageDialog.showMessageDialog(this,
					MessageUtil.getMessage(1112, "送信対象"),
					this.getTitle(),
					JOptionPane.ERROR_MESSAGE);
		}
	}
	
	private int getSendMailNum()
	{
		int num = 0;
		
		for(int row = 0; row < repeaterList.getRowCount(); row ++)
		{
			if( (Boolean)repeaterList.getValueAt(row,7) ) 
			{
				num++;
				rm.get(row).setSelected(true);
			}
			else
			{
				rm.get(row).setSelected(false);
			}
		}
		
		return num;
	}
	
	private void changeSelectAll(boolean isSelect)
	{
		for(HairRepeaterData rd : rm)
		{
			rd.setSelected(isSelect);
		}
		
		for(int row = 0; row < repeaterList.getRowCount(); row ++)
		{
			repeaterList.setValueAt(isSelect, row, 7);
		}
	}
}
