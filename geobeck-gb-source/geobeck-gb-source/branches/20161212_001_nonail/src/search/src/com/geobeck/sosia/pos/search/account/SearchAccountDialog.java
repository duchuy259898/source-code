/*
 * SearchAccountDialog.java
 *
 * Created on 2006/05/08, 15:59
 */

package com.geobeck.sosia.pos.search.account;

import com.geobeck.sosia.pos.data.account.DataSales;
import com.geobeck.sosia.pos.master.account.MstPaymentClass;
import com.geobeck.sosia.pos.system.SystemInfo;
import java.awt.*;
import java.awt.event.*;
import javax.swing.*;
import javax.swing.event.*;
import javax.swing.table.*;
import javax.swing.text.*;
import java.sql.*;
import java.util.*;
import java.util.logging.*;

import com.geobeck.sql.*;
import com.geobeck.swing.*;
import com.geobeck.util.*;
import com.geobeck.sosia.pos.master.*;
import com.geobeck.sosia.pos.master.company.*;
import com.geobeck.sosia.pos.search.*;
import com.geobeck.sosia.pos.swing.*;
import com.geobeck.sosia.pos.swing.company.*;
import com.geobeck.sosia.pos.util.*;

/**
 * 伝票検索画面
 * @author katagiri
 */
public class SearchAccountDialog extends javax.swing.JDialog
{
	/**
	 * テーブルの幅の最小値
	 */
	private final int	TABLE_WIDTH_MIN		=	440;
	
	/**
	 * コンストラクタ
	 * @param parent 
	 * @param modal 
	 */
	public SearchAccountDialog(java.awt.Frame parent, boolean modal)
	{
		super(parent, modal);
		this.init();
		initComponents();
		SystemInfo.initGroupShopComponents(shop, 2);
		sa.setShop((MstShop)shop.getSelectedItem());
		addMouseCursorChange();
		this.initStaff();
		this.setListener();
		SwingUtil.moveCenter(this);
	}
	/**
	 * コンストラクタ
	 * @param parent 
	 * @param modal 
	 */
	public SearchAccountDialog(java.awt.Dialog parent, boolean modal)
	{
		super(parent, modal);
		this.init();
		initComponents();
		addMouseCursorChange();
		this.setListener();
		SwingUtil.moveCenter(this);
		
	}
	
	/** This method is called from within the constructor to
	 * initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is
	 * always regenerated by the Form Editor.
	 */
    // <editor-fold defaultstate="collapsed" desc=" Generated Code">//GEN-BEGIN:initComponents
    private void initComponents()
    {
        backPanel = new com.geobeck.swing.ImagePanel();
        selectButton = new javax.swing.JButton();
        salesDateLabel = new javax.swing.JLabel();
        slipNoLabel = new javax.swing.JLabel();
        customerIDLabel = new javax.swing.JLabel();
        toLabel1 = new javax.swing.JLabel();
        slipNo1 = new com.geobeck.swing.JFormattedTextFieldEx();
        ((PlainDocument)slipNo1.getDocument()).setDocumentFilter(
            new CustomFilter(9, CustomFilter.NUMERIC));
        toLabel2 = new javax.swing.JLabel();
        slipNo2 = new com.geobeck.swing.JFormattedTextFieldEx();
        ((PlainDocument)slipNo2.getDocument()).setDocumentFilter(
            new CustomFilter(9, CustomFilter.NUMERIC));
        customerNo1 = new com.geobeck.swing.JFormattedTextFieldEx();
        ((PlainDocument)customerNo1.getDocument()).setDocumentFilter(
            new CustomFilter(15, CustomFilter.ALPHAMERIC));
        toLabel3 = new javax.swing.JLabel();
        customerNo2 = new com.geobeck.swing.JFormattedTextFieldEx();
        ((PlainDocument)customerNo2.getDocument()).setDocumentFilter(
            new CustomFilter(15, CustomFilter.ALPHAMERIC));
        staffLabel = new javax.swing.JLabel();
        paymentClassLabel = new javax.swing.JLabel();
        searchButton = new javax.swing.JButton();
        accountsScrollPane = new javax.swing.JScrollPane();
        searchResult = new javax.swing.JTable();
        salesDate1 = new jp.co.flatsoft.fscomponent.FSCalenderCombo();
        salesDate2 = new jp.co.flatsoft.fscomponent.FSCalenderCombo();
        deleteButton = new javax.swing.JButton();
        staff = new javax.swing.JComboBox();
        paymentClassPanel = new javax.swing.JPanel();
        backButton = new javax.swing.JButton();
        shop = new javax.swing.JComboBox();
        shopLabel = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("\u4f1d\u7968\u691c\u7d22");
        setFocusTraversalPolicy(getFocusTraversalPolicy());
        addComponentListener(new java.awt.event.ComponentAdapter()
        {
            public void componentResized(java.awt.event.ComponentEvent evt)
            {
                formComponentResized(evt);
            }
        });

        backPanel.setImage(SystemInfo.getImageIcon("/contents_background.jpg"));
        selectButton.setIcon(SystemInfo.getImageIcon("/button/select/select_off.jpg"));
        selectButton.setBorderPainted(false);
        selectButton.setContentAreaFilled(false);
        selectButton.setPressedIcon(SystemInfo.getImageIcon("/button/select/select_on.jpg"));
        selectButton.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                selectButtonActionPerformed(evt);
            }
        });

        salesDateLabel.setText("\u58f2\u4e0a\u65e5");

        slipNoLabel.setText("\u4f1d\u7968No.");

        customerIDLabel.setText("\u9867\u5ba2No.");

        toLabel1.setText("\uff5e");

        slipNo1.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        slipNo1.setColumns(9);
        slipNo1.setHorizontalAlignment(javax.swing.JTextField.RIGHT);

        toLabel2.setText("\uff5e");

        slipNo2.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        slipNo2.setColumns(9);
        slipNo2.setHorizontalAlignment(javax.swing.JTextField.RIGHT);

        customerNo1.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        customerNo1.setColumns(15);

        toLabel3.setText("\uff5e");

        customerNo2.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        customerNo2.setColumns(15);

        staffLabel.setText("\u30ec\u30b8\u62c5\u5f53\u8005");

        paymentClassLabel.setText("\u652f\u6255\u533a\u5206");

        searchButton.setIcon(SystemInfo.getImageIcon("/button/search/search_off.jpg"));
        searchButton.setBorderPainted(false);
        searchButton.setContentAreaFilled(false);
        searchButton.setPressedIcon(SystemInfo.getImageIcon("/button/search/search_on.jpg"));
        searchButton.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                searchButtonActionPerformed(evt);
            }
        });

        accountsScrollPane.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        this.initPaymentClass();
        searchResult.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][]
            {

            },
            new String []
            {
                "売上日", "伝票No.", "顧客No.", "顧客名", "レジ担当者", "現金支払", "カード支払", "信販支払"
            }
        )
        {
            Class[] types = new Class []
            {
                java.lang.String.class, java.lang.Integer.class, java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.Long.class, java.lang.Long.class, java.lang.Long.class
            };
            boolean[] canEdit = new boolean []
            {
                false, false, false, false, false, false, false, false
            };

            public Class getColumnClass(int columnIndex)
            {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex)
            {
                return canEdit [columnIndex];
            }
        });
        searchResult.setSelectionBackground(new java.awt.Color(220, 220, 220));
        searchResult.setSelectionForeground(new java.awt.Color(0, 0, 0));
        searchResult.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
        searchResult.getTableHeader().setReorderingAllowed(false);
        SwingUtil.setJTableHeaderRenderer(searchResult, SystemInfo.getTableHeaderRenderer());
        searchResult.setRowHeight(SystemInfo.TABLE_ROW_HEIGHT);
        SelectTableCellRenderer.setSelectTableCellRenderer(searchResult);
        searchResult.addMouseListener(new java.awt.event.MouseAdapter()
        {
            public void mouseClicked(java.awt.event.MouseEvent evt)
            {
                searchResultMouseClicked(evt);
            }
        });

        accountsScrollPane.setViewportView(searchResult);

        salesDate1.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        salesDate1.addFocusListener(new java.awt.event.FocusAdapter()
        {
            public void focusGained(java.awt.event.FocusEvent evt)
            {
                salesDate1FocusGained(evt);
            }
        });

        salesDate2.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        salesDate2.addFocusListener(new java.awt.event.FocusAdapter()
        {
            public void focusGained(java.awt.event.FocusEvent evt)
            {
                salesDate2FocusGained(evt);
            }
        });

        deleteButton.setIcon(SystemInfo.getImageIcon("/button/common/delete_off.jpg"));
        deleteButton.setBorderPainted(false);
        deleteButton.setContentAreaFilled(false);
        deleteButton.setPressedIcon(SystemInfo.getImageIcon("/button/common/delete_on.jpg"));
        deleteButton.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                deleteButtonActionPerformed(evt);
            }
        });

        staff.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));

        paymentClassPanel.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 0, 3));

        paymentClassPanel.setOpaque(false);

        backButton.setIcon(SystemInfo.getImageIcon("/button/common/close_off.jpg"));
        backButton.setBorderPainted(false);
        backButton.setContentAreaFilled(false);
        backButton.setFocusTraversalPolicy(getFocusTraversalPolicy());
        backButton.setPressedIcon(SystemInfo.getImageIcon("/button/common/close_on.jpg"));
        backButton.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                backButtonActionPerformed(evt);
            }
        });

        shop.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        shop.setRenderer(new GroupComboBoxCellRenderer());

        shopLabel.setText("\u5e97\u8217");

        org.jdesktop.layout.GroupLayout backPanelLayout = new org.jdesktop.layout.GroupLayout(backPanel);
        backPanel.setLayout(backPanelLayout);
        backPanelLayout.setHorizontalGroup(
            backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(backPanelLayout.createSequentialGroup()
                .addContainerGap()
                .add(backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(accountsScrollPane, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 698, Short.MAX_VALUE)
                    .add(backPanelLayout.createSequentialGroup()
                        .add(backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                            .add(backPanelLayout.createSequentialGroup()
                                .add(paymentClassLabel)
                                .add(29, 29, 29)
                                .add(paymentClassPanel, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 279, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                            .add(searchButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 92, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                            .add(backPanelLayout.createSequentialGroup()
                                .add(backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                                    .add(slipNoLabel)
                                    .add(shopLabel))
                                .add(37, 37, 37)
                                .add(backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                                    .add(shop, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 209, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                    .add(backPanelLayout.createSequentialGroup()
                                        .add(slipNo1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 79, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                        .add(toLabel2)
                                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                        .add(slipNo2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 87, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))))
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                            .add(backPanelLayout.createSequentialGroup()
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                                    .add(backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING, false)
                                        .add(staffLabel, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .add(customerIDLabel, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 62, Short.MAX_VALUE))
                                    .add(salesDateLabel))
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                                    .add(staff, 0, 275, Short.MAX_VALUE)
                                    .add(org.jdesktop.layout.GroupLayout.LEADING, backPanelLayout.createSequentialGroup()
                                        .add(backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING, false)
                                            .add(customerNo1, 0, 0, Short.MAX_VALUE)
                                            .add(salesDate1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                        .add(backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING, false)
                                            .add(backPanelLayout.createSequentialGroup()
                                                .add(toLabel1)
                                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                                .add(salesDate2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                                            .add(backPanelLayout.createSequentialGroup()
                                                .add(toLabel3)
                                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                                .add(customerNo2, 0, 0, Short.MAX_VALUE)))
                                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .add(backButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 70, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))))
                            .add(org.jdesktop.layout.GroupLayout.TRAILING, backPanelLayout.createSequentialGroup()
                                .add(134, 134, 134)
                                .add(selectButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 92, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(deleteButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 92, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))))
                .addContainerGap())
        );
        backPanelLayout.setVerticalGroup(
            backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(backPanelLayout.createSequentialGroup()
                .addContainerGap()
                .add(backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(backPanelLayout.createSequentialGroup()
                        .add(backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                            .add(org.jdesktop.layout.GroupLayout.TRAILING, salesDate2, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 21, Short.MAX_VALUE)
                            .add(org.jdesktop.layout.GroupLayout.TRAILING, salesDateLabel, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 21, Short.MAX_VALUE)
                            .add(org.jdesktop.layout.GroupLayout.TRAILING, salesDate1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 21, Short.MAX_VALUE)
                            .add(backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                                .add(shop, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 19, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                .add(shopLabel)))
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                            .add(slipNoLabel)
                            .add(toLabel2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                            .add(slipNo2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 19, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                            .add(slipNo1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                            .add(backPanelLayout.createSequentialGroup()
                                .add(paymentClassLabel)
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 20, Short.MAX_VALUE)
                                .add(backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                                    .add(searchButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                    .add(deleteButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                    .add(selectButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
                            .add(paymentClassPanel, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 23, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
                    .add(backPanelLayout.createSequentialGroup()
                        .add(backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                            .add(backPanelLayout.createSequentialGroup()
                                .add(31, 31, 31)
                                .add(backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                                    .add(customerIDLabel, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 18, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                    .add(customerNo1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 19, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                    .add(toLabel3)
                                    .add(customerNo2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 19, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
                            .add(backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                                .add(backButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 22, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                .add(toLabel1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 19, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(backPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                            .add(staff, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 19, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                            .add(staffLabel))))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(accountsScrollPane, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 347, Short.MAX_VALUE)
                .addContainerGap())
        );

        backPanelLayout.linkSize(new java.awt.Component[] {customerNo1, customerNo2, slipNo1, slipNo2, staff}, org.jdesktop.layout.GroupLayout.VERTICAL);

        org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(backPanel, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(backPanel, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        pack();
    }// </editor-fold>//GEN-END:initComponents

	private void deleteButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_deleteButtonActionPerformed
	{//GEN-HEADEREND:event_deleteButtonActionPerformed
		this.delete();
	}//GEN-LAST:event_deleteButtonActionPerformed

	private void salesDate2FocusGained(java.awt.event.FocusEvent evt)//GEN-FIRST:event_salesDate2FocusGained
	{//GEN-HEADEREND:event_salesDate2FocusGained
		if(salesDate2.getInputContext() != null)
			salesDate2.getInputContext().setCharacterSubsets(null);
	}//GEN-LAST:event_salesDate2FocusGained

	private void salesDate1FocusGained(java.awt.event.FocusEvent evt)//GEN-FIRST:event_salesDate1FocusGained
	{//GEN-HEADEREND:event_salesDate1FocusGained
		if(salesDate1.getInputContext() != null)
			salesDate1.getInputContext().setCharacterSubsets(null);
	}//GEN-LAST:event_salesDate1FocusGained

	private void searchResultMouseClicked(java.awt.event.MouseEvent evt)//GEN-FIRST:event_searchResultMouseClicked
	{//GEN-HEADEREND:event_searchResultMouseClicked
		if(evt.getClickCount() == 2)
		{
			if(0 <= searchResult.getSelectedRow())
			{
				this.select();
			}
		}
	}//GEN-LAST:event_searchResultMouseClicked

	private void searchButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_searchButtonActionPerformed
	{//GEN-HEADEREND:event_searchButtonActionPerformed
		this.searchAccount();
		this.showAccount();
	}//GEN-LAST:event_searchButtonActionPerformed

	private void selectButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_selectButtonActionPerformed
	{//GEN-HEADEREND:event_selectButtonActionPerformed
		this.select();
	}//GEN-LAST:event_selectButtonActionPerformed

	/**
	 * フォームのサイズを変更したときの処理
	 * @param evt 
	 */
	private void formComponentResized(java.awt.event.ComponentEvent evt)//GEN-FIRST:event_formComponentResized
	{//GEN-HEADEREND:event_formComponentResized
		this.resizeComponets();
	}//GEN-LAST:event_formComponentResized

	/**
	 * 戻るボタンが押されたときの処理
	 * @param evt 
	 */
	private void backButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_backButtonActionPerformed
	{//GEN-HEADEREND:event_backButtonActionPerformed
		this.setVisible(false);
	}//GEN-LAST:event_backButtonActionPerformed

	/**
	 * 選択ボタンが押されたときの処理
	 * @param evt 
	 */	
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JScrollPane accountsScrollPane;
    private javax.swing.JButton backButton;
    private com.geobeck.swing.ImagePanel backPanel;
    private javax.swing.JLabel customerIDLabel;
    private com.geobeck.swing.JFormattedTextFieldEx customerNo1;
    private com.geobeck.swing.JFormattedTextFieldEx customerNo2;
    private javax.swing.JButton deleteButton;
    private javax.swing.JLabel paymentClassLabel;
    private javax.swing.JPanel paymentClassPanel;
    private jp.co.flatsoft.fscomponent.FSCalenderCombo salesDate1;
    private jp.co.flatsoft.fscomponent.FSCalenderCombo salesDate2;
    private javax.swing.JLabel salesDateLabel;
    private javax.swing.JButton searchButton;
    private javax.swing.JTable searchResult;
    private javax.swing.JButton selectButton;
    private javax.swing.JComboBox shop;
    private javax.swing.JLabel shopLabel;
    private com.geobeck.swing.JFormattedTextFieldEx slipNo1;
    private com.geobeck.swing.JFormattedTextFieldEx slipNo2;
    private javax.swing.JLabel slipNoLabel;
    private javax.swing.JComboBox staff;
    private javax.swing.JLabel staffLabel;
    private javax.swing.JLabel toLabel1;
    private javax.swing.JLabel toLabel2;
    private javax.swing.JLabel toLabel3;
    // End of variables declaration//GEN-END:variables
	
	private ArrayList<JCheckBox> paymentClasses	=	new ArrayList<JCheckBox>();
	
	private SearchAccount	sa	=	new SearchAccount();
	
	private Integer		selectedSlipNo	=	null;
	
	private boolean		parentDialog	=	true;
	
	/**
	 * 伝票検索画面用FocusTraversalPolicy
	 */
	private	SearchAccountFocusTraversalPolicy	ftp	=
			new SearchAccountFocusTraversalPolicy();
	
	/**
	 * 伝票検索画面用FocusTraversalPolicyを取得する。
	 * @return 伝票検索画面用FocusTraversalPolicy
	 */
	public SearchAccountFocusTraversalPolicy getFocusTraversalPolicy()
	{
		return	ftp;
	}
	
	/**
	 * ボタンにマウスカーソルが乗ったときにカーソルを変更するイベントを追加する。
	 */
	private void addMouseCursorChange()
	{
		SystemInfo.addMouseCursorChange(searchButton);
		SystemInfo.addMouseCursorChange(selectButton);
		SystemInfo.addMouseCursorChange(deleteButton);
		SystemInfo.addMouseCursorChange(backButton);
	}
	
	/**
	 * コンポーネントの各リスナーをセットする。
	 */
	private void setListener()
	{
		customerNo1.addKeyListener(SystemInfo.getMoveNextField());
		customerNo1.addFocusListener(SystemInfo.getSelectText());
		customerNo2.addKeyListener(SystemInfo.getMoveNextField());
		customerNo2.addFocusListener(SystemInfo.getSelectText());
		salesDate1.addKeyListener(SystemInfo.getMoveNextField());
		salesDate1.addFocusListener(SystemInfo.getSelectText());
		salesDate2.addKeyListener(SystemInfo.getMoveNextField());
		salesDate2.addFocusListener(SystemInfo.getSelectText());
		slipNo1.addKeyListener(SystemInfo.getMoveNextField());
		slipNo1.addFocusListener(SystemInfo.getSelectText());
		slipNo2.addKeyListener(SystemInfo.getMoveNextField());
		slipNo2.addFocusListener(SystemInfo.getSelectText());
		staff.addKeyListener(SystemInfo.getMoveNextField());
	}
	
	/**
	 * 初期化処理を行う。
	 */
	private void init()
	{
		try
		{
			ConnectionWrapper	con	=	SystemInfo.getConnection();
			sa.init(con);
		}
		catch(SQLException e)
		{
			SystemInfo.getLogger().log(Level.SEVERE, e.getLocalizedMessage(), e);
		}
	}
	
	/**
	 * レジ担当者を初期化する。
	 */
	private void initStaff()
	{
		staff.addItem(new MstStaff());
		SystemInfo.initStaffComponent(staff);
		
		staff.setSelectedIndex(0);
	}
	
	/**
	 * 支払区分を初期化する。
	 */
	private void initPaymentClass()
	{
		this.addPaymentClass("paymentClass0", "全て");
		
		Integer	index	=	1;
		
		for(MstPaymentClass mpc : sa.getPaymentClasses())
		{
			this.addPaymentClass("paymentClass" + index.toString(),
					mpc.getPaymentClassName());
			
			index ++;
		}
	}
	
	/**
	 * 支払区分を追加する。
	 * @param caption 支払区分名
	 * @param x ｘ座標
	 * @param y ｙ座標
	 */
	private void addPaymentClass(String name, String caption)
	{
		JCheckBox	cb	=	new JCheckBox(caption);
		cb.setName(name);
		cb.setOpaque(false);
		cb.addKeyListener(SystemInfo.getMoveNextField());
		cb.setFocusTraversalPolicy(this.getFocusTraversalPolicy());
		cb.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 0, 0, 0));
		cb.setFocusTraversalPolicy(getFocusTraversalPolicy());
		cb.setMargin(new java.awt.Insets(0, 0, 0, 0));
		cb.setSelected(true);
		if(0 < paymentClasses.size())
		{
			JLabel	padding	=	new JLabel("　　　");
			paymentClassPanel.add(padding);
		}
		paymentClassPanel.add(cb);
		paymentClasses.add(cb);
	}
	
	/**
	 * フォームのサイズに合わせてコンポーネントのサイズと位置を変更する。
	 */
	private void resizeComponets()
	{
		//テーブルの幅と高さを設定する。
		/*int	w	=	this.getWidth() - 32;
		int	h	=	this.getHeight() - accountsScrollPane.getY() - 45;
		if(w < TABLE_WIDTH_MIN)		w	=	TABLE_WIDTH_MIN;
		if(h < 0)		w	=	0;
		accountsScrollPane.setSize(w, h);
		searchResult.setSize(accountsScrollPane.getSize());
		
		//ボタンの右側のｘ座標を取得する。
		int	x	=	this.getWidth() - 20;
		if(x < TABLE_WIDTH_MIN + 12)		x	=	TABLE_WIDTH_MIN + 12;
		
		searchButton.setLocation(x - searchButton.getWidth(), searchButton.getY());*/
	}
	
	/**
	 * 伝票検索処理を行う。
	 */
	public void searchAccount()
	{
		this.setSearchCondition();
		
		try
		{
			ConnectionWrapper	con	=	SystemInfo.getConnection();
			
			sa.load(con);
		}
		catch(SQLException e)
		{
			SystemInfo.getLogger().log(Level.SEVERE, e.getLocalizedMessage(), e);
		}
	}
	
	/**
	 * 検索条件をセットする。
	 */
	private void setSearchCondition()
	{
		sa.setShop((MstShop)shop.getSelectedItem());
		//売上日
		sa.setSalesDate(0, salesDate1.getDate());
		sa.setSalesDate(1, salesDate2.getDate());
		//伝票No.
		sa.setSlipNO(0, (slipNo1.getText().equals("") ? null : Integer.parseInt(slipNo1.getText())));
		sa.setSlipNO(1, (slipNo2.getText().equals("") ? null : Integer.parseInt(slipNo2.getText())));
		//顧客ID
		sa.setCustomerNo(0, (customerNo1.getText().equals("") ? null : customerNo1.getText()));
		sa.setCustomerNo(1, (customerNo2.getText().equals("") ? null : customerNo2.getText()));
		//レジ担当者
		sa.setStaff((MstStaff)staff.getSelectedItem());
		//支払区分
		for(int i = 0; i < paymentClasses.size(); i ++)
		{
			sa.getSearchPC().set(i, paymentClasses.get(i).isSelected());
		}
	}
	
	/**
	 * 検索結果を表示する。
	 */
	public void showAccount()
	{
		SwingUtil.clearTable(searchResult);
		
		DefaultTableModel	model	=	(DefaultTableModel)searchResult.getModel();
		
		for(AccountData ad : sa)
		{
			ArrayList<Object>	rowData	=	new ArrayList<Object>();
			rowData.add(DateUtil.format(ad.getSales().getSalesDate(), "yyyy/MM/dd"));
			rowData.add(ad.getSales().getSlipNo());
			rowData.add(ad.getSales().getCustomer().getCustomerNo());
			rowData.add(ad.getSales().getCustomer().getFullCustomerName());
			rowData.add(ad.getStaff().getFullStaffName());
			for(Long pv : ad.getPaymentValue())
			{
				rowData.add(pv);
			}
			model.addRow(rowData.toArray());
		}
	}
	
	/**
	 * 伝票が選択されたときの処理を行う。
	 */
	private void select()
	{
		//伝票が選択されている場合
		if(0 <= searchResult.getSelectedRow())
		{
			//選択されている伝票No.をセット
			this.setSelectedSlipNo(sa.get(searchResult.getSelectedRow()).getSales().getSlipNo());
			
			this.setVisible(false);
		}
	}
	
	
	/**
	 * 伝票削除処理を行う。
	 */
	private void delete()
	{
		if(searchResult.getSelectedRow() < 0)
				return;
		
		DataSales	sales	=	sa.get(searchResult.getSelectedRow()).getSales();
		
		if(MessageDialog.showYesNoDialog(this,
					MessageUtil.getMessage(MessageUtil.CONFIRM_DELETE,
							"伝票No." + sales.getSlipNo().toString()),
					JOptionPane.WARNING_MESSAGE) != 0)
		{
			return;
		}
		
		try
		{
			ConnectionWrapper con	=	SystemInfo.getConnection();
			
			if(sales.deleteAll(con))
			{
				this.searchAccount();
				this.showAccount();
			}
		}
		catch(Exception e)
		{
			SystemInfo.getLogger().log(Level.SEVERE, e.getLocalizedMessage(), e);
		}
	}
	
	/**
	 * 伝票検索画面用FocusTraversalPolicy
	 */
	private class SearchAccountFocusTraversalPolicy
					extends FocusTraversalPolicy
	{
		/**
		 * aComponent のあとでフォーカスを受け取る Component を返します。
		 * aContainer は aComponent のフォーカスサイクルのルートまたはフォーカストラバーサルポリシープロバイダでなければなりません。
		 * @param aContainer aComponent のフォーカスサイクルのルートまたはフォーカストラバーサルポリシープロバイダ
		 * @param aComponent aContainer のおそらく間接的な子、または aContainer 自体
		 * @return aComponent のあとにフォーカスを受け取る Component。適切な Component が見つからない場合は null
		 */
		public Component getComponentAfter(Container aContainer,
										   Component aComponent)
		{
			if (aComponent.equals(salesDate1))
			{
				return salesDate2;
			}
			else if (aComponent.equals(salesDate2))
			{
				return slipNo1;
			}
			else if (aComponent.equals(slipNo1))
			{
				return slipNo2;
			}
			else if (aComponent.equals(slipNo2))
			{
				return customerNo1;
			}
			else if (aComponent.equals(customerNo1))
			{
				return customerNo2;
			}
			else if (aComponent.equals(customerNo2))
			{
				return staff;
			}
			else if (aComponent.equals(staff))
			{
				return this.getFirstPaymentClass();
			}
			else if (aComponent.equals(searchButton))
			{
				return	salesDate1;
			}
			else if (aComponent.getName() != null &&
					0 <= aComponent.getName().indexOf("paymentClass"))
			{
				return this.getNextPaymentClass(aComponent);
			}
			
			return salesDate1;
		}

		/**
		 * aComponent の前にフォーカスを受け取る Component を返します。
		 * aContainer は aComponent のフォーカスサイクルのルートまたはフォーカストラバーサルポリシープロバイダでなければなりません。
		 * @param aContainer aComponent のフォーカスサイクルのルートまたはフォーカストラバーサルポリシープロバイダ
		 * @param aComponent aContainer のおそらく間接的な子、または aContainer 自体
		 * @return aComponent の前にフォーカスを受け取る Component。適切な Component が見つからない場合は null
		 */
		public Component getComponentBefore(Container aContainer,
											Component aComponent)
		{
			if (aComponent.equals(salesDate1))
			{
				return searchButton;
			}
			else if (aComponent.equals(salesDate2))
			{
				return salesDate1;
			}
			else if (aComponent.equals(slipNo1))
			{
				return salesDate2;
			}
			else if (aComponent.equals(slipNo2))
			{
				return slipNo1;
			}
			else if (aComponent.equals(customerNo1))
			{
				return slipNo2;
			}
			else if (aComponent.equals(customerNo2))
			{
				return customerNo1;
			}
			else if (aComponent.equals(staff))
			{
				return customerNo2;
			}
			else if (aComponent.equals(searchButton))
			{
				return	this.getLastPaymentClass();
			}
			else if (aComponent.getName() != null &&
					0 <= aComponent.getName().indexOf("paymentClass"))
			{
				return this.getPreviousPaymentClass(aComponent);
			}
			
			return salesDate1;
		}
		
		/**
		 * 最初の支払区分
		 * @return 最初の支払区分
		 */
		private Component getFirstPaymentClass()
		{
			if(0 < paymentClasses.size())
					return	paymentClasses.get(0);
			else
					return	null;
		}
		
		/**
		 * 最後の支払区分
		 * @return 最後の支払区分
		 */
		private Component getLastPaymentClass()
		{
			if(0 < paymentClasses.size())
					return	paymentClasses.get(paymentClasses.size() - 1);
			else
					return	null;
		}
		
		/**
		 * 次の支払区分を取得する。（無ければスタッフID）
		 * @param pc 現在の支払区分
		 * @return 次の支払区分
		 */
		private Component getNextPaymentClass(Component pc)
		{
			int	index	=	Integer.parseInt(pc.getName().replaceAll("paymentClass", ""));
			
			if(0 <= index && index < paymentClasses.size() - 1)
			{
				return	paymentClasses.get(index + 1);
			}
			
			return	searchButton;
		}
		
		/**
		 * 前の支払区分を取得する。（無ければスタッフID）
		 * @param pc 現在の支払区分
		 * @return 前の支払区分
		 */
		private Component getPreviousPaymentClass(Component pc)
		{
			int	index	=	Integer.parseInt(pc.getName().replaceAll("paymentClass", ""));
			
			if(1 <= index && index < paymentClasses.size())
			{
				return	paymentClasses.get(index - 1);
			}
			
			return	staff;
		}

		/**
		 * トラバーサルサイクルの最初の Component を返します。
		 * このメソッドは、順方向のトラバーサルがラップするときに、次にフォーカスする Component を判定するために使用します。
		 * @param aContainer 先頭の Component を返すフォーカスサイクルのルートまたはフォーカストラバーサルポリシープロバイダ
		 * @return aContainer のトラバーサルサイクルの先頭の Componet、または適切な Component が見つからない場合は null
		 */
		public Component getFirstComponent(Container aContainer)
		{
			return salesDate1;
		}

		/**
		 * トラバーサルサイクルの最後の Component を返します。
		 * このメソッドは、逆方向のトラバーサルがラップするときに、次にフォーカスする Component を判定するために使用します。
		 * @param aContainer aContainer - 最後の Component を返すフォーカスサイクルのルートまたはフォーカストラバーサルポリシープロバイダ
		 * @return aContainer のトラバーサルサイクルの最後の Componet、または適切な Component が見つからない場合は null
		 */
		public Component getLastComponent(Container aContainer)
		{
			return searchButton;
		}

		/**
		 * フォーカスを設定するデフォルトコンポーネントを返します。
		 * aContainer をルートとするフォーカストラバーサルサイクルが新しく開始されたときに、このコンポーネントに最初にフォーカスが設定されます。
		 * @param aContainer デフォルトの Component を返すフォーカスサイクルのルートまたはフォーカストラバーサルポリシープロバイダ
		 * @return aContainer のトラバーサルサイクルのデフォルトの Componet、または適切な Component が見つからない場合は null
		 */
		public Component getDefaultComponent(Container aContainer)
		{
			return salesDate1;
		}
		
		/**
		 * ウィンドウが最初に表示されたときにフォーカスが設定されるコンポーネントを返します。
		 * show() または setVisible(true) の呼び出しで一度ウィンドウが表示されると、
		 * 初期化コンポーネントはそれ以降使用されません。
		 * 一度別のウィンドウに移ったフォーカスが再び設定された場合、
		 * または、一度非表示状態になったウィンドウが再び表示された場合は、
		 * そのウィンドウの最後にフォーカスが設定されたコンポーネントがフォーカス所有者になります。
		 * このメソッドのデフォルト実装ではデフォルトコンポーネントを返します。
		 * @param window 初期コンポーネントが返されるウィンドウ
		 * @return 最初にウィンドウが表示されるときにフォーカス設定されるコンポーネント。適切なコンポーネントがない場合は null
		 */
		public Component getInitialComponent(Window window)
		{
			return salesDate1;
		}
	}

	/**
	 * 選択されている伝票No.を取得する。
	 * @return 選択されている伝票No.
	 */
	public MstShop getSelectedShop()
	{
		return (MstShop)shop.getSelectedItem();
	}

	/**
	 * 選択されている伝票No.を取得する。
	 * @return 選択されている伝票No.
	 */
	public Integer getSelectedSlipNo()
	{
		return selectedSlipNo;
	}

	/**
	 * 選択されている伝票No.をセットする。
	 * @param selectedSlipNo 選択されている伝票No.
	 */
	public void setSelectedSlipNo(Integer selectedSlipNo)
	{
		this.selectedSlipNo = selectedSlipNo;
	}

	/**
	 * 伝票検索画面から伝票入力画面を開くかを取得する。
	 * @return true - 伝票検索画面から伝票入力画面を開く場合
	 */
	public boolean isParentDialog()
	{
		return parentDialog;
	}

	/**
	 * 伝票検索画面から伝票入力画面を開くかをセットする。
	 * @param parentDialog true - 伝票検索画面から伝票入力画面を開く場合
	 */
	public void setParentDialog(boolean parentDialog)
	{
		this.parentDialog = parentDialog;
		deleteButton.setVisible(parentDialog);
	}
}