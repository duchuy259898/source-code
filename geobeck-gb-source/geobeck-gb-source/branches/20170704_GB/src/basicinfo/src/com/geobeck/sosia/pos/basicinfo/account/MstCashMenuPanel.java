/*
 * MstCashMenuPanel.java
 *
 * Created on 2008/09/22, 22:00
 */

package com.geobeck.sosia.pos.basicinfo.account;

import com.geobeck.sosia.pos.master.account.MstCashClass;
import com.geobeck.sosia.pos.master.account.MstCashClasses;
import com.geobeck.sosia.pos.master.account.MstCashMenu;
import java.awt.*;
import javax.swing.*;
import javax.swing.table.*;
import javax.swing.text.*;
import java.sql.*;
import java.util.logging.*;
import com.geobeck.sql.*;
import com.geobeck.swing.*;
import com.geobeck.util.*;
import com.geobeck.sosia.pos.util.*;
import com.geobeck.sosia.pos.swing.*;
import com.geobeck.sosia.pos.system.SystemInfo;


/**
 *
 * @author  saito
 */
public class MstCashMenuPanel extends com.geobeck.sosia.pos.swing.AbstractImagePanelEx
{
	private MstCashClasses		mkcs		=	new MstCashClasses();
	private MstCashClass		mkc		=	new MstCashClass();
	private Integer                 selIndex	=	-1;
	
    /**
     * Creates new form MstCashMenuPanel
     */
	public MstCashMenuPanel()
	{
		super();
		initComponents();
		addMouseCursorChange();
		this.setSize(420, 680);
		this.setTitle("è¨å˚è⁄ç◊ìoò^");
		this.setListener();
		this.init();
	}
	
	/** This method is called from within the constructor to
	 * initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is
	 * always regenerated by the Form Editor.
	 */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        cashClassLabel = new javax.swing.JLabel();

        try
        {
            ConnectionWrapper	con	=	SystemInfo.getConnection();

            mkcs.load(con);

            con.close();
        }
        catch(SQLException e)
        {
            SystemInfo.getLogger().log(Level.SEVERE, e.getLocalizedMessage(), e);
        }
        cashClass = new JComboBox(new DefaultComboBoxModel(mkcs.toArray())
            {
                public void setSelectedItem(Object o)
                {
                    super.setSelectedItem(o);
                }
            });
            cashMenuNameLabel = new javax.swing.JLabel();
            cashMenuName = new com.geobeck.swing.JFormattedTextFieldEx();
            ((PlainDocument)cashMenuName.getDocument()).setDocumentFilter(
                new CustomFilter(30));
            displaySeqLabel = new javax.swing.JLabel();
            displaySeq = new com.geobeck.swing.JFormattedTextFieldEx();
            ((PlainDocument)displaySeq.getDocument()).setDocumentFilter(
                new CustomFilter(4, CustomFilter.NUMERIC));
            jPanel1 = new javax.swing.JPanel();
            addButton = new javax.swing.JButton();
            renewButton = new javax.swing.JButton();
            deleteButton = new javax.swing.JButton();
            cashMenuScrollPane = new javax.swing.JScrollPane();
            cashMenu = new javax.swing.JTable();

            setFocusCycleRoot(true);
            setFocusTraversalPolicyProvider(true);

            cashClassLabel.setText("è¨å˚çÄñ⁄ñº");

            cashClass.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
            cashClass.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    cashClassActionPerformed(evt);
                }
            });

            cashMenuNameLabel.setText("è¨å˚è⁄ç◊ñº");

            cashMenuName.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
            cashMenuName.setColumns(30);
            cashMenuName.setInputKanji(true);

            displaySeqLabel.setText("ë}ì¸à íu");

            displaySeq.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
            displaySeq.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
            displaySeq.addFocusListener(new java.awt.event.FocusAdapter() {
                public void focusLost(java.awt.event.FocusEvent evt) {
                    displaySeqFocusLost(evt);
                }
            });

            jPanel1.setOpaque(false);

            addButton.setIcon(SystemInfo.getImageIcon("/button/common/insert_off.jpg"));
            addButton.setBorderPainted(false);
            addButton.setContentAreaFilled(false);
            addButton.setPressedIcon(SystemInfo.getImageIcon("/button/common/insert_on.jpg"));
            addButton.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    addButtonActionPerformed(evt);
                }
            });

            renewButton.setIcon(SystemInfo.getImageIcon("/button/common/update_off.jpg"));
            renewButton.setBorderPainted(false);
            renewButton.setContentAreaFilled(false);
            renewButton.setEnabled(false);
            renewButton.setPressedIcon(SystemInfo.getImageIcon("/button/common/update_on.jpg"));
            renewButton.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    renewButtonActionPerformed(evt);
                }
            });

            deleteButton.setIcon(SystemInfo.getImageIcon("/button/common/delete_off.jpg"));
            deleteButton.setBorderPainted(false);
            deleteButton.setContentAreaFilled(false);
            deleteButton.setEnabled(false);
            deleteButton.setPressedIcon(SystemInfo.getImageIcon("/button/common/delete_on.jpg"));
            deleteButton.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    deleteButtonActionPerformed(evt);
                }
            });

            org.jdesktop.layout.GroupLayout jPanel1Layout = new org.jdesktop.layout.GroupLayout(jPanel1);
            jPanel1.setLayout(jPanel1Layout);
            jPanel1Layout.setHorizontalGroup(
                jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                .add(org.jdesktop.layout.GroupLayout.TRAILING, jPanel1Layout.createSequentialGroup()
                    .addContainerGap(106, Short.MAX_VALUE)
                    .add(addButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 92, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                    .add(renewButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 92, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                    .add(deleteButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 92, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
            );
            jPanel1Layout.setVerticalGroup(
                jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                .add(jPanel1Layout.createSequentialGroup()
                    .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                        .add(deleteButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                        .add(renewButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                        .add(addButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
            );

            cashMenuScrollPane.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));

            cashMenu.setModel(new javax.swing.table.DefaultTableModel(
                new Object [][] {
                    {null, null}
                },
                new String [] {
                    "è¨å˚è⁄ç◊ñº", "ï\é¶èá"
                }
            ) {
                Class[] types = new Class [] {
                    java.lang.String.class, java.lang.Integer.class
                };
                boolean[] canEdit = new boolean [] {
                    false, false
                };

                public Class getColumnClass(int columnIndex) {
                    return types [columnIndex];
                }

                public boolean isCellEditable(int rowIndex, int columnIndex) {
                    return canEdit [columnIndex];
                }
            });
            cashMenu.setSelectionBackground(new java.awt.Color(220, 220, 220));
            cashMenu.setSelectionForeground(new java.awt.Color(0, 0, 0));
            cashMenu.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
            cashMenu.getTableHeader().setReorderingAllowed(false);
            SwingUtil.setJTableHeaderRenderer(cashMenu, SystemInfo.getTableHeaderRenderer());
            cashMenu.setRowHeight(SystemInfo.TABLE_ROW_HEIGHT);
            this.initTableColumnWidth();
            SelectTableCellRenderer.setSelectTableCellRenderer(cashMenu);
            cashMenu.addMouseListener(new java.awt.event.MouseAdapter() {
                public void mouseReleased(java.awt.event.MouseEvent evt) {
                    cashMenuMouseReleased(evt);
                }
            });
            cashMenu.addKeyListener(new java.awt.event.KeyAdapter() {
                public void keyReleased(java.awt.event.KeyEvent evt) {
                    cashMenuKeyReleased(evt);
                }
            });
            cashMenuScrollPane.setViewportView(cashMenu);

            org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(this);
            this.setLayout(layout);
            layout.setHorizontalGroup(
                layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                .add(layout.createSequentialGroup()
                    .addContainerGap()
                    .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING, false)
                        .add(org.jdesktop.layout.GroupLayout.LEADING, cashMenuScrollPane, 0, 0, Short.MAX_VALUE)
                        .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .add(org.jdesktop.layout.GroupLayout.LEADING, layout.createSequentialGroup()
                            .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                                .add(cashClassLabel)
                                .add(cashMenuNameLabel))
                            .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                            .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING, false)
                                .add(cashClass, 0, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .add(cashMenuName, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 199, Short.MAX_VALUE))
                            .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                            .add(displaySeqLabel)
                            .add(5, 5, 5)
                            .add(displaySeq, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 71, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
                    .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
            );
            layout.setVerticalGroup(
                layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                .add(layout.createSequentialGroup()
                    .addContainerGap()
                    .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                        .add(cashClassLabel)
                        .add(cashClass, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 24, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                    .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                    .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                        .add(cashMenuNameLabel)
                        .add(cashMenuName, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 24, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                        .add(displaySeq, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 24, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                        .add(displaySeqLabel))
                    .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                    .add(jPanel1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                    .add(cashMenuScrollPane, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 306, Short.MAX_VALUE)
                    .addContainerGap())
            );
        }// </editor-fold>//GEN-END:initComponents

        private void displaySeqFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_displaySeqFocusLost
                if(! CheckUtil.isNumber(displaySeq.getText()))                                                                               
                        displaySeq.setText("");                        
        }//GEN-LAST:event_displaySeqFocusLost

        private void cashClassActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cashClassActionPerformed
		refresh();
        }//GEN-LAST:event_cashClassActionPerformed

	private void deleteButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_deleteButtonActionPerformed
	{//GEN-HEADEREND:event_deleteButtonActionPerformed
		if(this.delete())
		{
			this.refresh();
		}
	}//GEN-LAST:event_deleteButtonActionPerformed

	private void renewButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_renewButtonActionPerformed
	{//GEN-HEADEREND:event_renewButtonActionPerformed
		if(this.checkInput())
		{
			if(this.regist(false))
			{
				this.refresh();
			}
			else
			{
				MessageDialog.showMessageDialog(this,
						MessageUtil.getMessage(MessageUtil.ERROR_REGIST_FAILED, "è¨å˚è⁄ç◊"),
						this.getTitle(),
						JOptionPane.ERROR_MESSAGE);
			}
		}
	}//GEN-LAST:event_renewButtonActionPerformed

	private void addButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_addButtonActionPerformed
	{//GEN-HEADEREND:event_addButtonActionPerformed
		if(this.checkInput())
		{
			if(this.regist(true))
			{
				this.refresh();
			}
			else
			{
				MessageDialog.showMessageDialog(this,
						MessageUtil.getMessage(MessageUtil.ERROR_REGIST_FAILED, "è¨å˚è⁄ç◊"),
						this.getTitle(),
						JOptionPane.ERROR_MESSAGE);
			}
		}
	}//GEN-LAST:event_addButtonActionPerformed

        private void cashMenuMouseReleased(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_cashMenuMouseReleased
		this.changeCurrentData();
        }//GEN-LAST:event_cashMenuMouseReleased

        private void cashMenuKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_cashMenuKeyReleased
		this.changeCurrentData();
        }//GEN-LAST:event_cashMenuKeyReleased
	
	
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton addButton;
    private javax.swing.JComboBox cashClass;
    private javax.swing.JLabel cashClassLabel;
    private javax.swing.JTable cashMenu;
    private com.geobeck.swing.JFormattedTextFieldEx cashMenuName;
    private javax.swing.JLabel cashMenuNameLabel;
    private javax.swing.JScrollPane cashMenuScrollPane;
    private javax.swing.JButton deleteButton;
    private com.geobeck.swing.JFormattedTextFieldEx displaySeq;
    private javax.swing.JLabel displaySeqLabel;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JButton renewButton;
    // End of variables declaration//GEN-END:variables
	/**
	 * è¨å˚è⁄ç◊ìoò^âÊñ ópFocusTraversalPolicy
	 */
	private	MstCashMenuFocusTraversalPolicy	ftp	=
			new MstCashMenuFocusTraversalPolicy();
	
	/**
	 * è¨å˚è⁄ç◊ìoò^âÊñ ópFocusTraversalPolicyÇéÊìæÇ∑ÇÈÅB
	 * @return è¨å˚è⁄ç◊ìoò^âÊñ ópFocusTraversalPolicy
	 */
    @Override
	public FocusTraversalPolicy getFocusTraversalPolicy()
	{
		return	ftp;
	}
	
	/**
	 * É{É^ÉìÇ…É}ÉEÉXÉJÅ[É\ÉãÇ™èÊÇ¡ÇΩÇ∆Ç´Ç…ÉJÅ[É\ÉãÇïœçXÇ∑ÇÈÉCÉxÉìÉgÇí«â¡Ç∑ÇÈÅB
	 */
	private void addMouseCursorChange()
	{
		SystemInfo.addMouseCursorChange(addButton);
		SystemInfo.addMouseCursorChange(renewButton);
		SystemInfo.addMouseCursorChange(deleteButton);
	}
	
	/**
	 * ÉRÉìÉ|Å[ÉlÉìÉgÇÃäeÉäÉXÉiÅ[ÇÉZÉbÉgÇ∑ÇÈÅB
	 */
	private void setListener()
	{
		cashClass.addKeyListener(SystemInfo.getMoveNextField());
		cashMenuName.addKeyListener(SystemInfo.getMoveNextField());
		cashMenuName.addFocusListener(SystemInfo.getSelectText());
		displaySeq.addKeyListener(SystemInfo.getMoveNextField());
		displaySeq.addFocusListener(SystemInfo.getSelectText());
	}
	
	/**
	 * èâä˙âªèàóùÇçsÇ§ÅB
	 */
	private void init()
	{
		if(0 < cashClass.getItemCount())
		{
			cashClass.setSelectedIndex(0);
		}
		
		this.refresh();
	}
	
	public boolean checkClassRegisted()
	{
		return	(0 < mkcs.size());
	}
	
	/**
	 * ï\é¶ÇçXêVÇ∑ÇÈÅB
	 */
	private void refresh()
	{
		if(0 <= cashClass.getSelectedIndex())
		{
			mkc	=	(MstCashClass)cashClass.getSelectedItem();
			
			//è¨å˚è⁄ç◊ÇÉfÅ[É^ÉxÅ[ÉXÇ©ÇÁì«Ç›çûÇﬁ
			try
			{
				ConnectionWrapper	con	=	SystemInfo.getConnection();

				mkc.loadCashMenu(con);
			}
			catch(SQLException e)
			{
				SystemInfo.getLogger().log(Level.SEVERE, e.getLocalizedMessage(), e);
			}
		}
		
		//ÉeÅ[ÉuÉãÇ…è¨å˚è⁄ç◊ÉfÅ[É^Çï\é¶Ç∑ÇÈ
		this.showData();
		//ì¸óÕÇÉNÉäÉAÇ∑ÇÈ
		this.clear();
		
		cashMenuName.requestFocusInWindow();
	}
	
	/**
	 * ì¸óÕçÄñ⁄ÇÉNÉäÉAÇ∑ÇÈÅB
	 */
	private void clear()
	{
		selIndex	=	-1;
		cashMenuName.setText("");
		displaySeq.setText("");
		
		if(0 < cashMenu.getRowCount())
				cashMenu.removeRowSelectionInterval(0, cashMenu.getRowCount() - 1);
		
		this.changeCurrentData();
	}
	
	/**
	 * ÉfÅ[É^Çï\é¶Ç∑ÇÈÅB
	 */
	private void showData()
	{
		SwingUtil.clearTable(cashMenu);
		DefaultTableModel	model	=	(DefaultTableModel)cashMenu.getModel();
		
		for(MstCashMenu mkd : mkc)
		{
			Object[]	rowData	=	{	mkd.getCashMenuName(),
                                                                mkd.getDisplaySeq()	};
			model.addRow(rowData);
		}
	}
	
	/**
	 * ëIëÉfÅ[É^Ç™ïœçXÇ≥ÇÍÇΩÇ∆Ç´ÇÃèàóùÇçsÇ§ÅB
	 */
	private void changeCurrentData()
	{
		int	index	=	cashMenu.getSelectedRow();
		
		if(0 <= index && index < mkc.size() && index != selIndex)
		{
			selIndex	=	index;
			
			//ëIëÇ≥ÇÍÇƒÇ¢ÇÈÉfÅ[É^Çï\é¶
			this.showCurrentData();
		}
		
		this.changeButtonEnabled(0 <= selIndex);
	}
	
	/**
	 * ëIëÇ≥ÇÍÇΩÉfÅ[É^Çì¸óÕçÄñ⁄Ç…ï\é¶Ç∑ÇÈÅB
	 */
	private void showCurrentData()
	{
		MstCashMenu	mkd	=	mkc.get(selIndex);
		
		cashMenuName.setText(mkd.getCashMenuName());
		displaySeq.setText(mkd.getDisplaySeq().toString());
	}
	
	/**
	 * É{É^ÉìÇÃEnabledÇïœçXÇ∑ÇÈÅB
	 * @param enabled Enabled
	 */
	private void changeButtonEnabled(boolean enabled)
	{
		//addButton.setEnabled(!enabled);
		renewButton.setEnabled(enabled);
		deleteButton.setEnabled(enabled);
	}
	
	/**
	 * ì¸óÕÉ`ÉFÉbÉNÇçsÇ§ÅB
	 * @return ì¸óÕÉGÉâÅ[Ç™Ç»ÇØÇÍÇŒtrueÇï‘Ç∑ÅB
	 */
	private boolean checkInput()
	{
		//è¨å˚çÄñ⁄
		if(cashClass.getSelectedIndex() < 0)
		{
			MessageDialog.showMessageDialog(this,
					MessageUtil.getMessage(MessageUtil.ERROR_INPUT_EMPTY, "è¨å˚çÄñ⁄"),
					this.getTitle(),
					JOptionPane.ERROR_MESSAGE);
			cashClass.requestFocusInWindow();
			return	false;
		}
		//è¨å˚è⁄ç◊ñº
		if(cashMenuName.getText().equals(""))
		{
			MessageDialog.showMessageDialog(this,
					MessageUtil.getMessage(MessageUtil.ERROR_INPUT_EMPTY, "è¨å˚è⁄ç◊ñº"),
					this.getTitle(),
					JOptionPane.ERROR_MESSAGE);
			cashMenuName.requestFocusInWindow();
			return	false;
		}
		
		return	true;
	}
	
	/**
	 * ëIëÇ≥ÇÍÇƒÇ¢ÇÈè¨å˚çÄñ⁄ÇhÇcÇÉZÉbÉgÇ∑ÇÈÅB
	 * @param cashClassID è¨å˚çÄñ⁄ÇhÇc
	 */
	public void setSelectedCashClassID(Integer cashClassID)
	{
		if(cashClassID == null)	return;
		
		for(MstCashClass mkc : mkcs)
		{
			if(cashClassID == mkc.getCashClassId())
			{
				cashClass.setSelectedItem(mkc);
				return;
			}
		}
	}
	
	
	/**
	 * ì¸óÕÇ≥ÇÍÇΩÉfÅ[É^Çìoò^Ç∑ÇÈÅB
	 * @param isAdd true - í«â¡èàóù
	 * @return true - ê¨å˜
	 */
	private boolean regist(boolean isAdd)
	{
		boolean		result	=	false;
		MstCashMenu		mkd		=	new MstCashMenu();
		
		if(!isAdd && 0 <= selIndex)
		{
			mkd.setData(mkc.get(selIndex));
		}
		
		this.setData(mkd);
		
		ConnectionWrapper	con	=	SystemInfo.getConnection();
		
		try
		{
			con.begin();
			
			if(mkd.regist(con, (0 < selIndex ? mkc.get(selIndex).getDisplaySeq() : -1)))
			{
                                result	=	true;
			}
			
			if(result)
			{
				con.commit();
			}
			else
			{
				con.rollback();
			}
		}
		catch(SQLException e)
		{
			SystemInfo.getLogger().log(Level.SEVERE, e.getLocalizedMessage(), e);
		}
		
		return	result;
	}
	
	/**
	 * è¨å˚è⁄ç◊ÉfÅ[É^Ç©ÇÁÉfÅ[É^ÇÉZÉbÉgÇ∑ÇÈÅB
	 * @param mkd è¨å˚è⁄ç◊ìoò^âÊñ ópFocusTraversalPolicy
	 */
	private void setData(MstCashMenu mkd)
	{
		mkd.setCashClass((MstCashClass)cashClass.getSelectedItem());
		mkd.setCashMenuName(cashMenuName.getText());
		mkd.setDisplaySeq((displaySeq.getText().equals("") ? -1 : Integer.parseInt(displaySeq.getText().replace(",", ""))));
	}
	
	/**
	 * ëIëÇ≥ÇÍÇΩÉfÅ[É^ÇçÌèúÇ∑ÇÈÅB
	 * @return true - ê¨å˜
	 */
	private boolean delete()
	{
		boolean		result	=	false;
		MstCashMenu		mkd	=	null;
		
		if(0 <= selIndex && selIndex < mkc.size())
		{
			mkd	=	mkc.get(selIndex);
		}
		
		ConnectionWrapper	con	=	SystemInfo.getConnection();
		
		try
		{
			con.begin();
			
			if(mkd.delete(con))
			{
				con.commit();
				this.refresh();
				result	=	true;
			}
			else
			{
				con.rollback();
			}
		}
		catch(SQLException e)
		{
			SystemInfo.getLogger().log(Level.SEVERE, e.getLocalizedMessage(), e);
		}
		
		return	result;
	}
	
	/**
	 * è¨å˚è⁄ç◊ìoò^âÊñ ópFocusTraversalPolicy
	 */
	private class MstCashMenuFocusTraversalPolicy
					extends FocusTraversalPolicy
	{
		/**
		 * aComponent ÇÃÇ†Ç∆Ç≈ÉtÉHÅ[ÉJÉXÇéÛÇØéÊÇÈ Component Çï‘ÇµÇ‹Ç∑ÅB
		 * aContainer ÇÕ aComponent ÇÃÉtÉHÅ[ÉJÉXÉTÉCÉNÉãÇÃÉãÅ[ÉgÇ‹ÇΩÇÕÉtÉHÅ[ÉJÉXÉgÉâÉoÅ[ÉTÉãÉ|ÉäÉVÅ[ÉvÉçÉoÉCÉ_Ç≈Ç»ÇØÇÍÇŒÇ»ÇËÇ‹ÇπÇÒÅB
		 * @param aContainer aComponent ÇÃÉtÉHÅ[ÉJÉXÉTÉCÉNÉãÇÃÉãÅ[ÉgÇ‹ÇΩÇÕÉtÉHÅ[ÉJÉXÉgÉâÉoÅ[ÉTÉãÉ|ÉäÉVÅ[ÉvÉçÉoÉCÉ_
		 * @param aComponent aContainer ÇÃÇ®ÇªÇÁÇ≠ä‘ê⁄ìIÇ»éqÅAÇ‹ÇΩÇÕ aContainer é©ëÃ
		 * @return aComponent ÇÃÇ†Ç∆Ç…ÉtÉHÅ[ÉJÉXÇéÛÇØéÊÇÈ ComponentÅBìKêÿÇ» Component Ç™å©Ç¬Ç©ÇÁÇ»Ç¢èÍçáÇÕ null
		 */
		public Component getComponentAfter(Container aContainer,
										   Component aComponent)
		{
			if (aComponent.equals(cashClass))
			{
				return cashMenuName;
			}
			else if (aComponent.equals(cashMenuName))
			{
				return displaySeq;
			}
			else if (aComponent.equals(displaySeq))
			{
				return cashClass;
			}
			
			return cashClass;
		}

		/**
		 * aComponent ÇÃëOÇ…ÉtÉHÅ[ÉJÉXÇéÛÇØéÊÇÈ Component Çï‘ÇµÇ‹Ç∑ÅB
		 * aContainer ÇÕ aComponent ÇÃÉtÉHÅ[ÉJÉXÉTÉCÉNÉãÇÃÉãÅ[ÉgÇ‹ÇΩÇÕÉtÉHÅ[ÉJÉXÉgÉâÉoÅ[ÉTÉãÉ|ÉäÉVÅ[ÉvÉçÉoÉCÉ_Ç≈Ç»ÇØÇÍÇŒÇ»ÇËÇ‹ÇπÇÒÅB
		 * @param aContainer aComponent ÇÃÉtÉHÅ[ÉJÉXÉTÉCÉNÉãÇÃÉãÅ[ÉgÇ‹ÇΩÇÕÉtÉHÅ[ÉJÉXÉgÉâÉoÅ[ÉTÉãÉ|ÉäÉVÅ[ÉvÉçÉoÉCÉ_
		 * @param aComponent aContainer ÇÃÇ®ÇªÇÁÇ≠ä‘ê⁄ìIÇ»éqÅAÇ‹ÇΩÇÕ aContainer é©ëÃ
		 * @return aComponent ÇÃëOÇ…ÉtÉHÅ[ÉJÉXÇéÛÇØéÊÇÈ ComponentÅBìKêÿÇ» Component Ç™å©Ç¬Ç©ÇÁÇ»Ç¢èÍçáÇÕ null
		 */
		public Component getComponentBefore(Container aContainer,
											Component aComponent)
		{
			if (aComponent.equals(cashClass))
			{
				return displaySeq;
			}
			else if (aComponent.equals(cashMenuName))
			{
				return cashClass;
			}
			else if (aComponent.equals(displaySeq))
			{
				return cashMenuName;
			}
			
			return cashClass;
		}

		/**
		 * ÉgÉâÉoÅ[ÉTÉãÉTÉCÉNÉãÇÃç≈èâÇÃ Component Çï‘ÇµÇ‹Ç∑ÅB
		 * Ç±ÇÃÉÅÉ\ÉbÉhÇÕÅAèáï˚å¸ÇÃÉgÉâÉoÅ[ÉTÉãÇ™ÉâÉbÉvÇ∑ÇÈÇ∆Ç´Ç…ÅAéüÇ…ÉtÉHÅ[ÉJÉXÇ∑ÇÈ Component ÇîªíËÇ∑ÇÈÇΩÇﬂÇ…égópÇµÇ‹Ç∑ÅB
		 * @param aContainer êÊì™ÇÃ Component Çï‘Ç∑ÉtÉHÅ[ÉJÉXÉTÉCÉNÉãÇÃÉãÅ[ÉgÇ‹ÇΩÇÕÉtÉHÅ[ÉJÉXÉgÉâÉoÅ[ÉTÉãÉ|ÉäÉVÅ[ÉvÉçÉoÉCÉ_
		 * @return aContainer ÇÃÉgÉâÉoÅ[ÉTÉãÉTÉCÉNÉãÇÃêÊì™ÇÃ ComponetÅAÇ‹ÇΩÇÕìKêÿÇ» Component Ç™å©Ç¬Ç©ÇÁÇ»Ç¢èÍçáÇÕ null
		 */
		public Component getFirstComponent(Container aContainer)
		{
			return cashClass;
		}

		/**
		 * ÉgÉâÉoÅ[ÉTÉãÉTÉCÉNÉãÇÃç≈å„ÇÃ Component Çï‘ÇµÇ‹Ç∑ÅB
		 * Ç±ÇÃÉÅÉ\ÉbÉhÇÕÅAãtï˚å¸ÇÃÉgÉâÉoÅ[ÉTÉãÇ™ÉâÉbÉvÇ∑ÇÈÇ∆Ç´Ç…ÅAéüÇ…ÉtÉHÅ[ÉJÉXÇ∑ÇÈ Component ÇîªíËÇ∑ÇÈÇΩÇﬂÇ…égópÇµÇ‹Ç∑ÅB
		 * @param aContainer aContainer - ç≈å„ÇÃ Component Çï‘Ç∑ÉtÉHÅ[ÉJÉXÉTÉCÉNÉãÇÃÉãÅ[ÉgÇ‹ÇΩÇÕÉtÉHÅ[ÉJÉXÉgÉâÉoÅ[ÉTÉãÉ|ÉäÉVÅ[ÉvÉçÉoÉCÉ_
		 * @return aContainer ÇÃÉgÉâÉoÅ[ÉTÉãÉTÉCÉNÉãÇÃç≈å„ÇÃ ComponetÅAÇ‹ÇΩÇÕìKêÿÇ» Component Ç™å©Ç¬Ç©ÇÁÇ»Ç¢èÍçáÇÕ null
		 */
		public Component getLastComponent(Container aContainer)
		{
			return displaySeq;
		}

		/**
		 * ÉtÉHÅ[ÉJÉXÇê›íËÇ∑ÇÈÉfÉtÉHÉãÉgÉRÉìÉ|Å[ÉlÉìÉgÇï‘ÇµÇ‹Ç∑ÅB
		 * aContainer ÇÉãÅ[ÉgÇ∆Ç∑ÇÈÉtÉHÅ[ÉJÉXÉgÉâÉoÅ[ÉTÉãÉTÉCÉNÉãÇ™êVÇµÇ≠äJénÇ≥ÇÍÇΩÇ∆Ç´Ç…ÅAÇ±ÇÃÉRÉìÉ|Å[ÉlÉìÉgÇ…ç≈èâÇ…ÉtÉHÅ[ÉJÉXÇ™ê›íËÇ≥ÇÍÇ‹Ç∑ÅB
		 * @param aContainer ÉfÉtÉHÉãÉgÇÃ Component Çï‘Ç∑ÉtÉHÅ[ÉJÉXÉTÉCÉNÉãÇÃÉãÅ[ÉgÇ‹ÇΩÇÕÉtÉHÅ[ÉJÉXÉgÉâÉoÅ[ÉTÉãÉ|ÉäÉVÅ[ÉvÉçÉoÉCÉ_
		 * @return aContainer ÇÃÉgÉâÉoÅ[ÉTÉãÉTÉCÉNÉãÇÃÉfÉtÉHÉãÉgÇÃ ComponetÅAÇ‹ÇΩÇÕìKêÿÇ» Component Ç™å©Ç¬Ç©ÇÁÇ»Ç¢èÍçáÇÕ null
		 */
		public Component getDefaultComponent(Container aContainer)
		{
			return cashClass;
		}
		
		/**
		 * ÉEÉBÉìÉhÉEÇ™ç≈èâÇ…ï\é¶Ç≥ÇÍÇΩÇ∆Ç´Ç…ÉtÉHÅ[ÉJÉXÇ™ê›íËÇ≥ÇÍÇÈÉRÉìÉ|Å[ÉlÉìÉgÇï‘ÇµÇ‹Ç∑ÅB
		 * show() Ç‹ÇΩÇÕ setVisible(true) ÇÃåƒÇ—èoÇµÇ≈àÍìxÉEÉBÉìÉhÉEÇ™ï\é¶Ç≥ÇÍÇÈÇ∆ÅA
		 * èâä˙âªÉRÉìÉ|Å[ÉlÉìÉgÇÕÇªÇÍà»ç~égópÇ≥ÇÍÇ‹ÇπÇÒÅB
		 * àÍìxï ÇÃÉEÉBÉìÉhÉEÇ…à⁄Ç¡ÇΩÉtÉHÅ[ÉJÉXÇ™çƒÇ—ê›íËÇ≥ÇÍÇΩèÍçáÅA
		 * Ç‹ÇΩÇÕÅAàÍìxîÒï\é¶èÛë‘Ç…Ç»Ç¡ÇΩÉEÉBÉìÉhÉEÇ™çƒÇ—ï\é¶Ç≥ÇÍÇΩèÍçáÇÕÅA
		 * ÇªÇÃÉEÉBÉìÉhÉEÇÃç≈å„Ç…ÉtÉHÅ[ÉJÉXÇ™ê›íËÇ≥ÇÍÇΩÉRÉìÉ|Å[ÉlÉìÉgÇ™ÉtÉHÅ[ÉJÉXèäóLé“Ç…Ç»ÇËÇ‹Ç∑ÅB
		 * Ç±ÇÃÉÅÉ\ÉbÉhÇÃÉfÉtÉHÉãÉgé¿ëïÇ≈ÇÕÉfÉtÉHÉãÉgÉRÉìÉ|Å[ÉlÉìÉgÇï‘ÇµÇ‹Ç∑ÅB
		 * @param window èâä˙ÉRÉìÉ|Å[ÉlÉìÉgÇ™ï‘Ç≥ÇÍÇÈÉEÉBÉìÉhÉE
		 * @return ç≈èâÇ…ÉEÉBÉìÉhÉEÇ™ï\é¶Ç≥ÇÍÇÈÇ∆Ç´Ç…ÉtÉHÅ[ÉJÉXê›íËÇ≥ÇÍÇÈÉRÉìÉ|Å[ÉlÉìÉgÅBìKêÿÇ»ÉRÉìÉ|Å[ÉlÉìÉgÇ™Ç»Ç¢èÍçáÇÕ null
		 */
        @Override
		public Component getInitialComponent(Window window)
		{
			return cashClass;
		}
	}
	
	
	/**
	 * JTableÇÃóÒïùÇèâä˙âªÇ∑ÇÈÅB
	 */
	private void initTableColumnWidth()
	{
		//óÒÇÃïùÇê›íËÇ∑ÇÈÅB
		cashMenu.getColumnModel().getColumn(0).setPreferredWidth(240);
		cashMenu.getColumnModel().getColumn(1).setPreferredWidth(50);
	}
	
	/**
	 * óÒÇÃï\é¶à íuÇê›íËÇ∑ÇÈTableCellRenderer
	 */
	private class TableCellAlignRenderer extends DefaultTableCellRenderer
	{
		/** Creates a new instance of ReservationTableCellRenderer */
		public TableCellAlignRenderer()
		{
			super();
		}

		/**
		 * ÉeÅ[ÉuÉãÉZÉãÉåÉìÉ_ÉäÉìÉOÇï‘ÇµÇ‹Ç∑ÅB
		 * @param table JTable
		 * @param value ÉZÉãÇ…äÑÇËìñÇƒÇÈíl
		 * @param isSelected ÉZÉãÇ™ëIëÇ≥ÇÍÇƒÇ¢ÇÈèÍçáÇÕ true
		 * @param hasFocus ÉtÉHÅ[ÉJÉXÇ™Ç†ÇÈèÍçáÇÕ true
		 * @param row çs
		 * @param column óÒ
		 * @return ÉeÅ[ÉuÉãÉZÉãÉåÉìÉ_ÉäÉìÉO
		 */
        @Override
		public Component getTableCellRendererComponent(JTable table,
				Object value, boolean isSelected, boolean hasFocus, int row, int column)
		{
			super.getTableCellRendererComponent(table, value,
					isSelected, hasFocus, row, column);
			
			switch(column)
			{
				case 1:
					super.setHorizontalAlignment(SwingConstants.RIGHT);
					break;
				default:
					super.setHorizontalAlignment(SwingConstants.LEFT);
					break;
			}

			return this;
		}
	}
}
