/*
 * MstBedPanel.java
 *
 * Created on 2006/10/20, 10:16
 */

package com.geobeck.sosia.pos.hair.basicinfo.company;

import com.geobeck.sosia.pos.hair.master.company.*;
import com.geobeck.sosia.pos.system.SystemInfo;
import java.awt.*;
import javax.swing.*;
import javax.swing.table.*;
import javax.swing.text.*;
import java.sql.*;
import java.util.logging.*;

import com.geobeck.sql.*;
import com.geobeck.swing.*;
import com.geobeck.util.*;
import com.geobeck.sosia.pos.master.company.*;
import com.geobeck.sosia.pos.util.*;
import com.geobeck.sosia.pos.swing.*;
import java.awt.event.HierarchyEvent;

/**
 *
 * @author  katagiri
 */
public class MstBedPanel extends com.geobeck.sosia.pos.swing.AbstractImagePanelEx
{
	private MstBeds		mbs			=	new MstBeds();
	private Integer		selIndex	=	-1;
        
    //IVS_LVTu start add 2017/08/15 #21596 [gb] マスタ登録のあと再起動アラートを出す
    private boolean isLoadDisplay= false;
    //IVS_LVTu end add 2017/08/15 #21596 [gb] マスタ登録のあと再起動アラートを出す
        //VUINV start add 20140707 MASHU_施術台登録      
        
        private MstShopCategorys categories = new MstShopCategorys();
        
        //＃mst_shop.use_shop_category=1
        //の場合のみ表示
        private Integer useShopCategory = 1;
        //VUINV end add 20140707 MASHU_施術台登録
	
	/** Creates new form MstBedPanel */
	public MstBedPanel()
	{
		super();
		initComponents();
		addMouseCursorChange();
                // IVS VUINV start edit 20140703 MASHU_施術台登録
		//this.setSize(476, 680);
                this.setSize(820, 680);
		// IVS VUINV end edit 20140703 MASHU_施術台登録
                this.setPath("基本設定 >> 会社マスタ");
		this.setTitle("施術台登録");
		this.setListener();
		SystemInfo.initGroupShopComponents(shop, 2);
                
                //VUINV start add 20140707 MASHU_施術台登録
                //＃mst_shop.use_shop_category=1
                //の場合のみ表示
                this.useShopCategory = ((MstShop) shop.getSelectedItem()).getUseShopCategory();
                //VUINV end add 20140707 MASHU_施術台登録
                
		this.init();
	}
	
	/** This method is called from within the constructor to
	 * initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is
	 * always regenerated by the Form Editor.
	 */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        renewButton = new javax.swing.JButton();
        bedName = new com.geobeck.swing.JFormattedTextFieldEx();
        ((PlainDocument)bedName.getDocument()).setDocumentFilter(
            new CustomFilter(15));
        bedsScrollPane = new javax.swing.JScrollPane();
        beds = new javax.swing.JTable();
        displaySeqLabel = new javax.swing.JLabel();
        bedNameLabel = new javax.swing.JLabel();
        bedNumLabel = new javax.swing.JLabel();
        displaySeq = new com.geobeck.swing.JFormattedTextFieldEx();
        ((PlainDocument)displaySeq.getDocument()).setDocumentFilter(
            new CustomFilter(4, CustomFilter.NUMERIC));
        deleteButton = new javax.swing.JButton();
        addButton = new javax.swing.JButton();
        bedNum = new com.geobeck.swing.JFormattedTextFieldEx();
        ((PlainDocument)bedNum.getDocument()).setDocumentFilter(
            new CustomFilter(3, CustomFilter.NUMERIC));
        shopLabel = new javax.swing.JLabel();
        shop = new com.geobeck.sosia.pos.swing.JComboBoxLabel();
        bedsScrollPane1 = new javax.swing.JScrollPane();
        businessCategory = new com.geobeck.swing.JTableEx();
        businessCategoryLabel = new javax.swing.JLabel();

        setFocusCycleRoot(true);
        addHierarchyListener(new java.awt.event.HierarchyListener() {
            public void hierarchyChanged(java.awt.event.HierarchyEvent evt) {
                formHierarchyChanged(evt);
            }
        });

        renewButton.setIcon(SystemInfo.getImageIcon("/button/common/update_off.jpg"));
        renewButton.setBorderPainted(false);
        renewButton.setContentAreaFilled(false);
        renewButton.setEnabled(false);
        renewButton.setPressedIcon(SystemInfo.getImageIcon("/button/common/update_on.jpg"));
        renewButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                renewButtonActionPerformed(evt);
            }
        });

        bedName.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        bedName.setColumns(15);
        bedName.setInputKanji(true);

        bedsScrollPane.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));

        beds.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null}
            },
            new String [] {
                "施術台名", "床数", "表示順", "業態"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.String.class, java.lang.Integer.class, java.lang.Integer.class, java.lang.String.class
            };
            boolean[] canEdit = new boolean [] {
                false, false, false, false
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        beds.setSelectionBackground(new java.awt.Color(220, 220, 220));
        beds.setSelectionForeground(new java.awt.Color(0, 0, 0));
        beds.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
        beds.getTableHeader().setReorderingAllowed(false);
        SwingUtil.setJTableHeaderRenderer(beds, SystemInfo.getTableHeaderRenderer());
        beds.setRowHeight(SystemInfo.TABLE_ROW_HEIGHT);
        this.initTableColumnWidth();
        SelectTableCellRenderer.setSelectTableCellRenderer(beds);
        beds.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                bedsFocusGained(evt);
            }
        });
        beds.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseReleased(java.awt.event.MouseEvent evt) {
                bedsMouseReleased(evt);
            }
        });
        beds.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                bedsKeyReleased(evt);
            }
        });
        bedsScrollPane.setViewportView(beds);

        displaySeqLabel.setText("挿入位置");

        bedNameLabel.setText("施術台名");

        bedNumLabel.setText("床数");

        displaySeq.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        displaySeq.setHorizontalAlignment(javax.swing.JTextField.RIGHT);

        deleteButton.setIcon(SystemInfo.getImageIcon("/button/common/delete_off.jpg"));
        deleteButton.setBorderPainted(false);
        deleteButton.setContentAreaFilled(false);
        deleteButton.setEnabled(false);
        deleteButton.setPressedIcon(SystemInfo.getImageIcon("/button/common/delete_on.jpg"));
        deleteButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                deleteButtonActionPerformed(evt);
            }
        });

        addButton.setIcon(SystemInfo.getImageIcon("/button/common/insert_off.jpg"));
        addButton.setBorderPainted(false);
        addButton.setContentAreaFilled(false);
        addButton.setPressedIcon(SystemInfo.getImageIcon("/button/common/insert_on.jpg"));
        addButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                addButtonActionPerformed(evt);
            }
        });

        bedNum.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        bedNum.setHorizontalAlignment(javax.swing.JTextField.RIGHT);

        shopLabel.setText("店舗");

        shop.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        shop.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                shopActionPerformed(evt);
            }
        });

        bedsScrollPane1.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));

        businessCategory.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null}
            },
            new String [] {
                "業態名", "選択"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.String.class, java.lang.Object.class
            };
            boolean[] canEdit = new boolean [] {
                false, true
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        businessCategory.setSelectionBackground(new java.awt.Color(220, 220, 220));
        businessCategory.setSelectionForeground(new java.awt.Color(0, 0, 0));
        businessCategory.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
        businessCategory.getTableHeader().setReorderingAllowed(false);
        SwingUtil.setJTableHeaderRenderer(businessCategory, SystemInfo.getTableHeaderRenderer());
        businessCategory.setRowHeight(SystemInfo.TABLE_ROW_HEIGHT);
        this.initTableBisinessCategoryColumnWidth();
        SelectTableCellRenderer.setSelectTableCellRenderer(businessCategory);
        businessCategory.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                businessCategoryFocusLost(evt);
            }
        });
        businessCategory.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseReleased(java.awt.event.MouseEvent evt) {
                businessCategoryMouseReleased(evt);
            }
        });
        businessCategory.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                businessCategoryKeyReleased(evt);
            }
        });
        bedsScrollPane1.setViewportView(businessCategory);

        businessCategoryLabel.setText("業態");

        org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(layout.createSequentialGroup()
                .addContainerGap()
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(org.jdesktop.layout.GroupLayout.TRAILING, bedsScrollPane, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 819, Short.MAX_VALUE)
                    .add(layout.createSequentialGroup()
                        .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                            .add(bedNameLabel)
                            .add(bedNumLabel)
                            .add(shopLabel)
                            .add(businessCategoryLabel))
                        .add(14, 14, 14)
                        .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                            .add(layout.createSequentialGroup()
                                .add(shop, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 307, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                .add(0, 0, Short.MAX_VALUE))
                            .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
                                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                                    .add(bedName, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                    .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
                                        .add(bedNum, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 71, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .add(displaySeqLabel)
                                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                        .add(displaySeq, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 67, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                                    .add(org.jdesktop.layout.GroupLayout.TRAILING, bedsScrollPane1))
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(addButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 92, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(renewButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 92, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(deleteButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 92, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(layout.createSequentialGroup()
                .addContainerGap()
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(shopLabel)
                    .add(shop, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 24, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(bedNameLabel)
                    .add(bedName, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 24, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .add(7, 7, 7)
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(bedNumLabel)
                    .add(bedNum, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 24, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(displaySeq, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 24, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(displaySeqLabel))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                    .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                        .add(businessCategoryLabel)
                        .add(bedsScrollPane1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 154, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                    .add(addButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(renewButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(deleteButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(bedsScrollPane, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 269, Short.MAX_VALUE)
                .addContainerGap())
        );
    }// </editor-fold>//GEN-END:initComponents

	private void shopActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_shopActionPerformed
	{//GEN-HEADEREND:event_shopActionPerformed
		this.init();
                
                //VUINV start add 20140714 MASHU_施術台登録
                //入力をクリアする
		this.clear();
                //VUINV end add 20140714 MASHU_施術台登録
                
	}//GEN-LAST:event_shopActionPerformed

	private void deleteButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_deleteButtonActionPerformed
	{//GEN-HEADEREND:event_deleteButtonActionPerformed
            //VUINV start add 20140708 MASHU_施術台登録
            if (businessCategory.getCellEditor() != null) {
                businessCategory.getCellEditor().stopCellEditing();
            }
            //VUINV end add 20140708 MASHU_施術台登録
            
            this.delete();
	}//GEN-LAST:event_deleteButtonActionPerformed

	private void renewButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_renewButtonActionPerformed
	{//GEN-HEADEREND:event_renewButtonActionPerformed
            //VUINV start add 20140708 MASHU_施術台登録
            if (businessCategory.getCellEditor() != null) {
                businessCategory.getCellEditor().stopCellEditing();
            }
            //VUINV end add 20140708 MASHU_施術台登録
            //入力チェック
		if(this.checkInput())
		{
			//登録処理
			this.regist(false);
			this.refresh();
		}
	}//GEN-LAST:event_renewButtonActionPerformed

	private void addButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_addButtonActionPerformed
	{//GEN-HEADEREND:event_addButtonActionPerformed
                //VUINV start add 20140708 MASHU_施術台登録
                if (businessCategory.getCellEditor() != null) {
                    businessCategory.getCellEditor().stopCellEditing();
                }
                //VUINV end add 20140708 MASHU_施術台登録

                //入力チェック
		if(this.checkInput())
		{
			//登録処理
			this.regist(true);
			this.refresh();
		}
	}//GEN-LAST:event_addButtonActionPerformed

	private void bedsMouseReleased(java.awt.event.MouseEvent evt)//GEN-FIRST:event_bedsMouseReleased
	{//GEN-HEADEREND:event_bedsMouseReleased
		this.changeCurrentData();
	}//GEN-LAST:event_bedsMouseReleased

	private void bedsKeyReleased(java.awt.event.KeyEvent evt)//GEN-FIRST:event_bedsKeyReleased
	{//GEN-HEADEREND:event_bedsKeyReleased
		this.changeCurrentData();
	}//GEN-LAST:event_bedsKeyReleased

    private void businessCategoryMouseReleased(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_businessCategoryMouseReleased
        // TODO add your handling code here:
    }//GEN-LAST:event_businessCategoryMouseReleased

    private void businessCategoryKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_businessCategoryKeyReleased
        // TODO add your handling code here:
    }//GEN-LAST:event_businessCategoryKeyReleased

    private void businessCategoryFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_businessCategoryFocusLost
        
    }//GEN-LAST:event_businessCategoryFocusLost

    private void bedsFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_bedsFocusGained
        if (businessCategory.getCellEditor() != null) {
            businessCategory.getCellEditor().stopCellEditing();
        }
    }//GEN-LAST:event_bedsFocusGained

    private void formHierarchyChanged(java.awt.event.HierarchyEvent evt) {//GEN-FIRST:event_formHierarchyChanged
        //IVS_LVTu start add 2017/08/15 #21596 [gb] マスタ登録のあと再起動アラートを出す  
        if ((evt.getChangeFlags() & HierarchyEvent.SHOWING_CHANGED) != 0) {
            if (!evt.getComponent().isDisplayable() && isLoadDisplay) {
                SystemInfo.MessageDialogGB(this, this.getTitle());
            }
        }
        //IVS_LVTu end add 2017/08/15 #21596 [gb] マスタ登録のあと再起動アラートを出す
    }//GEN-LAST:event_formHierarchyChanged
	
	
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton addButton;
    private com.geobeck.swing.JFormattedTextFieldEx bedName;
    private javax.swing.JLabel bedNameLabel;
    private com.geobeck.swing.JFormattedTextFieldEx bedNum;
    private javax.swing.JLabel bedNumLabel;
    private javax.swing.JTable beds;
    private javax.swing.JScrollPane bedsScrollPane;
    private javax.swing.JScrollPane bedsScrollPane1;
    private javax.swing.JTable businessCategory;
    private javax.swing.JLabel businessCategoryLabel;
    private javax.swing.JButton deleteButton;
    private com.geobeck.swing.JFormattedTextFieldEx displaySeq;
    private javax.swing.JLabel displaySeqLabel;
    private javax.swing.JButton renewButton;
    private com.geobeck.sosia.pos.swing.JComboBoxLabel shop;
    private javax.swing.JLabel shopLabel;
    // End of variables declaration//GEN-END:variables
	
	/**
	 * ベッドマスタ登録画面用FocusTraversalPolicy
	 */
	private	MstBedFocusTraversalPolicy	ftp	=
			new MstBedFocusTraversalPolicy();
	
	/**
	 * ベッドマスタ登録画面用FocusTraversalPolicyを取得する。
	 * @return ベッドマスタ登録画面用FocusTraversalPolicy
	 */
	public MstBedFocusTraversalPolicy getFocusTraversalPolicy()
	{
		return	ftp;
	}
	
	/**
	 * ボタンにマウスカーソルが乗ったときにカーソルを変更するイベントを追加する。
	 */
	private void addMouseCursorChange()
	{
		SystemInfo.addMouseCursorChange(addButton);
		SystemInfo.addMouseCursorChange(renewButton);
		SystemInfo.addMouseCursorChange(deleteButton);
	}
	
	/**
	 * コンポーネントの各リスナーをセットする。
	 */
	private void setListener()
	{
		bedName.addKeyListener(SystemInfo.getMoveNextField());
		bedName.addFocusListener(SystemInfo.getSelectText());
		bedNum.addKeyListener(SystemInfo.getMoveNextField());
		bedNum.addFocusListener(SystemInfo.getSelectText());
		displaySeq.addKeyListener(SystemInfo.getMoveNextField());
		displaySeq.addFocusListener(SystemInfo.getSelectText());
	}
	
	/**
	 * 初期化処理を行う。
	 */
	private void init()
	{
                //VUINV start add 20140707 MASHU_施術台登録
                this.useShopCategory = ((MstShop) shop.getSelectedItem()).getUseShopCategory();
                if (useShopCategory != 1) {
                    businessCategoryLabel.setVisible(false);
                    bedsScrollPane1.setVisible(false);
                } else {
                    businessCategoryLabel.setVisible(true);
                    bedsScrollPane1.setVisible(true);
                }
                SwingUtil.clearTable(beds);
                initTableColumnWidth();
                //VUINV end add 20140707 MASHU_施術台登録
                
		mbs.setShop((MstShop)shop.getSelectedItem());
		try
		{
			ConnectionWrapper	con	=	SystemInfo.getConnection();
			
			mbs.load(con);
                        
		}
		catch(SQLException e)
		{
			SystemInfo.getLogger().log(Level.SEVERE, e.getLocalizedMessage(), e);
		}
		
		this.showData();
	}
	
	/**
	 * 再表示を行う。
	 */
	private void refresh()
	{
		//データベースからデータを読み込む
		try
		{
			ConnectionWrapper	con	=	SystemInfo.getConnection();
			
			mbs.load(con);
		}
		catch(SQLException e)
		{
			SystemInfo.getLogger().log(Level.SEVERE, e.getLocalizedMessage(), e);
		}
		//テーブルに商品区分マスタデータを表示する
		this.showData();
		//入力をクリアする
		this.clear();
	}
	
	/**
	 * 入力項目をクリアする。
	 */
	private void clear()
	{
		selIndex	=	-1;
		bedName.setText("");
		bedNum.setText("");
		displaySeq.setText("");
		
		if(0 < beds.getRowCount())
				beds.removeRowSelectionInterval(0, beds.getRowCount() - 1);
		
		this.changeCurrentData();
	}
	
	
	/**
	 * データを表示する。
	 */
	private void showData()
	{
		DefaultTableModel	model	=	(DefaultTableModel)beds.getModel();
		
		//全行削除
		model.setRowCount(0);
		beds.removeAll();
		for(MstBed mb : mbs)
		{
                        //IVS VUINV start edit 20140703 MASHU_施術台登録
                        if (useShopCategory != 1) {
                            Object[]	rowData	=	{	mb.getBedName(),
										mb.getBedNum(),
										mb.getDisplaySeq()	};
                            model.addRow(rowData);
                        } else {
                            Object[]	rowData	=	{	mb.getBedName(),
										mb.getBedNum(),
										mb.getDisplaySeq(),
                                                                                mb.getBusinessCategory() };
                            model.addRow(rowData);
                        }
                        //IVS VUINV end edit 20140703 MASHU_施術台登録
		}
                //IVS_Nhanvt start edit Merge 20140821 MASHU_施術台登録
                //IVS VUINV start add 20140703 MASHU_施術台登録
                //initTableColumnWidth();
                if (useShopCategory == 1) {
                    showBusinessCategory();
                }
                //IVS VUINV end add 20140703 MASHU_施術台登録
                //IVS_Nhanvt end edit Merge 20140821 MASHU_施術台登録
                
	}
        
        //IVS VUINV start add 20140708 MASHU_施術台登録
        private void showBusinessCategory(){
            try {
                DefaultTableModel	model	=	(DefaultTableModel)businessCategory.getModel();
                model.setRowCount(0);
                businessCategory.removeAll();
                
                ConnectionWrapper	con	=	SystemInfo.getConnection();

                categories.loadBusinessCategory(con, ((MstShop) shop.getSelectedItem()).getShopID(), ((selIndex != -1 && mbs.size() > selIndex) ? mbs.get(selIndex).getBedID() : 0));
                
                for(MstShopCategory msc : categories) {
                    Object[]	rowData	=	{ msc.getShopClassName(), getBCSelect(msc.isIsCheck()) };
                    model.addRow(rowData);
                }
                
            } catch (SQLException ex) {
                Logger.getLogger(MstBedPanel.class.getName()).log(Level.SEVERE, null, ex);
            }
        }
        //IVS VUINV end add 20140708 MASHU_施術台登録
        
        //IVS VUINV start add 20140703 MASHU_施術台登録
        /**
        * get checkbox
        */
        private JCheckBox getBCSelect(boolean isCheck) {
            JCheckBox checkBox = new JCheckBox();
            checkBox.setSelected(isCheck);

            checkBox.setOpaque(false);
            checkBox.setHorizontalAlignment(SwingConstants.CENTER);
            return checkBox;
        }
        //IVS VUINV end add 20140703 MASHU_施術台登録
	
	/**
	 * 選択データが変更されたときの処理を行う。
	 */
	private void changeCurrentData()
	{
		int	index	=	beds.getSelectedRow();
		
		if(0 <= index && index < mbs.size() && index != selIndex)
		{
			selIndex	=	index;
			//選択されているデータを表示
			this.showCurrentData();
		}
                
                //IVS VUINV start add 20140707 MASHU_施術台登録
                if (useShopCategory == 1) {
                    showBusinessCategory();
                }
                //IVS VUINV end add 20140707 MASHU_施術台登録
		
		//ボタンの使用可不可を変更する
		renewButton.setEnabled(0 <= selIndex);
		deleteButton.setEnabled(0 <= selIndex);
	}
	
	/**
	 * 選択されたデータを入力項目に表示する。
	 */
	private void showCurrentData()
	{
		bedName.setText(mbs.get(selIndex).getBedName());
		bedNum.setText(mbs.get(selIndex).getBedNum().toString());
		displaySeq.setText(mbs.get(selIndex).getDisplaySeq().toString());
	}
	
	/**
	 * 入力チェックを行う。
	 * @return 入力エラーがなければtrueを返す。
	 */
	private boolean checkInput()
	{
		//ベッド名
		if(bedName.getText().equals(""))
		{
			MessageDialog.showMessageDialog(this,
					MessageUtil.getMessage(MessageUtil.ERROR_INPUT_EMPTY, "施術台名"),
					this.getTitle(),
					JOptionPane.ERROR_MESSAGE);
			bedName.requestFocusInWindow();
			return	false;
		}
                //IVS_LVTu start add 2014/07/31 Mashu_施術台登録
		if(displaySeq.getText().equals("0"))
		{
			MessageDialog.showMessageDialog(this,
					"挿入位置は 1 以上を指定してください。",
					this.getTitle(),
					JOptionPane.ERROR_MESSAGE);
			displaySeq.requestFocusInWindow();
			return	false;
		}
                //IVS_LVTu end add 2014/07/31 Mashu_施術台登録
		//床数
		if(!CheckUtil.isNumber(bedNum.getText()))
		{
			MessageDialog.showMessageDialog(this,
					MessageUtil.getMessage(MessageUtil.ERROR_INPUT_WRONG, "床数"),
					this.getTitle(),
					JOptionPane.ERROR_MESSAGE);
			bedNum.requestFocusInWindow();
			return	false;
		}
		
		//挿入位置
		if(!displaySeq.getText().equals("") && !CheckUtil.isNumber(displaySeq.getText()))
		{
			MessageDialog.showMessageDialog(this,
					MessageUtil.getMessage(MessageUtil.ERROR_INPUT_WRONG, "挿入位置"),
					this.getTitle(),
					JOptionPane.ERROR_MESSAGE);
			displaySeq.requestFocusInWindow();
			return	false;
		}
		
		return	true;
	}
	
	
	/**
	 * 入力されたデータを登録する。
	 * @param isAdd true - 追加処理
	 * @return true - 成功
	 */
	private boolean regist(boolean isAdd)
	{
		boolean		result	=	false;
		MstBed		mb		=	null;
		int			lastSeq	=	-1;
		
		if(isAdd || selIndex < 0)
		{
			mb	=	new MstBed();
		}
		else
		{
			lastSeq	=	mbs.get(selIndex).getDisplaySeq();
			mb		=	mbs.get(selIndex);
		}
		
		//入力されたデータをセットする
		mb.setShop(mbs.getShop());
		mb.setBedName(bedName.getText());
		mb.setBedNum(Integer.parseInt(bedNum.getText()));
		mb.setDisplaySeq((displaySeq.getText().equals("") ? -1 : Integer.parseInt(displaySeq.getText())));
		
		try
		{
			ConnectionWrapper	con	=	SystemInfo.getConnection();
			
			try
			{
				con.begin();
                                
                                //IVS VUINV start add 20140708 MASHU_施術台登録
                                if (!isAdd && selIndex > - 1 && useShopCategory == 1) {
                                    MstBedRelation mbr = new MstBedRelation();
                                    mbr.setShopID(((MstShop) shop.getSelectedItem()).getShopID());
                                    mbr.setBedID(mbs.get(selIndex).getBedID());
                                    mbr.delete(con);
                                    
                                    for (int i = 0; i < categories.size(); i++) {
                                        
                                        if (((JCheckBox) businessCategory.getValueAt(i, 1)).isSelected()) {
                                            mbr = new MstBedRelation();
                                            mbr.setShopID(((MstShop) shop.getSelectedItem()).getShopID());
                                            mbr.setBedID(mbs.get(selIndex).getBedID());
                                            mbr.setShopCategoryID(categories.get(i).getShopCategoryId());
                                            mbr.insert(con);
                                        }
                                        
                                    }
                                    
                                }
                                
                                //IVS VUINV end add 20140708 MASHU_施術台登録
				
				if(mb.regist(con, lastSeq))
				{
                                        //IVS VUINV start add 20140708 MASHU_施術台登録
                                    
                                        if (isAdd) {
                                            int maxBedId = mb.getMaxBedId(con);
                                            if (maxBedId > 0) {
                                                MstBedRelation mbr = new MstBedRelation();
                                                for (int i = 0; i < categories.size(); i++) {

                                                    if (((JCheckBox) businessCategory.getValueAt(i, 1)).isSelected()) {
                                                        mbr = new MstBedRelation();
                                                        mbr.setShopID(((MstShop) shop.getSelectedItem()).getShopID());
                                                        mbr.setBedID(maxBedId);
                                                        mbr.setShopCategoryID(categories.get(i).getShopCategoryId());
                                                        mbr.insert(con);
                                                    }

                                                }
                                            }
                                        }

                                        //IVS VUINV end add 20140708 MASHU_施術台登録
                                        
					con.commit();
					result	=	true;
                    //IVS_LVTu start add 2017/08/15 #21596 [gb] マスタ登録のあと再起動アラートを出す
                    isLoadDisplay = true;
                    //IVS_LVTu end add 2017/08/15 #21596 [gb] マスタ登録のあと再起動アラートを出す
				}
				else
				{
					con.rollback();
				}
			}
			catch(SQLException e)
			{
				con.rollback();
				SystemInfo.getLogger().log(Level.SEVERE, e.getLocalizedMessage(), e);
			}
		}
		catch(SQLException e)
		{
			SystemInfo.getLogger().log(Level.SEVERE, e.getLocalizedMessage(), e);
		}
		
		return	result;
	}
	
	
	/**
	 * 選択されたデータを削除する。
	 * @return true - 成功
	 */
	private void delete()
	{
		boolean		result	=	false;
		MstBed		mb		=	null;
		
		if(0 <= selIndex && selIndex < mbs.size())
		{
			mb	=	mbs.get(selIndex);
		}
		
		//削除確認
		if(MessageDialog.showYesNoDialog(this,
					MessageUtil.getMessage(MessageUtil.CONFIRM_DELETE, mb.getBedName()),
					this.getTitle(),
					JOptionPane.WARNING_MESSAGE) != 0)
		{
			return;
		}
		
		try
		{
			ConnectionWrapper	con	=	SystemInfo.getConnection();
                        
                        //VUINV start add 20140708 MASHU_施術台登録
                        MstBedRelation mbr = new MstBedRelation();
                        if (selIndex > - 1) {
                                mbr.setShopID(((MstShop) shop.getSelectedItem()).getShopID());
                                mbr.setBedID(mbs.get(selIndex).getBedID());
                        }
                        //VUINV start add 20140708 MASHU_施術台登録
			try
			{
				con.begin();
				
                                //VUINV start add 20140709 MASHU_施術台登録
                                mbr.delete(con);
                                //VUINV end add 20140709 MASHU_施術台登録
                                
				if(mb.delete(con))
				{
					con.commit();
					result	=	true;
                    //IVS_LVTu start add 2017/08/15 #21596 [gb] マスタ登録のあと再起動アラートを出す
                    isLoadDisplay = true;
                    //IVS_LVTu end add 2017/08/15 #21596 [gb] マスタ登録のあと再起動アラートを出す
				}
				else
				{
					con.rollback();
				}
			}
			catch(SQLException e)
			{
				con.rollback();
				SystemInfo.getLogger().log(Level.SEVERE, e.getLocalizedMessage(), e);
			}
		}
		catch(SQLException e)
		{
			SystemInfo.getLogger().log(Level.SEVERE, e.getLocalizedMessage(), e);
		}
		
		if(result)
		{
			this.refresh();
		}
		else
		{
			MessageDialog.showMessageDialog(this,
					MessageUtil.getMessage(MessageUtil.ERROR_DELETE_FAILED,
							"施術台"),
					this.getTitle(),
					JOptionPane.ERROR_MESSAGE);
		}
	}
	
	/**
	 * ベッドマスタ登録画面用FocusTraversalPolicy
	 */
	private class MstBedFocusTraversalPolicy
					extends FocusTraversalPolicy
	{
		/**
		 * aComponent のあとでMstBedFocusTraversalPolicy。
		 * aContainer は aComponent のフォーカスサイクルのルートまたはフォーカストラバーサルポリシープロバイダでなければなりません。
		 * @param aContainer aComponent のフォーカスサイクルのルートまたはフォーカストラバーサルポリシープロバイダ
		 * @param aComponent aContainer のおそらく間接的な子、または aContainer 自体
		 * @return aComponent のあとにフォーカスを受け取る Component。適切な Component が見つからない場合は null
		 */
		public Component getComponentAfter(Container aContainer,
										   Component aComponent)
		{
			if (aComponent.equals(bedName))
			{
				return bedNum;
			}
			else if (aComponent.equals(bedNum))
			{
				return displaySeq;
			}
			else if (aComponent.equals(displaySeq))
			{
				return displaySeq;
			}
			
			return getDefaultComponent();
		}

		/**
		 * aComponent の前にフォーカスを受け取る Component を返します。
		 * aContainer は aComponent のフォーカスサイクルのルートまたはフォーカストラバーサルポリシープロバイダでなければなりません。
		 * @param aContainer aComponent のフォーカスサイクルのルートまたはフォーカストラバーサルポリシープロバイダ
		 * @param aComponent aContainer のおそらく間接的な子、または aContainer 自体
		 * @return aComponent の前にフォーカスを受け取る Component。適切な Component が見つからない場合は null
		 */
		public Component getComponentBefore(Container aContainer,
											Component aComponent)
		{
			if (aComponent.equals(bedName))
			{
				return bedName;
			}
			else if (aComponent.equals(bedNum))
			{
				return bedName;
			}
			else if (aComponent.equals(displaySeq))
			{
				return bedNum;
			}
			
			return getDefaultComponent();
		}

		/**
		 * トラバーサルサイクルの最初の Component を返します。
		 * このメソッドは、順方向のトラバーサルがラップするときに、次にフォーカスする Component を判定するために使用します。
		 * @param aContainer 先頭の Component を返すフォーカスサイクルのルートまたはフォーカストラバーサルポリシープロバイダ
		 * @return aContainer のトラバーサルサイクルの先頭の Componet、または適切な Component が見つからない場合は null
		 */
		public Component getFirstComponent(Container aContainer)
		{
			return getDefaultComponent();
		}

		/**
		 * トラバーサルサイクルの最後の Component を返します。
		 * このメソッドは、逆方向のトラバーサルがラップするときに、次にフォーカスする Component を判定するために使用します。
		 * @param aContainer aContainer - 最後の Component を返すフォーカスサイクルのルートまたはフォーカストラバーサルポリシープロバイダ
		 * @return aContainer のトラバーサルサイクルの最後の Componet、または適切な Component が見つからない場合は null
		 */
		public Component getLastComponent(Container aContainer)
		{
			return displaySeq;
		}

		/**
		 * フォーカスを設定するデフォルトコンポーネントを返します。
		 * aContainer をルートとするフォーカストラバーサルサイクルが新しく開始されたときに、このコンポーネントに最初にフォーカスが設定されます。
		 * @param aContainer デフォルトの Component を返すフォーカスサイクルのルートまたはフォーカストラバーサルポリシープロバイダ
		 * @return aContainer のトラバーサルサイクルのデフォルトの Componet、または適切な Component が見つからない場合は null
		 */
		public Component getDefaultComponent(Container aContainer)
		{
			return getDefaultComponent();
		}
		
		/**
		 * ウィンドウが最初に表示されたときにフォーカスが設定されるコンポーネントを返します。
		 * show() または setVisible(true) の呼び出しで一度ウィンドウが表示されると、
		 * 初期化コンポーネントはそれ以降使用されません。
		 * 一度別のウィンドウに移ったフォーカスが再び設定された場合、
		 * または、一度非表示状態になったウィンドウが再び表示された場合は、
		 * そのウィンドウの最後にフォーカスが設定されたコンポーネントがフォーカス所有者になります。
		 * このメソッドのデフォルト実装ではデフォルトコンポーネントを返します。
		 * @param window 初期コンポーネントが返されるウィンドウ
		 * @return 最初にウィンドウが表示されるときにフォーカス設定されるコンポーネント。適切なコンポーネントがない場合は null
		 */
		public Component getInitialComponent(Window window)
		{
			return getDefaultComponent();
		}
		
		public Component getDefaultComponent()
		{
			if(1 < shop.getItemCount())
			{
				return	shop;
			}
			else
			{
				return bedName;
			}
		}
	}
	/**
	 * JTableの列幅を初期化する。
	 */
	private void initTableColumnWidth()
	{
		//列の幅を設定する。
		beds.getColumnModel().getColumn(0).setPreferredWidth(200);
		beds.getColumnModel().getColumn(1).setPreferredWidth(50);
		beds.getColumnModel().getColumn(2).setPreferredWidth(50);
                
                // IVS VUINV start add 20140703 MASHU_施術台登録
                if (useShopCategory == 1) {
                    //IVS_Nhanvt start edit Merge 20140821 MASHU_施術台登録
                    //beds.getColumnModel().getColumn(3).setPreferredWidth(200);
                    //IVS_LVTu start edit 2014/07/28 Mashu_施術台登録
                    //beds.getColumnModel().getColumn(3).setMinWidth(200);
                    //beds.getColumnModel().getColumn(3).setMaxWidth(200);
                    //beds.getColumnModel().getColumn(3).setMinWidth(20);
                    //beds.getColumnModel().getColumn(3).setMaxWidth(700);
                    //IVS_LVTu end edit 2014/07/25 Mashu_施術台登録
                    
                    beds = new javax.swing.JTable();

                    beds.setModel(new javax.swing.table.DefaultTableModel(
                        new Object [][] {
                            {null, null, null, null}
                        },
                        new String [] {
                            "施術台名", "床数", "表示順", "業態"
                        }
                    ) {
                        Class[] types = new Class [] {
                            java.lang.String.class, java.lang.Integer.class, java.lang.Integer.class, java.lang.String.class
                        };
                        boolean[] canEdit = new boolean [] {
                            false, false, false, false
                        };

                        public Class getColumnClass(int columnIndex) {
                            return types [columnIndex];
                        }

                        public boolean isCellEditable(int rowIndex, int columnIndex) {
                            return canEdit [columnIndex];
                        }
                    });

                    beds.setSelectionBackground(new java.awt.Color(220, 220, 220));

                    beds.setSelectionForeground(new java.awt.Color(0, 0, 0));


                    beds.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
                    beds.getTableHeader().setReorderingAllowed(false);
                    SwingUtil.setJTableHeaderRenderer(beds, SystemInfo.getTableHeaderRenderer());
                    beds.setRowHeight(SystemInfo.TABLE_ROW_HEIGHT);
                    // IVS_nhanvt start edit 20140820 MASHU_施術台登録_Merge
                    //this.initTableColumnWidth();
                    // IVS_nhanvt end edit 20140820 MASHU_施術台登録_Merge
                    SelectTableCellRenderer.setSelectTableCellRenderer(beds);
                    beds.addFocusListener(new java.awt.event.FocusAdapter() {
                        public void focusGained(java.awt.event.FocusEvent evt) {
                            bedsFocusGained(evt);
                        }
                    });
                    beds.addMouseListener(new java.awt.event.MouseAdapter() {
                        public void mouseReleased(java.awt.event.MouseEvent evt) {
                            bedsMouseReleased(evt);
                        }
                    });
                    beds.addKeyListener(new java.awt.event.KeyAdapter() {
                        public void keyReleased(java.awt.event.KeyEvent evt) {
                            bedsKeyReleased(evt);
                        }
                    });

                    bedsScrollPane.setViewportView(beds);
                    //IVS_Nhanvt end edit Merge 20140821 MASHU_施術台登録
                } else {
                    beds.getColumnModel().getColumn(3).setPreferredWidth(0);         
                    beds.getColumnModel().getColumn(3).setMinWidth(0);
                    beds.getColumnModel().getColumn(3).setMaxWidth(0);
                }
                // IVS VUINV end add 20140703 MASHU_施術台登録
	}
        
        // IVS VUINV start add 20140703 MASHU_施術台登録
        /**
	 * JTableの列幅を初期化する。
	 */
	private void initTableBisinessCategoryColumnWidth()
	{
		//列の幅を設定する。
                businessCategory.getColumnModel().getColumn(0).setPreferredWidth(275);
                businessCategory.getColumnModel().getColumn(1).setPreferredWidth(25);
                //IVS_LVTu start add 2014/07/28 Mashu_施術台登録
                businessCategory.getColumnModel().getColumn(1).setMinWidth(100);
                businessCategory.getColumnModel().getColumn(1).setMaxWidth(100);
                //IVS_LVTu end add 2014/07/28 Mashu_施術台登録
	}
        // IVS VUINV end add 20140703 MASHU_施術台登録
	
	/**
	 * 列の表示位置を設定するTableCellRenderer
	 */
	private class TableCellAlignRenderer extends DefaultTableCellRenderer
	{
		/** Creates a new instance of ReservationTableCellRenderer */
		public TableCellAlignRenderer()
		{
			super();
		}

		/**
		 * テーブルセルレンダリングを返します。
		 * @param table JTable
		 * @param value セルに割り当てる値
		 * @param isSelected セルが選択されている場合は true
		 * @param hasFocus フォーカスがある場合は true
		 * @param row 行
		 * @param column 列
		 * @return テーブルセルレンダリング
		 */
		public Component getTableCellRendererComponent(JTable table,
				Object value, boolean isSelected, boolean hasFocus, int row, int column)
		{
			super.getTableCellRendererComponent(table, value,
					isSelected, hasFocus, row, column);
			
			switch(column)
			{
				case 1:
				case 2:
					super.setHorizontalAlignment(SwingConstants.RIGHT);
					break;
				default:
					super.setHorizontalAlignment(SwingConstants.LEFT);
					break;
			}

			return this;
		}
	}
}
