/*
 * RegisterCheckInVoucherPanel.java
 *
 * Created on 2008/09/17, 9:56
 */

package com.geobeck.sosia.pos.hair.product;

import com.geobeck.sosia.pos.basicinfo.WorkTimePasswordDialog;
import com.geobeck.sosia.pos.hair.data.product.DataSlipOrder;
import com.geobeck.sosia.pos.hair.data.product.DataSlipOrderDetail;
import com.geobeck.sosia.pos.hair.data.product.DataSlipStore;
import com.geobeck.sosia.pos.hair.data.product.DataSlipStoreDetail;
import com.geobeck.sosia.pos.hair.data.product.DataSlipStoreDetails;
import com.geobeck.sosia.pos.basicinfo.commodity.EditabeTableCellRenderer;
import com.geobeck.sosia.pos.basicinfo.company.WebcheckSettingPanel;
import com.geobeck.sosia.pos.master.commodity.MstSupplier;
import com.geobeck.sosia.pos.master.commodity.MstSuppliers;
import com.geobeck.sosia.pos.master.company.MstShop;
import com.geobeck.sosia.pos.master.company.MstStaff;
import com.geobeck.sosia.pos.master.product.MstItem;
import com.geobeck.sosia.pos.master.product.MstItemClass;
import com.geobeck.sosia.pos.master.product.MstItemClasses;
import com.geobeck.sosia.pos.master.commodity.MstSupplierItems;
import com.geobeck.sosia.pos.swing.SelectTableCellRenderer;
import com.geobeck.sosia.pos.system.SystemInfo;
import com.geobeck.sosia.pos.util.MessageUtil;
import com.geobeck.sosia.pos.util.TaxUtil;
import com.geobeck.sql.ConnectionWrapper;
import com.geobeck.swing.CustomFilter;
import com.geobeck.swing.IntegerCellEditor;
import com.geobeck.swing.MessageDialog;
import com.geobeck.swing.SwingUtil;
import com.geobeck.util.CheckUtil;
import com.ibm.icu.lang.UCharacter;
import java.awt.Component;
import java.awt.Container;
import java.awt.Cursor;
import java.awt.FocusTraversalPolicy;
import java.awt.Window;
import java.math.BigDecimal;
import java.math.RoundingMode;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.Date;
import java.util.Vector;
import java.util.logging.Level;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JButton;
import javax.swing.JComboBox;
import javax.swing.JFormattedTextField;
import javax.swing.JOptionPane;
import javax.swing.JTable;
import javax.swing.JTextField;
import javax.swing.event.TableModelEvent;
import javax.swing.event.TableModelListener;
import javax.swing.table.DefaultTableModel;
import javax.swing.table.TableColumnModel;
import javax.swing.text.PlainDocument;


/**
 *
 * @author  ryu
 */
public class RegisterCheckInVoucherPanel extends com.geobeck.sosia.pos.swing.AbstractImagePanelEx
{
	private enum SearchMode { NONE, SLIP_STORE, SLIP_ORDER };
	
	//éËìÆÇæÇØÇ≈ÉCÉxÉìÉgÇé¿çsÇ∑ÇÈ
	private int eventFlg = 0;
	//êVãKÉtÉâÉO 0:ä˘ë∂/1ÅFêVãK
	private int newFlag = 1;
	
	private MstItemClasses	classes	=	new MstItemClasses();
	private MstSuppliers	mss		=	new MstSuppliers();
	
	private DataSlipStore	data			=	new DataSlipStore();
	private DataSlipOrder	dataSlipOrder	=	null;
	
	SearchSlipDialog dialog = null;
	
	/**
	 * Creates new form RegisterCheckInVoucherPanel
	 */
	public RegisterCheckInVoucherPanel()
	{
		this.setSize(850, 800);
		this.setPath("è§ïiä«óù >> ì¸å…ì`ï[çÏê¨");
		this.setTitle("ì¸å…ì`ï[çÏê¨");
		initComponents();
		init();
		clear();
	}
	
	/*
	 *ÉRÉìÉ{É{ÉbÉNÉXÇÃì‡óeèâä˙âªÇ»Ç«
	 */
	private void init()
	{
		SystemInfo.initGroupShopComponents(shop, 2);
		initStaff(personInName);
		
		initItemClass();
		
		//add listener to detail info
		SelectionListener listener = new SelectionListener(tblDetailInfo);
		tblDetailInfo.getModel().addTableModelListener(listener);
		
		//ï“èWÉRÉâÉÄëÆê´Çê›íuÇ∑ÇÈ
		JFormattedTextField ftf = new javax.swing.JFormattedTextField();
		((PlainDocument)ftf.getDocument()).setDocumentFilter(
			new CustomFilter(20, CustomFilter.NUMERIC));
		
		// ÉeÅ[ÉuÉãÇÃÉJÉâÉÄÉTÉCÉYÇí≤êÆ
		initDetailColumn();
		
		// É{É^ÉìÇÃè„Ç…É}ÉEÉXÉJÅ[É\ÉãÇ™èÊÇ¡ÇΩéûÇ…ÉJÅ[É\ÉãÇïœçXÇ∑ÇÈ
		addMouseCursorChange();
		// enterÉLÅ[Ç≈çÄñ⁄Çà⁄ìÆÇ∑ÇÈ
		setKeyListener();
		
		// è§ïiï™óﬁÇÃêÊì™çÄñ⁄ÇëIëèÛë‘Ç…Ç∑ÇÈ
		tblProduct1.setRowSelectionInterval(0, 0);
		tblProduct2.setRowSelectionInterval(0, 0);

		// óÒïùÇÃí≤êÆ
		tblProductDetail1.getColumnModel().getColumn(0).setPreferredWidth(220);
		tblProductDetail2.getColumnModel().getColumn(0).setPreferredWidth(220);
	}
	
	
	/** This method is called from within the constructor to
	 * initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is
	 * always regenerated by the Form Editor.
	 */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        btnSearchSlip = new javax.swing.JButton();
        btnRegist = new javax.swing.JButton();
        btnSearchOrder = new javax.swing.JButton();
        btnDelete = new javax.swing.JButton();
        btnClear = new javax.swing.JButton();
        jLabel3 = new javax.swing.JLabel();

        try
        {
            ConnectionWrapper	con	=	SystemInfo.getConnection();

            mss.load(con, false);

            con.close();

            mss.add(0, new MstSupplier());
        }
        catch(SQLException e)
        {
            SystemInfo.getLogger().log(Level.SEVERE, e.getLocalizedMessage(), e);
        }
        supplierName = new JComboBox(new DefaultComboBoxModel(mss.toArray())
            {
                public void setSelectedItem(Object o)
                {
                    super.setSelectedItem(o);
                }
            });
            jLabel4 = new javax.swing.JLabel();
            checkInDate = new jp.co.flatsoft.fscomponent.FSCalenderCombo();
            jLabel5 = new javax.swing.JLabel();
            personInName = new javax.swing.JComboBox();
            jPanel4 = new javax.swing.JPanel();
            panelDetail = new javax.swing.JScrollPane();
            tblDetailInfo = new com.geobeck.swing.JTableEx();
            jLabel8 = new javax.swing.JLabel();
            panelTotal = new javax.swing.JScrollPane();
            tblTotalInfo = new javax.swing.JTable();
            jLabel6 = new javax.swing.JLabel();
            jLabel7 = new javax.swing.JLabel();
            voucherNo = new javax.swing.JTextField();
            jTabbedPane1 = new javax.swing.JTabbedPane();
            //IVS_LVTu start add 2015/09/06 New request #42897
            jTabbedPane1.setUI(new CustomTabbedPaneUI());
            //IVS_LVTu end add 2015/09/06 New request #42897
            panelForShopSale = new javax.swing.JPanel();
            jScrollPane2 = new javax.swing.JScrollPane();
            tblProductDetail1 = new javax.swing.JTable();
            jScrollPane7 = new javax.swing.JScrollPane();
            tblProduct1 = new javax.swing.JTable();
            panelForBuiness = new javax.swing.JPanel();
            jScrollPane1 = new javax.swing.JScrollPane();
            tblProductDetail2 = new javax.swing.JTable();
            jScrollPane6 = new javax.swing.JScrollPane();
            tblProduct2 = new javax.swing.JTable();
            jPanel1 = new javax.swing.JPanel();
            shop = new com.geobeck.sosia.pos.swing.JComboBoxLabel();
            supplierNo = new javax.swing.JFormattedTextField();
            ((PlainDocument)supplierNo.getDocument()).setDocumentFilter(
                new CustomFilter(20, CustomFilter.ALPHAMERIC));
            personInCd = new javax.swing.JFormattedTextField();
            ((PlainDocument)personInCd.getDocument()).setDocumentFilter(
                new CustomFilter(20, CustomFilter.ALPHAMERIC));
            priceDown = new javax.swing.JFormattedTextField();
            ((PlainDocument)priceDown.getDocument()).setDocumentFilter(
                new CustomFilter(9, CustomFilter.NUMERIC));
            butGoodsImport = new javax.swing.JButton();

            setFocusCycleRoot(true);

            jLabel1.setText("ìXï‹");

            jLabel2.setText("ì`ï[NO");

            btnSearchSlip.setIcon(SystemInfo.getImageIcon("/button/search/search_slip_off.jpg")
            );
            btnSearchSlip.setBorderPainted(false);
            btnSearchSlip.setContentAreaFilled(false);
            btnSearchSlip.setPressedIcon(SystemInfo.getImageIcon("/button/search/search_slip_on.jpg")
            );
            btnSearchSlip.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    btnSearchSlipActionPerformed(evt);
                }
            });

            btnRegist.setIcon(SystemInfo.getImageIcon("/button/common/regist_off.jpg")
            );
            btnRegist.setBorderPainted(false);
            btnRegist.setContentAreaFilled(false);
            btnRegist.setPressedIcon(SystemInfo.getImageIcon("/button/common/regist_on.jpg")
            );
            btnRegist.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    btnRegistActionPerformed(evt);
                }
            });

            btnSearchOrder.setIcon(SystemInfo.getImageIcon("/button/search/search_order_off.jpg")
            );
            btnSearchOrder.setBorderPainted(false);
            btnSearchOrder.setContentAreaFilled(false);
            btnSearchOrder.setPressedIcon(SystemInfo.getImageIcon("/button/search/search_order_on.jpg"));
            btnSearchOrder.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    btnSearchOrderActionPerformed(evt);
                }
            });

            btnDelete.setIcon(SystemInfo.getImageIcon("/button/common/delete_off.jpg")
            );
            btnDelete.setBorderPainted(false);
            btnDelete.setContentAreaFilled(false);
            btnDelete.setPressedIcon(SystemInfo.getImageIcon("/button/common/delete_on.jpg")
            );
            btnDelete.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    btnDeleteActionPerformed(evt);
                }
            });

            btnClear.setIcon(SystemInfo.getImageIcon("/button/common/clear_off.jpg")
            );
            btnClear.setBorderPainted(false);
            btnClear.setContentAreaFilled(false);
            btnClear.setPressedIcon(SystemInfo.getImageIcon("/button/common/clear_on.jpg")
            );
            btnClear.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    btnClearActionPerformed(evt);
                }
            });

            jLabel3.setText("édì¸êÊ");

            supplierName.setMaximumRowCount(15);
            supplierName.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
            supplierName.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    supplierNameActionPerformed(evt);
                }
            });

            jLabel4.setText("ì¸å…ì˙");

            checkInDate.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
            checkInDate.setDate(new java.util.Date());

            jLabel5.setText("ì¸å…íSìñé“");

            personInName.setMaximumRowCount(15);
            personInName.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
            personInName.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    personInNameActionPerformed(evt);
                }
            });

            javax.swing.GroupLayout jPanel4Layout = new javax.swing.GroupLayout(jPanel4);
            jPanel4.setLayout(jPanel4Layout);
            jPanel4Layout.setHorizontalGroup(
                jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGap(0, 341, Short.MAX_VALUE)
            );
            jPanel4Layout.setVerticalGroup(
                jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGap(0, 138, Short.MAX_VALUE)
            );

            panelDetail.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));

            tblDetailInfo.setModel(new javax.swing.table.DefaultTableModel(
                new Object [][] {

                },
                new String [] {
                    "ãÊï™", "ï™óﬁ", "è§ïiñº", "<html>édì¸âøäi<br>&nbsp;&nbsp;(ê≈çû)</html>", "<html>édì¸âøäi<br>&nbsp;&nbsp;(ê≈î≤)</html>", "î≠íçêî", "ì¸å…êî", "ìYïtêî", "ì¸å…åv", "ì¸å…ã‡äz", "çÌèú"
                }
            ) {
                Class[] types = new Class [] {
                    java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.Integer.class, java.lang.Integer.class, java.lang.Integer.class, java.lang.Integer.class, java.lang.Integer.class, java.lang.Integer.class, java.lang.Long.class, java.lang.Object.class
                };
                boolean[] canEdit = new boolean [] {
                    false, false, false, false, false, false, true, true, false, false, true
                };

                public Class getColumnClass(int columnIndex) {
                    return types [columnIndex];
                }

                public boolean isCellEditable(int rowIndex, int columnIndex) {
                    return canEdit [columnIndex];
                }
            });
            tblDetailInfo.setSelectionBackground(new java.awt.Color(255, 210, 142));
            tblDetailInfo.setSelectionForeground(new java.awt.Color(0, 0, 0));
            tblDetailInfo.getTableHeader().setReorderingAllowed(false);
            SwingUtil.setJTableHeaderRenderer(tblDetailInfo, SystemInfo.getTableHeaderRenderer());
            tblDetailInfo.setRowHeight(SystemInfo.TABLE_ROW_HEIGHT);
            SelectTableCellRenderer.setSelectTableCellRenderer(tblDetailInfo);

            TableColumnModel tblDetailInfoModel = tblDetailInfo.getColumnModel();
            tblDetailInfoModel.getColumn(6).setCellEditor(new IntegerCellEditor(new JTextField()));
            tblDetailInfoModel.getColumn(7).setCellEditor(new IntegerCellEditor(new JTextField()));
            tblDetailInfoModel.getColumn(6).setCellRenderer(new EditabeTableCellRenderer(Integer.class, "0"));
            tblDetailInfoModel.getColumn(7).setCellRenderer(new EditabeTableCellRenderer(Integer.class, "0"));
            panelDetail.setViewportView(tblDetailInfo);

            jLabel8.setFont(new java.awt.Font("MS UI Gothic", 0, 24)); // NOI18N

            panelTotal.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
            panelTotal.setHorizontalScrollBarPolicy(javax.swing.ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);
            panelTotal.setVerticalScrollBarPolicy(javax.swing.ScrollPaneConstants.VERTICAL_SCROLLBAR_NEVER);

            tblTotalInfo.setModel(new javax.swing.table.DefaultTableModel(
                new Object [][] {
                    {null, null, null, null}
                },
                new String [] {
                    "ì¸å…êî", "ìYïtêî", "ì¸å…åv", "ì¸å…ã‡äz"
                }
            ) {
                Class[] types = new Class [] {
                    java.lang.Integer.class, java.lang.Integer.class, java.lang.Integer.class, java.lang.Long.class
                };
                boolean[] canEdit = new boolean [] {
                    false, false, false, false
                };

                public Class getColumnClass(int columnIndex) {
                    return types [columnIndex];
                }

                public boolean isCellEditable(int rowIndex, int columnIndex) {
                    return canEdit [columnIndex];
                }
            });
            tblTotalInfo.setColumnSelectionAllowed(true);
            tblTotalInfo.setSelectionBackground(new java.awt.Color(255, 210, 142));
            tblTotalInfo.setSelectionForeground(new java.awt.Color(0, 0, 0));
            tblTotalInfo.getTableHeader().setReorderingAllowed(false);
            SwingUtil.setJTableHeaderRenderer(tblTotalInfo, SystemInfo.getTableHeaderRenderer());
            tblTotalInfo.setRowHeight(SystemInfo.TABLE_ROW_HEIGHT);
            SelectTableCellRenderer.setSelectTableCellRenderer(tblTotalInfo);
            panelTotal.setViewportView(tblTotalInfo);

            jLabel6.setText("édì¸ílà¯Ç´");

            jLabel7.setText("â~");

            voucherNo.setEditable(false);
            voucherNo.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
            voucherNo.setText("Å@Å@<êVãK>");
            voucherNo.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));

            jScrollPane2.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));

            tblProductDetail1.setModel(new javax.swing.table.DefaultTableModel(
                new Object [][] {

                },
                new String [] {
                    "è§ïiñº", "édì¸âøäi(ê≈çû)", "édì¸âøäi(ê≈î≤Åj"
                }
            ) {
                Class[] types = new Class [] {
                    java.lang.String.class, java.lang.Integer.class, java.lang.Integer.class
                };
                boolean[] canEdit = new boolean [] {
                    false, false, false
                };

                public Class getColumnClass(int columnIndex) {
                    return types [columnIndex];
                }

                public boolean isCellEditable(int rowIndex, int columnIndex) {
                    return canEdit [columnIndex];
                }
            });
            tblProductDetail1.setSelectionBackground(new java.awt.Color(255, 210, 142));
            tblProductDetail1.setSelectionForeground(new java.awt.Color(0, 0, 0));
            tblProductDetail1.getTableHeader().setReorderingAllowed(false);
            SwingUtil.setJTableHeaderRenderer(tblProductDetail1, SystemInfo.getTableHeaderRenderer());
            tblProductDetail1.setRowHeight(SystemInfo.TABLE_ROW_HEIGHT);
            SelectTableCellRenderer.setSelectTableCellRenderer(tblProductDetail1);
            tblProductDetail1.addMouseListener(new java.awt.event.MouseAdapter() {
                public void mouseClicked(java.awt.event.MouseEvent evt) {
                    tblProductDetail1MouseClicked(evt);
                }
            });
            jScrollPane2.setViewportView(tblProductDetail1);

            jScrollPane7.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));

            tblProduct1.setModel(new javax.swing.table.DefaultTableModel(
                new Object [][] {

                },
                new String [] {
                    "è§ïiï™óﬁ"
                }
            ) {
                boolean[] canEdit = new boolean [] {
                    false
                };

                public boolean isCellEditable(int rowIndex, int columnIndex) {
                    return canEdit [columnIndex];
                }
            });
            tblProduct1.setSelectionBackground(new java.awt.Color(255, 210, 142));
            tblProduct1.setSelectionForeground(new java.awt.Color(0, 0, 0));
            tblProduct1.getTableHeader().setReorderingAllowed(false);
            SwingUtil.setJTableHeaderRenderer(tblProduct1, SystemInfo.getTableHeaderRenderer());
            tblProduct1.setRowHeight(SystemInfo.TABLE_ROW_HEIGHT);
            SelectTableCellRenderer.setSelectTableCellRenderer(tblProduct1);
            tblProduct1.addMouseListener(new java.awt.event.MouseAdapter() {
                public void mouseReleased(java.awt.event.MouseEvent evt) {
                    tblProduct1MouseReleased(evt);
                }
            });
            tblProduct1.addKeyListener(new java.awt.event.KeyAdapter() {
                public void keyReleased(java.awt.event.KeyEvent evt) {
                    tblProduct1KeyReleased(evt);
                }
            });
            jScrollPane7.setViewportView(tblProduct1);

            javax.swing.GroupLayout panelForShopSaleLayout = new javax.swing.GroupLayout(panelForShopSale);
            panelForShopSale.setLayout(panelForShopSaleLayout);
            panelForShopSaleLayout.setHorizontalGroup(
                panelForShopSaleLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(panelForShopSaleLayout.createSequentialGroup()
                    .addComponent(jScrollPane7, javax.swing.GroupLayout.PREFERRED_SIZE, 144, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                    .addComponent(jScrollPane2, javax.swing.GroupLayout.DEFAULT_SIZE, 468, Short.MAX_VALUE))
            );
            panelForShopSaleLayout.setVerticalGroup(
                panelForShopSaleLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addComponent(jScrollPane7, javax.swing.GroupLayout.DEFAULT_SIZE, 229, Short.MAX_VALUE)
                .addComponent(jScrollPane2, javax.swing.GroupLayout.DEFAULT_SIZE, 229, Short.MAX_VALUE)
            );

            jTabbedPane1.addTab("ìXîÃóp", panelForShopSale);

            jScrollPane1.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));

            tblProductDetail2.setModel(new javax.swing.table.DefaultTableModel(
                new Object [][] {

                },
                new String [] {
                    "è§ïiñº", "édì¸âøäi(ê≈çû)", "édì¸âøäi(ê≈î≤Åj"
                }
            ) {
                boolean[] canEdit = new boolean [] {
                    false, false, false
                };

                public boolean isCellEditable(int rowIndex, int columnIndex) {
                    return canEdit [columnIndex];
                }
            });
            tblProductDetail2.setSelectionBackground(new java.awt.Color(255, 210, 142));
            tblProductDetail2.setSelectionForeground(new java.awt.Color(0, 0, 0));
            tblProductDetail2.getTableHeader().setReorderingAllowed(false);
            SwingUtil.setJTableHeaderRenderer(tblProductDetail2, SystemInfo.getTableHeaderRenderer());
            tblProductDetail2.setRowHeight(SystemInfo.TABLE_ROW_HEIGHT);
            SelectTableCellRenderer.setSelectTableCellRenderer(tblProductDetail2);
            tblProductDetail2.addMouseListener(new java.awt.event.MouseAdapter() {
                public void mouseClicked(java.awt.event.MouseEvent evt) {
                    tblProductDetail2MouseClicked(evt);
                }
            });
            jScrollPane1.setViewportView(tblProductDetail2);

            jScrollPane6.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));

            tblProduct2.setModel(new javax.swing.table.DefaultTableModel(
                new Object [][] {

                },
                new String [] {
                    "è§ïiï™óﬁ"
                }
            ) {
                boolean[] canEdit = new boolean [] {
                    false
                };

                public boolean isCellEditable(int rowIndex, int columnIndex) {
                    return canEdit [columnIndex];
                }
            });
            tblProduct2.setSelectionBackground(new java.awt.Color(255, 210, 142));
            tblProduct2.setSelectionForeground(new java.awt.Color(0, 0, 0));
            tblProduct2.getTableHeader().setReorderingAllowed(false);
            SwingUtil.setJTableHeaderRenderer(tblProduct2, SystemInfo.getTableHeaderRenderer());
            tblProduct2.setRowHeight(SystemInfo.TABLE_ROW_HEIGHT);
            SelectTableCellRenderer.setSelectTableCellRenderer(tblProduct2);
            tblProduct2.addMouseListener(new java.awt.event.MouseAdapter() {
                public void mouseReleased(java.awt.event.MouseEvent evt) {
                    tblProduct2MouseReleased(evt);
                }
            });
            tblProduct2.addKeyListener(new java.awt.event.KeyAdapter() {
                public void keyReleased(java.awt.event.KeyEvent evt) {
                    tblProduct2KeyReleased(evt);
                }
            });
            jScrollPane6.setViewportView(tblProduct2);

            javax.swing.GroupLayout panelForBuinessLayout = new javax.swing.GroupLayout(panelForBuiness);
            panelForBuiness.setLayout(panelForBuinessLayout);
            panelForBuinessLayout.setHorizontalGroup(
                panelForBuinessLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(panelForBuinessLayout.createSequentialGroup()
                    .addComponent(jScrollPane6, javax.swing.GroupLayout.PREFERRED_SIZE, 144, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 468, Short.MAX_VALUE))
            );
            panelForBuinessLayout.setVerticalGroup(
                panelForBuinessLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addComponent(jScrollPane6, javax.swing.GroupLayout.DEFAULT_SIZE, 229, Short.MAX_VALUE)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 229, Short.MAX_VALUE)
            );

            jTabbedPane1.addTab("ã∆ñ±óp", panelForBuiness);

            javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
            jPanel1.setLayout(jPanel1Layout);
            jPanel1Layout.setHorizontalGroup(
                jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGap(0, 809, Short.MAX_VALUE)
            );
            jPanel1Layout.setVerticalGroup(
                jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGap(0, 161, Short.MAX_VALUE)
            );

            shop.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
            shop.setMaximumRowCount(15);
            shop.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    shopActionPerformed(evt);
                }
            });

            supplierNo.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
            supplierNo.addFocusListener(new java.awt.event.FocusAdapter() {
                public void focusLost(java.awt.event.FocusEvent evt) {
                    supplierNoFocusLost(evt);
                }
            });

            personInCd.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
            personInCd.addFocusListener(new java.awt.event.FocusAdapter() {
                public void focusLost(java.awt.event.FocusEvent evt) {
                    personInCdFocusLost(evt);
                }
            });

            priceDown.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
            priceDown.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
            priceDown.addFocusListener(new java.awt.event.FocusAdapter() {
                public void focusLost(java.awt.event.FocusEvent evt) {
                    priceDownFocusLost(evt);
                }
            });

            butGoodsImport.setIcon(SystemInfo.getImageIcon("/button/common/goods_inport_off.jpg")
            );
            butGoodsImport.setBorderPainted(false);
            butGoodsImport.setContentAreaFilled(false);
            butGoodsImport.setPressedIcon(SystemInfo.getImageIcon("/button/common/goods_inport_on.jpg")
            );
            butGoodsImport.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    butGoodsImportActionPerformed(evt);
                }
            });

            javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
            this.setLayout(layout);
            layout.setHorizontalGroup(
                layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(layout.createSequentialGroup()
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(layout.createSequentialGroup()
                            .addGap(1263, 1263, 1263)
                            .addComponent(jPanel4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGroup(layout.createSequentialGroup()
                            .addGap(2935, 2935, 2935)
                            .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGroup(layout.createSequentialGroup()
                            .addContainerGap()
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                .addGroup(javax.swing.GroupLayout.Alignment.LEADING, layout.createSequentialGroup()
                                    .addGap(388, 388, 388)
                                    .addComponent(jLabel8)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                    .addComponent(panelTotal, javax.swing.GroupLayout.PREFERRED_SIZE, 300, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addGroup(javax.swing.GroupLayout.Alignment.LEADING, layout.createSequentialGroup()
                                    .addComponent(jTabbedPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 624, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                    .addComponent(jLabel6)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                    .addComponent(priceDown, javax.swing.GroupLayout.PREFERRED_SIZE, 67, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                    .addComponent(jLabel7))
                                .addComponent(panelDetail, javax.swing.GroupLayout.Alignment.LEADING)
                                .addGroup(javax.swing.GroupLayout.Alignment.LEADING, layout.createSequentialGroup()
                                    .addComponent(jLabel1)
                                    .addGap(29, 29, 29)
                                    .addComponent(shop, javax.swing.GroupLayout.PREFERRED_SIZE, 95, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                    .addComponent(jLabel2)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                    .addComponent(voucherNo, javax.swing.GroupLayout.PREFERRED_SIZE, 78, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                    .addComponent(btnSearchSlip, javax.swing.GroupLayout.PREFERRED_SIZE, 92, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                    .addComponent(btnSearchOrder, javax.swing.GroupLayout.PREFERRED_SIZE, 92, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addGap(15, 15, 15)
                                    .addComponent(btnRegist, javax.swing.GroupLayout.PREFERRED_SIZE, 92, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                    .addComponent(btnDelete, javax.swing.GroupLayout.PREFERRED_SIZE, 92, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                    .addComponent(btnClear, javax.swing.GroupLayout.PREFERRED_SIZE, 92, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addGroup(javax.swing.GroupLayout.Alignment.LEADING, layout.createSequentialGroup()
                                    .addComponent(jLabel3)
                                    .addGap(16, 16, 16)
                                    .addComponent(supplierNo, javax.swing.GroupLayout.PREFERRED_SIZE, 40, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                    .addComponent(supplierName, javax.swing.GroupLayout.PREFERRED_SIZE, 170, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addGap(35, 35, 35)
                                    .addComponent(jLabel4)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                    .addComponent(checkInDate, javax.swing.GroupLayout.PREFERRED_SIZE, 103, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addGap(35, 35, 35)
                                    .addComponent(jLabel5)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                    .addComponent(personInCd, javax.swing.GroupLayout.PREFERRED_SIZE, 40, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                    .addComponent(personInName, javax.swing.GroupLayout.PREFERRED_SIZE, 85, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addGroup(layout.createSequentialGroup()
                                    .addGap(676, 676, 676)
                                    .addComponent(butGoodsImport, javax.swing.GroupLayout.PREFERRED_SIZE, 92, javax.swing.GroupLayout.PREFERRED_SIZE)))))
                    .addContainerGap(1392, Short.MAX_VALUE))
            );
            layout.setVerticalGroup(
                layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(layout.createSequentialGroup()
                    .addContainerGap()
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(btnSearchOrder, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(btnRegist, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(btnDelete, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGroup(layout.createSequentialGroup()
                            .addComponent(btnClear, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                            .addComponent(butGoodsImport, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGroup(layout.createSequentialGroup()
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 24, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(shop, javax.swing.GroupLayout.PREFERRED_SIZE, 24, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 24, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(voucherNo, javax.swing.GroupLayout.PREFERRED_SIZE, 24, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addComponent(btnSearchSlip, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(jLabel3, javax.swing.GroupLayout.PREFERRED_SIZE, 24, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(supplierNo, javax.swing.GroupLayout.PREFERRED_SIZE, 24, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jLabel4, javax.swing.GroupLayout.PREFERRED_SIZE, 24, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(supplierName, javax.swing.GroupLayout.PREFERRED_SIZE, 24, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                        .addComponent(personInCd, javax.swing.GroupLayout.PREFERRED_SIZE, 24, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(jLabel5, javax.swing.GroupLayout.PREFERRED_SIZE, 24, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(personInName, javax.swing.GroupLayout.PREFERRED_SIZE, 24, javax.swing.GroupLayout.PREFERRED_SIZE))
                                    .addComponent(checkInDate, javax.swing.GroupLayout.PREFERRED_SIZE, 24, javax.swing.GroupLayout.PREFERRED_SIZE)))))
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel6, javax.swing.GroupLayout.PREFERRED_SIZE, 24, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(priceDown, javax.swing.GroupLayout.PREFERRED_SIZE, 24, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel7))
                        .addComponent(jTabbedPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 256, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                    .addComponent(panelDetail, javax.swing.GroupLayout.PREFERRED_SIZE, 280, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(layout.createSequentialGroup()
                            .addGap(24, 24, 24)
                            .addComponent(jLabel8)
                            .addGap(388, 388, 388)
                            .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGap(669, 669, 669)
                            .addComponent(jPanel4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGroup(layout.createSequentialGroup()
                            .addGap(15, 15, 15)
                            .addComponent(panelTotal, javax.swing.GroupLayout.PREFERRED_SIZE, 45, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addContainerGap(104, Short.MAX_VALUE))
            );

            jTabbedPane1.getAccessibleContext().setAccessibleName("");
        }// </editor-fold>//GEN-END:initComponents

	private void shopActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_shopActionPerformed
	{//GEN-HEADEREND:event_shopActionPerformed
		//è§ïiÉäÉXÉgÇçXêVÇ∑ÇÈ
		tblProduct1DoClick();
		tblProduct2DoClick();
		SwingUtil.clearTable(tblDetailInfo);
	}//GEN-LAST:event_shopActionPerformed
	
	private void personInNameActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_personInNameActionPerformed
	{//GEN-HEADEREND:event_personInNameActionPerformed
		UIUtil.outputStaff(personInName, personInCd);
	}//GEN-LAST:event_personInNameActionPerformed
	
	private void supplierNameActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_supplierNameActionPerformed
	{//GEN-HEADEREND:event_supplierNameActionPerformed

            supplierName.hidePopup();

            try {

                setCursor(Cursor.getPredefinedCursor(Cursor.WAIT_CURSOR));

                UIUtil.outputSupplier(supplierName, supplierNo);

		//è§ïiÉäÉXÉgÇçXêVÇ∑ÇÈ
		tblProduct1DoClick();
		tblProduct2DoClick();
		SwingUtil.clearTable(tblDetailInfo);
                
            } finally {
                setCursor(Cursor.getPredefinedCursor(Cursor.DEFAULT_CURSOR));
            }
                
	}//GEN-LAST:event_supplierNameActionPerformed
	
	private void btnSearchOrderActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_btnSearchOrderActionPerformed
	{//GEN-HEADEREND:event_btnSearchOrderActionPerformed
		loadOrder();
		//êVãKÉtÉâÉOÇê›íuÇ∑ÇÈ
		setNewFlag(1);
	}//GEN-LAST:event_btnSearchOrderActionPerformed
	
	private void btnSearchSlipActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_btnSearchSlipActionPerformed
	{//GEN-HEADEREND:event_btnSearchSlipActionPerformed
		loadSlip();
	}//GEN-LAST:event_btnSearchSlipActionPerformed
	
	private void tblProduct1MouseReleased(java.awt.event.MouseEvent evt)//GEN-FIRST:event_tblProduct1MouseReleased
	{//GEN-HEADEREND:event_tblProduct1MouseReleased
		tblProduct1DoClick();
	}//GEN-LAST:event_tblProduct1MouseReleased
	
	private void tblProduct2KeyReleased(java.awt.event.KeyEvent evt)//GEN-FIRST:event_tblProduct2KeyReleased
	{//GEN-HEADEREND:event_tblProduct2KeyReleased
		tblProduct2DoClick();
	}//GEN-LAST:event_tblProduct2KeyReleased
	
	private void tblProduct2MouseReleased(java.awt.event.MouseEvent evt)//GEN-FIRST:event_tblProduct2MouseReleased
	{//GEN-HEADEREND:event_tblProduct2MouseReleased
		tblProduct2DoClick();
	}//GEN-LAST:event_tblProduct2MouseReleased
	
	private void tblProduct1KeyReleased(java.awt.event.KeyEvent evt)//GEN-FIRST:event_tblProduct1KeyReleased
	{//GEN-HEADEREND:event_tblProduct1KeyReleased
		tblProduct1DoClick();
	}//GEN-LAST:event_tblProduct1KeyReleased
	
	private void btnClearActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_btnClearActionPerformed
	{//GEN-HEADEREND:event_btnClearActionPerformed
		clear();
	}//GEN-LAST:event_btnClearActionPerformed
	
	private void btnDeleteActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_btnDeleteActionPerformed
	{//GEN-HEADEREND:event_btnDeleteActionPerformed
		if (MessageDialog.showYesNoDialog(this,
			MessageUtil.getMessage(MessageUtil.CONFIRM_DELETE, "ì¸å…ì`ï["),
			this.getTitle(),
			JOptionPane.WARNING_MESSAGE) != JOptionPane.YES_OPTION)
		{
			return;
		}
		
		//ì`ï[èÓïÒÇçÌèúÇ∑ÇÈ
		DataSlipStore dss =  new DataSlipStore();
		dss.setShopId(((MstShop)shop.getSelectedItem()).getShopID());
		//êVãKÇÃèÍçáÅAçÌèúÇ≈Ç´Ç‹ÇπÇÒ
		if (!CheckUtil.isNumeric(voucherNo.getText()))
		{
			clear();
			return;
		}
		dss.setSlipNo(Integer.parseInt(voucherNo.getText()));

		try
		{
			ConnectionWrapper con = SystemInfo.getConnection();
			con.begin();
			try
			{
				dss.delete(con);

				//ì`ï[è⁄ç◊èÓïÒÇçÌèúÇ∑ÇÈ
				DataSlipStoreDetail dssd = new DataSlipStoreDetail();
				dssd.setShopId(dss.getShopId());
				dssd.setSlipNo(dss.getSlipNo());

				dssd.delete(con);
				con.commit();

				//èâä˙èÛë‘Ç…ñﬂÇÈ
				clear();

				MessageDialog.showMessageDialog(this,
					MessageUtil.getMessage(MessageUtil.INFO_DELETE_SUCCESS),
					this.getTitle(),
				JOptionPane.INFORMATION_MESSAGE);
			}
			catch (Exception ex)
			{
				con.rollback();
				throw ex;
			}
			finally
			{
				con.close();
			}
		}
		catch (RuntimeException ex)
		{
			SystemInfo.getLogger().log(Level.SEVERE, ex.getLocalizedMessage(), ex);
			throw ex;
		}
		catch (Exception ex)
		{
			SystemInfo.getLogger().log(Level.SEVERE, ex.getLocalizedMessage(), ex);
			MessageDialog.showMessageDialog(this,
					MessageUtil.getMessage(MessageUtil.ERROR_DELETE_FAILED, "ì¸å…ì`ï["),
					this.getTitle(),
					JOptionPane.ERROR_MESSAGE);
		}
	}//GEN-LAST:event_btnDeleteActionPerformed
	
	private void btnRegistActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_btnRegistActionPerformed
	{//GEN-HEADEREND:event_btnRegistActionPerformed
		//IVS_LVTu start add 2015/10/14 Bug #43499
                if(tblDetailInfo.isEditing())
                {
                    tblDetailInfo.getCellEditor().stopCellEditing();
                }
                //IVS_LVTu end add 2015/10/14 Bug #43499
                //ì`ï[èÓïÒÇçXêVÇ∑ÇÈ
		if (!inputCheck())
		{
			return;
		}
		
		if (MessageDialog.showYesNoDialog(this,
			MessageUtil.getMessage(MessageUtil.CONFIRM_REGIST, "ì¸å…ì`ï["),
			this.getTitle(),
			JOptionPane.QUESTION_MESSAGE) != JOptionPane.YES_OPTION)
		{
			return;
		}

		try
		{
			ConnectionWrapper con = SystemInfo.getConnection();
			try
			{
				con.begin();
				
				DataSlipStore dss = new DataSlipStore();
				//êVãKÇÃèÍçá
				if (getNewFlag() == 1)
				{
					dss.setShopId(((MstShop)shop.getSelectedItem()).getShopID());
					
					//ì`ï[NOÇê∂ê¨Ç∑ÇÈ
					dss.setNewSlipNo(con);
					
					//==================
					//è⁄ç◊ì‡óeÇê›íuÇ∑ÇÈ
					//==================
					//édì¸êÊ
					dss.setSupplierId(UIUtil.getSupplierID(supplierName));
					// ì¸å…ì˙
					dss.setStoreDate(checkInDate.getDate());
					// íSìñé“
					MstStaff mstStaff = (MstStaff) personInName.getSelectedItem();
					dss.setStaffId(mstStaff.getStaffID());
					// ílà¯Ç´
                                        //IVS_LVTu start edit 2015/10/20 Bug #43749
					//dss.setDiscount(Integer.parseInt(priceDown.getText()));
                                        dss.setDiscount(Integer.parseInt(priceDown.getText().trim().equals("")? "0":priceDown.getText().trim()));
                                        //IVS_LVTu end edit 2015/10/20 Bug #43749
					// ëŒâûÇ∑ÇÈî≠íçèë
					if (dataSlipOrder != null)
					{
						dss.setOrderSlipNo(dataSlipOrder.getSlipNo());
					}
					
					//ë}ì¸Ç∑ÇÈ
					dss.insert(con);
				}
				else
				{
					dss.setShopId(((MstShop)shop.getSelectedItem()).getShopID());
					dss.setSlipNo(Integer.parseInt(voucherNo.getText()));
					// ì¸å…ì˙
					dss.setStoreDate(checkInDate.getDate());
					// íSìñé“
					MstStaff mstStaff = (MstStaff) personInName.getSelectedItem();
					dss.setStaffId(mstStaff.getStaffID());
					// ílà¯Ç´
                                        //IVS_LVTu start edit 2015/10/20 Bug #43749
					//dss.setDiscount(Integer.parseInt(priceDown.getText()));
                                        dss.setDiscount(Integer.parseInt(priceDown.getText().trim().equals("")? "0": priceDown.getText().trim()));
                                        //IVS_LVTu end edit 2015/10/20 Bug #43749
					if (dataSlipOrder != null)
					{
						dss.setOrderSlipNo(dataSlipOrder.getSlipNo());
					}
					
					dss.update(con);
				}

				//ì`ï[è⁄ç◊èÓïÒÇçXêVÇ∑ÇÈ
				DataSlipStoreDetail.physicalDelete(con, dss.getShopId(), dss.getSlipNo());
				for (int i = 0; i < tblDetailInfo.getRowCount(); i++)
				{
					DataSlipStoreDetail dssd = new DataSlipStoreDetail();
					dssd.setShopId(dss.getShopId());
					dssd.setSlipNo(dss.getSlipNo());
					
					MstItem item = (MstItem)tblDetailInfo.getValueAt(i, 2);
					dssd.setItemId(item.getItemID());
					
					// édì¸âøäi
					Integer costPrice = (Integer) tblDetailInfo.getValueAt(i, 3);
					if (costPrice == null)
					{
						costPrice = 0;
					}
					dssd.setCostPrice(costPrice);
					//ì¸å…êîÅAìYïtêî
					Integer inNum = (Integer) tblDetailInfo.getValueAt(i, 6);
					if (inNum == null)
					{
						inNum = 0;
					}
					dssd.setInNum(inNum);
					Integer attNum = (Integer) tblDetailInfo.getValueAt(i, 7);
					if (attNum == null)
					{
						attNum = 0;
					}
					dssd.setAttachNum(attNum);
					if (inNum == 0 && attNum == 0)
					{
						continue;
					}
					
					//ì¸å…ãÊï™Å@ébÇ≠ÇÃÇ±Ç∆
					dssd.setInClass(0);
					
					// ìXîÃã∆ñ±ãÊï™
					TableRecord rec = (TableRecord) tblDetailInfo.getValueAt(i,0);
					dssd.setItemUseDivision(rec.getSelectItemUseDivision());
					
					//êVãK
					dssd.setNewSlipDetailNo(con);
					dssd.insert(con);
				}
				
				con.commit();
				
				// ìoò^ÇµÇΩì`ï[Çì«Ç›çûÇ›
				loadSlip(con, dss.getShopId(), dss.getSlipNo());

				MessageDialog.showMessageDialog(this,
					MessageUtil.getMessage(MessageUtil.INFO_REGIST_SUCCESS),
					this.getTitle(),
					JOptionPane.INFORMATION_MESSAGE);
			}
			catch (Exception e)
			{
				con.rollback();
				throw e;
			}
			finally
			{
				con.close();
			}
		}
		catch (RuntimeException ex)
		{
			SystemInfo.getLogger().log(Level.SEVERE, ex.getLocalizedMessage(), ex);
			throw ex;
		}
		catch (Exception ex)
		{
			SystemInfo.getLogger().log(Level.SEVERE, ex.getLocalizedMessage(), ex);

			MessageDialog.showMessageDialog(this,
				MessageUtil.getMessage(MessageUtil.ERROR_REGIST_FAILED, "ì¸å…ì`ï["),
				this.getTitle(),
				JOptionPane.ERROR_MESSAGE);
			return;
		}
	}//GEN-LAST:event_btnRegistActionPerformed
	
	private void personInCdFocusLost(java.awt.event.FocusEvent evt)//GEN-FIRST:event_personInCdFocusLost
	{//GEN-HEADEREND:event_personInCdFocusLost
		UIUtil.selectStaff(personInCd, personInName);
	}//GEN-LAST:event_personInCdFocusLost
	
	private void supplierNoFocusLost(java.awt.event.FocusEvent evt)//GEN-FIRST:event_supplierNoFocusLost
	{//GEN-HEADEREND:event_supplierNoFocusLost
		UIUtil.selectSupplier(supplierNo, supplierName);

		//è§ïiÉäÉXÉgÇçXêVÇ∑ÇÈ
		tblProduct1DoClick();
		tblProduct2DoClick();
		SwingUtil.clearTable(tblDetailInfo);
	}//GEN-LAST:event_supplierNoFocusLost
	
    private void priceDownFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_priceDownFocusLost
		//édì¸ílà¯Ç´ã‡äzÇî≤Ç≠
		int totalMoney = 0;
		for (int i = 0; i < tblDetailInfo.getRowCount(); i++)
		{
			totalMoney += format(tblDetailInfo.getValueAt(i,9));
		}
                //IVS_LVTu start edit 2015/10/22 Bug #43749
                if ( priceDown.getText().matches("-?[0-9]+") ){
                    totalMoney -= format(priceDown.getText());
                }
                //IVS_LVTu end edit 2015/10/22 Bug #43749
		
		//ílÇê›íuÇ∑ÇÈ
		tblTotalInfo.setValueAt(totalMoney,0,3);
    }//GEN-LAST:event_priceDownFocusLost
	
	private boolean inputCheck()
	{
		if (UIUtil.getSupplierID(supplierName) == null)
		{
			MessageDialog.showMessageDialog(this,
				MessageUtil.getMessage(MessageUtil.ERROR_INPUT_EMPTY, "édì¸êÊ"),
				this.getTitle(),
				JOptionPane.ERROR_MESSAGE);
			supplierName.requestFocusInWindow();
			return	false;
		}

		if (checkInDate.getDate() == null)
		{
			MessageDialog.showMessageDialog(this,
				MessageUtil.getMessage(MessageUtil.ERROR_INPUT_EMPTY, "ì¸å…ì˙"),
				this.getTitle(),
				JOptionPane.ERROR_MESSAGE);
			checkInDate.requestFocusInWindow();
			return	false;
		}
		
		MstStaff mstStaff = (MstStaff) personInName.getSelectedItem();
		if (mstStaff == null || mstStaff.getStaffID() == null)
		{
			MessageDialog.showMessageDialog(this,
				MessageUtil.getMessage(MessageUtil.ERROR_INPUT_EMPTY, "ì¸å…íSìñé“"),
				this.getTitle(),
				JOptionPane.ERROR_MESSAGE);
			personInName.requestFocusInWindow();
			return	false;
		}

		if (tblDetailInfo.getRowCount() == 0)
		{
			MessageDialog.showMessageDialog(this,
				MessageUtil.getMessage(MessageUtil.ERROR_NOT_SELECTED, "ì¸å…Ç∑ÇÈè§ïi"),
				this.getTitle(),
				JOptionPane.ERROR_MESSAGE);
			return	false;
		}

		//ì¸å…êîÅAìYïtêîÉfÉtÉHÉãÉgílÇê›íuÇ∑ÇÈ
		for (int i = 0; i < tblDetailInfo.getRowCount(); i++)
		{
			Integer inNum = (Integer) tblDetailInfo.getValueAt(i, 6);
			if (inNum == null)
			{
				tblDetailInfo.setValueAt(0, i, 6);
			}
			Integer attNum = (Integer) tblDetailInfo.getValueAt(i, 7);
			if (attNum == null)
			{
				tblDetailInfo.setValueAt(attNum,i, 7);
			}
		}

		// ì¸å…êî
		for (int i = 0; i < tblDetailInfo.getRowCount(); i++)
		{
			Integer inNum = (Integer) tblDetailInfo.getValueAt(i, 6);
			Integer attNum = (Integer) tblDetailInfo.getValueAt(i, 7);
			if ((inNum != null && inNum < 0) || (attNum != null && attNum < 0))
			{
                            MessageDialog.showMessageDialog(this,
                                    MessageUtil.getMessage(MessageUtil.ERROR_INPUT_WRONG, "ì¸å…êîÇ‹ÇΩÇÕìYïtêî"),
                                    this.getTitle(),
                                    JOptionPane.ERROR_MESSAGE);
                            return false;
			}
		}

		boolean valid = false;
		for (int i = 0; i < tblDetailInfo.getRowCount(); i++)
		{
			Integer inNum = (Integer) tblDetailInfo.getValueAt(i, 6);
			Integer attNum = (Integer) tblDetailInfo.getValueAt(i, 7);
			if ((inNum != null && inNum > 0) || (attNum != null && attNum > 0))
			{
				valid = true;
				break;
			}
		}

		if (!valid)
		{
			MessageDialog.showMessageDialog(this,
				MessageUtil.getMessage(MessageUtil.ERROR_INPUT_EMPTY, "ì¸å…êîÇ‹ÇΩÇÕìYïtêî"),
				this.getTitle(),
				JOptionPane.ERROR_MESSAGE);
			return false;
		}
                
                //IVS_LVTu start add 2015/10/22 Bug #43749
                if(!priceDown.getText().matches("-?[0-9]+") && !priceDown.getText().trim().equals(""))
                {
                        MessageDialog.showMessageDialog(this,
                                        "édì¸ílà¯Ç´ÇÕêîéöÇ≈ì¸óÕÇµÇƒÇ≠ÇæÇ≥Ç¢ÅB",
                                        this.getTitle(),
                                        JOptionPane.ERROR_MESSAGE);
                        priceDown.requestFocusInWindow();
                        return	false;
                }
                //IVS_LVTu end add 2015/10/22 Bug #43749

		return true;
	}
    private void tblProductDetail2MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tblProductDetail2MouseClicked
		if (evt.getClickCount() == 2 && evt.getButton() == 1)
		{
			//í«â¡è§ïiÇ™ÉäÉXÉgÇ…ë∂ç›Ç©Ç«Ç§Ç©ämîFÇ∑ÇÈ
			if (!singleCheck(2, (MstItem) tblProductDetail2.getValueAt(tblProductDetail2.getSelectedRow(),0)))
			{
				return;
			}

			//ÉCÉxÉìÉgÉtÉâÉbÉOÇê›íuÇ∑ÇÈ
			setEventFlg(0);

			Vector vec = new Vector();
			//ópìrÇê›íuÇ∑ÇÈ
			MstItem item = (MstItem)tblProductDetail2.getValueAt(tblProductDetail2.getSelectedRow(),0);
			TableRecord rec = new TableRecord();
			rec.setItemId(item.getItemID());
			rec.setSelectItemUseDivision(2);

			vec.add(rec);
			vec.add(tblProduct2.getValueAt(tblProduct2.getSelectedRow(),0));
			vec.add(tblProductDetail2.getValueAt(tblProductDetail2.getSelectedRow(),0));
			vec.add(tblProductDetail2.getValueAt(tblProductDetail2.getSelectedRow(),1));
			vec.add(tblProductDetail2.getValueAt(tblProductDetail2.getSelectedRow(),2));
			vec.add(null);
			vec.add(null);
			vec.add(null);
			vec.add(null);
			vec.add(null);
			vec.add(getDeleteButton());

			//àÍçsÇí«â¡Ç∑ÇÈ
			//int rowIndex = findInsertPoint(tblDetailInfo, 2, item);
			//((DefaultTableModel)tblDetailInfo.getModel()).insertRow(rowIndex, vec);
			((DefaultTableModel)tblDetailInfo.getModel()).addRow(vec);

                        tblDetailInfo.changeSelection(tblDetailInfo.getRowCount() - 1, 6, false, false);
                        tblDetailInfo.requestFocusInWindow();
                        
			//ÉCÉxÉìÉgÉtÉâÉbÉOÇê›íuÇ∑ÇÈ
			setEventFlg(1);
		}
		
    }//GEN-LAST:event_tblProductDetail2MouseClicked

	private void tblProduct2DoClick()
	{
		if (tblProduct2.getSelectedRow() < 0)
		{
			SwingUtil.clearTable(tblProductDetail2);
			return;
		}

		MstItemClass mic = (MstItemClass)tblProduct2.getValueAt(tblProduct2.getSelectedRow(),0);

		Integer supplierID = UIUtil.getSupplierID(supplierName);
		if (supplierID == null)
		{
			SwingUtil.clearTable(tblProductDetail2);
			return;
		}

		MstShop mstShop = (MstShop) shop.getSelectedItem();

		MstSupplierItems mis = new MstSupplierItems(mic.getItemClassID(), 2, UIUtil.getSupplierID(supplierName));
		mis.setShopId(mstShop.getShopID());
		try
		{
			mis.load(SystemInfo.getConnection());
			//è§ïiÉäÉXÉgÇèâä˙âªÇ∑ÇÈ
			SwingUtil.clearTable(tblProductDetail2);

			double taxRate = SystemInfo.getTaxRate(new Date());
			for (int i = 0; i<mis.size(); i++)
			{
				if (i == tblProductDetail2.getModel().getRowCount())
				{
					((DefaultTableModel)tblProductDetail2.getModel()).addRow(new Vector());
				}
				tblProductDetail2.setValueAt(mis.get(i),i,0) ;

				int price = mis.get(i).getCostPrice();
				tblProductDetail2.setValueAt(price,i,1) ;

				//IVS_LVTu start edit 2015/09/30 Bug #43033
                                //tblProductDetail2.setValueAt(price - (TaxUtil.getTax(price, taxRate, 1)),i,2) ;
                                tblProductDetail2.setValueAt(getTaxOffPrice(price,taxRate),i,2) ;
                                //IVS_LVTu end edit 2015/09/30 Bug #43033
			}
		}
		catch (RuntimeException ex)
		{
			SystemInfo.getLogger().log(Level.SEVERE, ex.getLocalizedMessage(), ex);
			throw ex;
		}
		catch (Exception ex)
		{
			SystemInfo.getLogger().log(Level.SEVERE, ex.getLocalizedMessage(), ex);
			MessageDialog.showMessageDialog(this,
				MessageUtil.getMessage(1099),
				this.getTitle(),
				JOptionPane.ERROR_MESSAGE);
		}
	}

    private void tblProductDetail1MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tblProductDetail1MouseClicked
		if (evt.getClickCount() == 2 && evt.getButton() == 1)
		{
			//í«â¡è§ïiÇ™ÉäÉXÉgÇ…ë∂ç›Ç©Ç«Ç§Ç©ämîFÇ∑ÇÈ
			if (!singleCheck(1, (MstItem) tblProductDetail1.getValueAt(tblProductDetail1.getSelectedRow(),0)))
			{
				return;
			}

			Vector vec = new Vector();

			//ÉCÉxÉìÉgÉtÉâÉbÉOÇê›íuÇ∑ÇÈ
			setEventFlg(0);
			
			//ópìrÇê›íuÇ∑ÇÈ
			MstItem item = (MstItem)tblProductDetail1.getValueAt(tblProductDetail1.getSelectedRow(),0);
			TableRecord rec = new TableRecord();
			rec.setItemId(item.getItemID());
			rec.setSelectItemUseDivision(1);

			vec.add(rec);
			vec.add(tblProduct1.getValueAt(tblProduct1.getSelectedRow(),0));
			vec.add(tblProductDetail1.getValueAt(tblProductDetail1.getSelectedRow(),0));
			vec.add(tblProductDetail1.getValueAt(tblProductDetail1.getSelectedRow(),1));
			vec.add(tblProductDetail1.getValueAt(tblProductDetail1.getSelectedRow(),2));
			vec.add(null);
			vec.add(null);
			vec.add(null);
			vec.add(null);
			vec.add(null);
			vec.add(getDeleteButton());

			//àÍçsÇí«â¡Ç∑ÇÈ
			//int rowIndex = findInsertPoint(tblDetailInfo, 1, item);
			//((DefaultTableModel)tblDetailInfo.getModel()).insertRow(rowIndex, vec);
			((DefaultTableModel)tblDetailInfo.getModel()).addRow(vec);

                        tblDetailInfo.changeSelection(tblDetailInfo.getRowCount() - 1, 6, false, false);
                        tblDetailInfo.requestFocusInWindow();
                        
			//ÉCÉxÉìÉgÉtÉâÉbÉOÇê›íuÇ∑ÇÈ
			setEventFlg(1);
		}
    }//GEN-LAST:event_tblProductDetail1MouseClicked
    //IVS_LVTu start add 2014/07/29 Mashu_ì¸å…ä«óùÉtÉHÅ[É}ÉbÉgéÊÇËçûÇ›
    private void butGoodsImportActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_butGoodsImportActionPerformed
        
        importData();
    }//GEN-LAST:event_butGoodsImportActionPerformed

    /**
     * method importData.
     * import file excel, get data from file, insert into database.
     */
    public void importData()
    {
        OptionFilePanel ofp = new OptionFilePanel();
        ofp.setOpener(this);
        for ( int i = 0 ;i < shop.getItemCount();i ++)
        {
            MstShop mstShop = (MstShop)shop.getItemAt(i);
            ofp.arrShopId.add(mstShop.getShopID());
        }
        SwingUtil.openAnchorDialog( null, true, ofp, "Å•ÉtÉ@ÉCÉãëIëâÊñ ", SwingUtil.ANCHOR_HCENTER | SwingUtil.ANCHOR_VCENTER );
        if (ofp.shopId == null || ofp.slipNo == null)
        {
            return;
        }
        try
        {
                ConnectionWrapper con = SystemInfo.getConnection();
                try
                {
                        loadSlip(con, ofp.shopId, ofp.slipNo);
                }
                finally
                {
                        con.close();
                }
        }
        catch (RuntimeException ex)
        {
                SystemInfo.getLogger().log(Level.SEVERE, ex.getLocalizedMessage(), ex);
                throw ex;
        }
        catch (Exception ex)
        {
                SystemInfo.getLogger().log(Level.SEVERE, ex.getLocalizedMessage(), ex);
                MessageDialog.showMessageDialog(this,
                        MessageUtil.getMessage(1099),
                        this.getTitle(),
                        JOptionPane.ERROR_MESSAGE);
        }
    }
    //IVS_LVTu end add 2014/07/29 Mashu_ì¸å…ä«óùÉtÉHÅ[É}ÉbÉgéÊÇËçûÇ›
	/**
	 * FocusTraversalPolicy
	 */
	private	FocusTraversalPolicy traversalPolicy	=
		new RegisterCheckInVoucherPanelFocusTraversalPolicy();
	
	/**
	 * FocusTraversalPolicyÇéÊìæÇ∑ÇÈÅB
	 * @return FocusTraversalPolicy
	 */
	public FocusTraversalPolicy getFocusTraversalPolicy()
	{
		return	traversalPolicy;
	}

	private int findInsertPoint(JTable tblDetailInfo, int itemUseDivision, MstItem item)
	{
		int itemClassDispSeq = classes.lookup(item.getItemClass().getItemClassID()).getDisplaySeq();
		int itemDispSeq = item.getDisplaySeq();
		
		int cnt = tblDetailInfo.getRowCount();
		for (int i = 0; i < cnt; i++)
		{
			int rowItemUseDivision = ((TableRecord) tblDetailInfo.getValueAt(i, 0)).getSelectItemUseDivision();
			if (rowItemUseDivision > itemUseDivision)
			{
				return i;
			}
			else if (rowItemUseDivision == itemUseDivision)
			{
				MstItem rowItem = (MstItem) tblDetailInfo.getValueAt(i, 2);
				MstItemClass cls = classes.lookup(rowItem.getItemClass().getItemClassID());
				if (cls.getDisplaySeq() > itemClassDispSeq)
				{
					return i;
				}
				else if (cls.getDisplaySeq() == itemClassDispSeq)
				{
					if (rowItem.getDisplaySeq() > itemDispSeq)
					{
						return i;
					}
				}
			}
		}
		
		return cnt;
	}

	private void tblProduct1DoClick()
	{
		if (tblProduct1.getSelectedRow() < 0)
		{
			SwingUtil.clearTable(tblProductDetail1);
			return;
		}
		MstItemClass mic = (MstItemClass)tblProduct1.getValueAt(tblProduct1.getSelectedRow(),0);

		Integer supplierID = UIUtil.getSupplierID(supplierName);
		if (supplierID == null)
		{
			SwingUtil.clearTable(tblProductDetail1);
			return;
		}

		MstShop mstShop = (MstShop) shop.getSelectedItem();

		MstSupplierItems mis = new MstSupplierItems(mic.getItemClassID(), 1, supplierID);
		mis.setShopId(mstShop.getShopID());
		try
		{
			mis.load(SystemInfo.getConnection());
			//è§ïiÉäÉXÉgÇèâä˙âªÇ∑ÇÈ
			SwingUtil.clearTable(tblProductDetail1);

			double taxRate = SystemInfo.getTaxRate(new Date());
			for (int i = 0; i<mis.size(); i++)
			{
				if (i == tblProductDetail1.getModel().getRowCount())
				{
					((DefaultTableModel)tblProductDetail1.getModel()).addRow(new Vector());
				}
				tblProductDetail1.setValueAt(mis.get(i),i,0) ;

				int price = mis.get(i).getCostPrice();
				tblProductDetail1.setValueAt(price,i,1) ;

				//IVS_LVTu start edit 2015/09/30 Bug #43033
                                //tblProductDetail1.setValueAt(price - (TaxUtil.getTax(price, taxRate, 1)),i,2) ;
                                tblProductDetail1.setValueAt(getTaxOffPrice(price, taxRate),i,2) ;
                                //IVS_LVTu end edit 2015/09/30 Bug #43033
			}
		}
		catch (RuntimeException ex)
		{
			SystemInfo.getLogger().log(Level.SEVERE, ex.getLocalizedMessage(), ex);
			throw ex;
		}
		catch (Exception ex)
		{
			SystemInfo.getLogger().log(Level.SEVERE, ex.getLocalizedMessage(), ex);
			MessageDialog.showMessageDialog(this,
				MessageUtil.getMessage(1099),
				this.getTitle(),
				JOptionPane.ERROR_MESSAGE);
		}
	}
	
	/**
	 * î≠íçèëåüçıÉ{É^Éìâüâ∫éûèàóù
	 */
	public void loadOrder()
	{
		SystemInfo.getLogger().log(Level.INFO, "î≠íçèëåüçı");
		SearchSlipDialog	ssp	=	new SearchSlipDialog(parentFrame, true, SearchSlip.SlipType.ORDER);
		ssp.setShop((MstShop) shop.getSelectedItem());
		ssp.setVisible(true);
		
		//ì`ï[Ç™ëIëÇ≥ÇÍÇΩèÍçá
		if(ssp.getSelectedSlip() != null)
		{
			SlipData sd = ssp.getSelectedSlip();
			
			DataSlipOrder data = new DataSlipOrder();
			data.setShopId(sd.getShopID());
			data.setSlipNo(sd.getSlipNo());
			
			data.load(sd.getShopID(),sd.getSlipNo());
			
			this.showOrderData(data);
			
			dataSlipOrder = data;
		}

		ssp.dispose();
	}
	
	/*
	 *åüçıåãâ Çï\é¶Ç∑ÇÈ
	 */
	private void showOrderData(DataSlipOrder data)
	{
		//clear
		clear();
		
		//ìXï‹
		MstShop mstShop = new MstShop();
		mstShop.setShopID(data.getShopId());
		shop.setSelectedItem(mstShop);
		
		// édì¸êÊ
		MstSupplier mstSupplier = new MstSupplier();
		mstSupplier.setSupplierID(data.getSupplierId());
		supplierName.setSelectedItem(mstSupplier);
		
		//ì¸å…íSìñé“
		personInName.setSelectedIndex(0);
		
		//ì`ï[NO
		try
		{
			ConnectionWrapper con = SystemInfo.getConnection();
			try
			{
				//ì`ï[è⁄ç◊èÓïÒ
				DataSlipOrderDetail [] dssd = data.getDetail();
				
				double taxRate = SystemInfo.getTaxRate(new Date());
				for (int i = 0; i<dssd.length; i++ )
				{
					((DefaultTableModel)tblDetailInfo.getModel()).addRow(new Vector());
					
					DataSlipOrderDetail detail = dssd[i];
					//ãÊï™
					TableRecord rec = new TableRecord();
					rec.setItemId(detail.getItemID());
					rec.setSelectItemUseDivision(detail.getItemUseDivision());
					
					tblDetailInfo.setValueAt(rec,i,0);
					
					//ï™óﬁÅEè§ïiñºÅEédì¸âøäiÅiê≈çûÅjÅEédì¸âøäiÅiê≈î≤Åj
					MstItem item = new MstItem();
					item.setItemID(detail.getItemID());
					item.load(con);
					
					tblDetailInfo.setValueAt(item.getItemClass(),i,1);
					tblDetailInfo.setValueAt(item,i,2);
					
					tblDetailInfo.setValueAt(detail.getCostPrice(),i,3);
					
					//IVS_LVTu start edit 2015/09/30 Bug #43033
                                        //int taxValue = TaxUtil.getTax(detail.getCostPrice(), taxRate, 1);
					//tblDetailInfo.setValueAt(detail.getCostPrice() - taxValue,i,4);
                                        tblDetailInfo.setValueAt(getTaxOffPrice(detail.getCostPrice(), taxRate),i,4);
                                        //IVS_LVTu end edit 2015/09/30 Bug #43033
					
					//î≠íçêî
					tblDetailInfo.setValueAt(new Integer(detail.getOrderNum()),i,5);
					
					//ì¸å…êîÅEìYïtêî
					tblDetailInfo.setValueAt(new Integer(0),i,6);
					tblDetailInfo.setValueAt(new Integer(0),i,7);
					//çÌèúÉ{É^Éì
					tblDetailInfo.setValueAt(getDeleteButton(),i,10);
				}
			}
			finally
			{
				con.close();
			}
			//çƒåvéZ
			detailSearchResultInit(tblDetailInfo);
			//ì¸óÕïsâ¬Ç…Ç∑ÇÈ
			enableSearchCondition(SearchMode.SLIP_ORDER);
		}
		catch (RuntimeException ex)
		{
			SystemInfo.getLogger().log(Level.SEVERE, ex.getLocalizedMessage(), ex);
			throw ex;
		}
		catch (Exception ex)
		{
			SystemInfo.getLogger().log(Level.SEVERE, ex.getLocalizedMessage(), ex);
			MessageDialog.showMessageDialog(this,
				MessageUtil.getMessage(1099),
				this.getTitle(),
				JOptionPane.ERROR_MESSAGE);
		}
	}
	
	/**
	 * ì¸å…ì`ï[ì«Ç›çûÇ›èàóù
	 */
	public void loadSlip(ConnectionWrapper con, int shopId, int slipNo) throws SQLException
	{
		data = new DataSlipStore();
		dataSlipOrder = null;
		
		data.setShopId(shopId);
		data.setSlipNo(slipNo);
		
		data.load(con);
		if (data.getOrderSlipNo() != null && data.getOrderSlipNo() > 0)
		{
			dataSlipOrder = new DataSlipOrder();
			dataSlipOrder.load(con, data.getShopId(), data.getOrderSlipNo());
		}
		this.showSlipData(con, data, dataSlipOrder);
		
		setNewFlag(0);
	}
	
	/**
	 * ì`ï[åüçıÉ{É^Éìâüâ∫éûèàóù
	 */
	public void loadSlip()
	{
		SystemInfo.getLogger().log(Level.INFO, "ì`ï[åüçı");
		SearchSlipDialog	ssp	=	new SearchSlipDialog(parentFrame, true, SearchSlip.SlipType.STORE);
		ssp.setShop((MstShop) shop.getSelectedItem());
		ssp.setVisible(true);
		
		//ì`ï[Ç™ëIëÇ≥ÇÍÇΩèÍçá
		if(ssp.getSelectedSlip() != null)
		{
			SlipData sd = ssp.getSelectedSlip();
			
			try
			{
				ConnectionWrapper con = SystemInfo.getConnection();
				try
				{
					loadSlip(con, sd.getShopID(), sd.getSlipNo());
					//êVãKÉtÉâÉOÇê›íuÇ∑ÇÈ
					setNewFlag(0);
				}
				finally
				{
					con.close();
				}
			}
			catch (RuntimeException ex)
			{
				SystemInfo.getLogger().log(Level.SEVERE, ex.getLocalizedMessage(), ex);
				ssp.dispose();
				throw ex;
			}
			catch (Exception ex)
			{
				SystemInfo.getLogger().log(Level.SEVERE, ex.getLocalizedMessage(), ex);
				MessageDialog.showMessageDialog(this,
					MessageUtil.getMessage(1099),
					this.getTitle(),
					JOptionPane.ERROR_MESSAGE);
			}
		}

		ssp.dispose();
	}
	
	/*
	 *åüçıåãâ Çï\é¶Ç∑ÇÈ
	 */
	private void showSlipData(ConnectionWrapper con, DataSlipStore dataStore, DataSlipOrder dataOrder) throws SQLException
	{
		//clear
		clear();
		
		this.data = dataStore;
		this.dataSlipOrder = dataOrder;
		
		//ì`ï[NO
		voucherNo.setText(data.getSlipNo()+"");
		voucherNo.setHorizontalAlignment(javax.swing.JTextField.TRAILING);
		
		//ìXï‹
		MstShop mstShop = new MstShop();
		mstShop.setShopID(data.getShopId());
		shop.setSelectedItem(mstShop);
		
		//édì¸êÊ
		MstSupplier supplier = new MstSupplier();
		supplier.setSupplierID(data.getSupplierId());
		supplierName.setSelectedItem(supplier);
		
		//ì¸å…ì˙
		checkInDate.setDate(data.getStoreDate());
		
		//ì¸å…íSìñé“
		MstStaff staff = new MstStaff(data.getStaffId());
		staff.load(con);
		personInCd.setText(staff.getStaffNo());
                UIUtil.selectStaff(personInCd, personInName);
		
		//édì¸ílà¯Ç´
		priceDown.setText(data.getDiscount() + "");
		//ì`ï[è⁄ç◊èÓïÒ
		DataSlipStoreDetails dssd = new DataSlipStoreDetails();
		dssd.setShopId(data.getShopId());
		dssd.setSlipNo(data.getSlipNo());
		
		dssd.load(con,false);
		
		double taxRate = SystemInfo.getTaxRate(new Date());
		for (int i = 0; i<dssd.size(); i++ )
		{
			((DefaultTableModel)tblDetailInfo.getModel()).addRow(new Vector());
			
			DataSlipStoreDetail detail = dssd.get(i);
			//ãÊï™
			TableRecord rec = new TableRecord();
			rec.setItemId(detail.getItemId());
			rec.setSelectItemUseDivision(detail.getItemUseDivision());
			
			tblDetailInfo.setValueAt(rec,i,0);
			
			//ï™óﬁÅEè§ïiñºÅEédì¸âøäiÅiê≈çûÅjÅEédì¸âøäiÅiê≈î≤Åj
			MstItem item = new MstItem();
			item.setItemID(detail.getItemId());
			item.load(SystemInfo.getConnection());
			
			tblDetailInfo.setValueAt(item.getItemClass(),i,1);
			tblDetailInfo.setValueAt(item,i,2);
			
			tblDetailInfo.setValueAt(detail.getCostPrice(),i,3);
			
			//IVS_LVTu start edit 2015/09/30 Bug #43033
                        //int taxValue = TaxUtil.getTax(detail.getCostPrice(), taxRate, 1);
			//tblDetailInfo.setValueAt(detail.getCostPrice() - taxValue,i,4);
                        tblDetailInfo.setValueAt(getTaxOffPrice(detail.getCostPrice(), taxRate),i,4);
                        //IVS_LVTu end edit 2015/09/30 Bug #43033
			
			//î≠íçêî
			if (dataOrder != null)
			{
				DataSlipOrderDetail[] orderDetailArray = dataOrder.getDetail();
				for (int j = 0; j < orderDetailArray.length; j++)
				{
					DataSlipOrderDetail od = orderDetailArray[j];
					if (detail.getItemId() == od.getItemID() && detail.getItemUseDivision() == od.getItemUseDivision())
					{
						tblDetailInfo.setValueAt(od.getOrderNum(),i,5);
						break;
					}
				}
			}
			
			//ì¸å…êîÅEìYïtêî
			tblDetailInfo.setValueAt(detail.getInNum(),i,6);
			tblDetailInfo.setValueAt(detail.getAttachNum(),i,7);
			//çÌèúÉ{É^Éì
			tblDetailInfo.setValueAt(getDeleteButton(),i,10);
		}
		//çƒåvéZ
		detailSearchResultInit(tblDetailInfo);
		
		//disable édì¸êÊÅEì¸å…ì˙ÅEì¸å…íSìñé“
		enableSearchCondition(SearchMode.SLIP_STORE);
	}
	
   /*
	*åüçıåãâ çƒåvéZ
	*/
	private void detailSearchResultInit(JTable table)
	{
		//édì¸âøäi
		int PRICE_COLUMN = 3;
		//ì¸å…êî
		int IN_COLUMN = 6;
		//ìYïtêî
		int ATTACHMENT_COLUMN = 7;
		//ì¸å…åv
		int IN_ACCOUNT_COLUMN = 8;
		//ì¸å…ã‡äz
		int IN_MONEY_COLUMN = 9;
		
		//èâä˙âªÇ‹ÇæÉAÉCÉeÉÄí«â¡éûÅAèàóùÇµÇ»Ç¢
//        if (getEventFlg() == 0) {
//            return;
//        }
		
		//çáåvì¸å…êî,ìYïtêîÅAì¸å…åvÅAÇ‹Çæì¸å…ã‡äzÇçXêVÇ∑ÇÈ
		int totalIn = 0;
		int totalAttach = 0;
		int totalAccount = 0;
		int totalMoney = 0;
		for (int i = 0; i < table.getRowCount(); i++)
		{
			//ì¸å…åvÇ∆ì¸å…ã‡äzÇçXêVÇ∑ÇÈ
			int inAccount = format(table.getValueAt(i,IN_COLUMN)) + format(table.getValueAt(i,ATTACHMENT_COLUMN));
			int inMoney = format(table.getValueAt(i,PRICE_COLUMN)) * format(table.getValueAt(i,IN_COLUMN));
			
			table.setValueAt(inAccount,i,IN_ACCOUNT_COLUMN);
			table.setValueAt(inMoney,i,IN_MONEY_COLUMN);
			
			totalIn += format(table.getValueAt(i,IN_COLUMN));
			totalAttach += format(table.getValueAt(i,ATTACHMENT_COLUMN));
			totalAccount += format(table.getValueAt(i,IN_ACCOUNT_COLUMN));
			totalMoney += format(table.getValueAt(i,IN_MONEY_COLUMN));
		}
		
		//édì¸ílà¯Ç´ã‡äzÇî≤Ç≠
		totalMoney -= format(priceDown.getText());
		
		//ílÇê›íuÇ∑ÇÈ
		tblTotalInfo.setValueAt(totalIn,0,0);
		tblTotalInfo.setValueAt(totalAttach,0,1);
		tblTotalInfo.setValueAt(totalAccount,0,2);
		tblTotalInfo.setValueAt(totalMoney,0,3);
		
		//
		setEventFlg(1);
	}
	
	
	private void initItemClass()
	{
		try
		{
			classes.loadAll(SystemInfo.getConnection());
			for (int i = 0;i < classes.size(); i++)
			{
				MstItemClass class1 = classes.get(i);

				if (i == tblProduct1.getModel().getRowCount())
				{
					((DefaultTableModel)tblProduct1.getModel()).addRow(new Vector());
				}
				tblProduct1.setValueAt(class1,i,0) ;

				if (i == tblProduct2.getModel().getRowCount())
				{
					((DefaultTableModel)tblProduct2.getModel()).addRow(new Vector());
				}
				tblProduct2.setValueAt(class1,i,0);
			}
		}
		catch (RuntimeException ex)
		{
			SystemInfo.getLogger().log(Level.SEVERE, ex.getLocalizedMessage(), ex);
			throw ex;
		}
		catch (Exception ex)
		{
			SystemInfo.getLogger().log(Level.SEVERE, ex.getLocalizedMessage(), ex);
			MessageDialog.showMessageDialog(this,
				MessageUtil.getMessage(1099),
				this.getTitle(),
				JOptionPane.ERROR_MESSAGE);
		}
	}
	
	private boolean singleCheck(int selectItemUseDivision, MstItem item)
	{
		for (int i = 0; i < tblDetailInfo.getRowCount(); i++)
		{
			TableRecord torec = (TableRecord) tblDetailInfo.getValueAt(i,0);
			
			if (selectItemUseDivision == torec.getSelectItemUseDivision()
			&& torec.getItemId().equals(item.getItemID()))
			{
				return false;
			}
		}
		
		return true;
	}

	public int getEventFlg()
	{
		return eventFlg;
	}
	
	public void setEventFlg(int eventFlg)
	{
		this.eventFlg = eventFlg;
	}
	
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnClear;
    private javax.swing.JButton btnDelete;
    private javax.swing.JButton btnRegist;
    private javax.swing.JButton btnSearchOrder;
    private javax.swing.JButton btnSearchSlip;
    private javax.swing.JButton butGoodsImport;
    private jp.co.flatsoft.fscomponent.FSCalenderCombo checkInDate;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane6;
    private javax.swing.JScrollPane jScrollPane7;
    private javax.swing.JTabbedPane jTabbedPane1;
    private javax.swing.JScrollPane panelDetail;
    private javax.swing.JPanel panelForBuiness;
    private javax.swing.JPanel panelForShopSale;
    private javax.swing.JScrollPane panelTotal;
    private javax.swing.JFormattedTextField personInCd;
    private javax.swing.JComboBox personInName;
    private javax.swing.JFormattedTextField priceDown;
    private com.geobeck.sosia.pos.swing.JComboBoxLabel shop;
    private javax.swing.JComboBox supplierName;
    private javax.swing.JFormattedTextField supplierNo;
    private com.geobeck.swing.JTableEx tblDetailInfo;
    private javax.swing.JTable tblProduct1;
    private javax.swing.JTable tblProduct2;
    private javax.swing.JTable tblProductDetail1;
    private javax.swing.JTable tblProductDetail2;
    private javax.swing.JTable tblTotalInfo;
    private javax.swing.JTextField voucherNo;
    // End of variables declaration//GEN-END:variables
	
	class SelectionListener implements TableModelListener
	{
		JTable table;
		
		// It is necessary to keep the table since it is not possible
		// to determine the table from the event's source
		SelectionListener(JTable table)
		{
			this.table = table;
		}
		
		
		public void tableChanged(TableModelEvent e)
		{
			int column = e.getColumn();
			int row = e.getFirstRow();
			
			reCalculate(table,row,column);
		}
		
	}
	
	
	private void reCalculate(JTable table, int row, int column)
	{
		//édì¸âøäi
		int PRICE_COLUMN = 3;
		//ì¸å…êî
		int IN_COLUMN = 6;
		//ìYïtêî
		int ATTACHMENT_COLUMN = 7;
		//ì¸å…åv
		int IN_ACCOUNT_COLUMN = 8;
		//ì¸å…ã‡äz
		int IN_MONEY_COLUMN = 9;
		
		//èâä˙âªÇ‹ÇæÉAÉCÉeÉÄí«â¡éûÅAèàóùÇµÇ»Ç¢
		if (getEventFlg() == 0)
		{
			return;
		}
		
		if (column == IN_COLUMN || column == ATTACHMENT_COLUMN)
		{
			//ì¸å…åvÇ∆ì¸å…ã‡äzÇçXêVÇ∑ÇÈ
			int inAccount = format(table.getValueAt(row,IN_COLUMN)) + format(table.getValueAt(row,ATTACHMENT_COLUMN));
			int inMoney = format(table.getValueAt(row,PRICE_COLUMN)) * format(table.getValueAt(row,IN_COLUMN));
			
			table.setValueAt(inAccount,row,IN_ACCOUNT_COLUMN);
			table.setValueAt(inMoney,row,IN_MONEY_COLUMN);
			
			//çáåvì¸å…êî,ìYïtêîÅAì¸å…åvÅAÇ‹Çæì¸å…ã‡äzÇçXêVÇ∑ÇÈ
			int totalIn = 0;
			int totalAttach = 0;
			int totalAccount = 0;
			int totalMoney = 0;
			for (int i = 0; i < table.getRowCount(); i++)
			{
				totalIn += format(table.getValueAt(i,IN_COLUMN));
				totalAttach += format(table.getValueAt(i,ATTACHMENT_COLUMN));
				totalAccount += format(table.getValueAt(i,IN_ACCOUNT_COLUMN));
				totalMoney += format(table.getValueAt(i,IN_MONEY_COLUMN));
			}
			
			//édì¸ílà¯Ç´ã‡äzÇî≤Ç≠
			totalMoney -= format(priceDown.getText());
			
			//ílÇê›íuÇ∑ÇÈ
			tblTotalInfo.setValueAt(totalIn,0,0);
			tblTotalInfo.setValueAt(totalAttach,0,1);
			tblTotalInfo.setValueAt(totalAccount,0,2);
			tblTotalInfo.setValueAt(totalMoney,0,3);
			
		}
	}
	/*
	 * êîó ÇÃäiéÆâª
	 */
	private int format(Object obj)
	{
		if (obj == null) return 0;
		
		String str = obj + "";
		
		if (str == null || str.equals(""))
		{
			return 0;
		}
		
		return Integer.parseInt(str);
	}

	/*
	 * ì`ï[åüçıÇ†ÇÈÇ¢ÇÕî≠íçèëåüçıÇÃèÍçáÅAåüçıèåèÇÃì¸óÕã÷é~Ç≈Ç∑
	 */
	private void enableSearchCondition(SearchMode mode)
	{
		switch (mode)
		{
			case NONE:
				if (shop.getItemCount() > 1)
				{
					shop.setEnabled(true);
				}
				supplierNo.setEditable(true);
				supplierName.setEnabled(true);
				checkInDate.setEditable(true);
				personInCd.setEditable(true);
				personInName.setEnabled(true);
				btnRegist.setEnabled(true);
				btnDelete.setEnabled(false);
				break;
			case SLIP_STORE:
				if (shop.getItemCount() > 1)
				{
					shop.setEnabled(false);
				}
				supplierNo.setEditable(false);
				supplierName.setEnabled(false);
				checkInDate.setEditable(true);
				personInCd.setEditable(true);
				personInName.setEnabled(true);
				btnRegist.setEnabled(true);
				btnDelete.setEnabled(true);
				break;
			case SLIP_ORDER:
				if (shop.getItemCount() > 1)
				{
					shop.setEnabled(false);
				}
				supplierNo.setEditable(false);
				supplierName.setEnabled(false);
				checkInDate.setEditable(true);
				personInCd.setEditable(true);
				personInName.setEnabled(true);
				btnRegist.setEnabled(true);
				btnDelete.setEnabled(false);

				break;
		}
	}
	
	public int getNewFlag()
	{
		return newFlag;
	}
	
	public void setNewFlag(int newFlag)
	{
		this.newFlag = newFlag;
	}
	
	/*
	 *êVãKèÛë‘Ç…ñﬂÇÈ
	 */
	private void clear()
	{
		data = new DataSlipStore();
		dataSlipOrder = null;
		
		voucherNo.setText("ÅÉêVãKÅÑ");
		supplierNo.setText("");
		supplierName.setSelectedIndex(0);
		
		checkInDate.setDate(new java.util.Date());
		personInCd.setText("");
		personInName.setSelectedIndex(0);
		
		priceDown.setText("0");
		
		SwingUtil.clearTable(tblProductDetail1);
		SwingUtil.clearTable(tblProductDetail2);
		SwingUtil.clearTable(tblDetailInfo);
		
		//ëçåvèâä˙âª
		SwingUtil.clearTable(tblTotalInfo);
		//àÍçsÇí«â¡Ç∑ÇÈ
		((DefaultTableModel)tblTotalInfo.getModel()).addRow(new Vector());
		
		//êVãKÉtÉâÉOÇê›íuÇ∑ÇÈ
		setNewFlag(1);
		
		//enable
		enableSearchCondition(SearchMode.NONE);
	}
	
	/**
	 * íSìñé“Çèâä˙âªÇ∑ÇÈÅB
	 */
	protected void initStaff( JComboBox cb )
	{
		cb.addItem(new MstStaff());
		SystemInfo.initStaffComponent(cb);
		
		cb.setSelectedIndex(0);
	}
	
	/**
	 *
	 */
	private void addMouseCursorChange()
	{
		SystemInfo.addMouseCursorChange(btnSearchSlip);
		SystemInfo.addMouseCursorChange(btnSearchOrder);
		SystemInfo.addMouseCursorChange(btnRegist);
		SystemInfo.addMouseCursorChange(btnDelete);
		SystemInfo.addMouseCursorChange(btnClear);
                //IVS_LVTu start edit 2014/10/13 Mashu_ì¸å…ä«óùÉtÉHÅ[É}ÉbÉgéÊÇËçûÇ›
                SystemInfo.addMouseCursorChange(butGoodsImport);
                //IVS_LVTu end edit 2014/10/13 Mashu_ì¸å…ä«óùÉtÉHÅ[É}ÉbÉgéÊÇËçûÇ›
	}
	
	/**
	 *
	 */
	private void setKeyListener()
	{
		shop.addKeyListener(SystemInfo.getMoveNextField());
		shop.addFocusListener(SystemInfo.getSelectText());
		supplierName.addKeyListener(SystemInfo.getMoveNextField());
		supplierName.addFocusListener(SystemInfo.getSelectText());
		supplierNo.addKeyListener(SystemInfo.getMoveNextField());
		supplierNo.addFocusListener(SystemInfo.getSelectText());
		checkInDate.addKeyListener(SystemInfo.getMoveNextField());
		checkInDate.addFocusListener(SystemInfo.getSelectText());
		personInCd.addKeyListener(SystemInfo.getMoveNextField());
		personInCd.addFocusListener(SystemInfo.getSelectText());
		personInName.addKeyListener(SystemInfo.getMoveNextField());
	}
	
	/**
	 * ñæç◊ÇÃóÒÇèâä˙âªÇ∑ÇÈÅB
	 */
	private void initDetailColumn()
	{
		//óÒÇÃïùÇê›íËÇ∑ÇÈÅB
		tblDetailInfo.getColumnModel().getColumn(0).setPreferredWidth(45);		// ãÊï™
		tblDetailInfo.getColumnModel().getColumn(1).setPreferredWidth(80);		// ï™óﬁ
		tblDetailInfo.getColumnModel().getColumn(2).setPreferredWidth(210);		// è§ïi
		tblDetailInfo.getColumnModel().getColumn(3).setPreferredWidth(60);		// édì¸âøäi(ê≈çû)
		tblDetailInfo.getColumnModel().getColumn(4).setPreferredWidth(60);		// édì¸âøäi(ê≈î≤)
		tblDetailInfo.getColumnModel().getColumn(5).setPreferredWidth(60);		// î≠íçêî
		tblDetailInfo.getColumnModel().getColumn(6).setPreferredWidth(65);		// ì¸å…êî
		tblDetailInfo.getColumnModel().getColumn(7).setPreferredWidth(65);		// ìYïtêî
		tblDetailInfo.getColumnModel().getColumn(8).setPreferredWidth(65);		// ì¸å…åv
		tblDetailInfo.getColumnModel().getColumn(9).setPreferredWidth(60);		// ì¸å…ã‡äz
		tblDetailInfo.getColumnModel().getColumn(10).setPreferredWidth(50);		// çÌèú
	}

	/**
	 * çÌèúÉ{É^ÉìÇéÊìæÇ∑ÇÈ
	 */
	private JButton getDeleteButton()
	{
		JButton		delButton	=	new JButton();
		delButton.setBorderPainted(false);
		delButton.setContentAreaFilled(false);
		delButton.setIcon(new javax.swing.ImageIcon(getClass().getResource(
				"/images/" + SystemInfo.getSkinPackage() + "/button/common/trash_off.jpg")));
		delButton.setPressedIcon(new javax.swing.ImageIcon(getClass().getResource(
				"/images/" + SystemInfo.getSkinPackage() + "/button/common/trash_on.jpg")));
		delButton.setSize(48, 25);
		delButton.addActionListener(new java.awt.event.ActionListener()
		{
			public void actionPerformed(java.awt.event.ActionEvent evt)
			{
				deleteProduct();
			}
		});
		return delButton;
	}

	/**
	 * ñæç◊ÇÇPçsçÌèúÇ∑ÇÈÅB
	 */
	private void deleteProduct()
	{
		DefaultTableModel	model	=	(DefaultTableModel) tblDetailInfo.getModel();
		int					row = tblDetailInfo.getSelectedRow();		// ëIëçs
		int					modelRow = tblDetailInfo.convertRowIndexToModel(row);

		if( tblDetailInfo.getCellEditor() != null ) tblDetailInfo.getCellEditor().stopCellEditing();
		model.removeRow(modelRow);
	}

	/**
	 *
	 */
	private static class TableRecord
	{
		private int selectItemUseDivision;
		private Integer itemId;
		
		public void setSelectItemUseDivision(int itemUseDivision)
		{
			this.selectItemUseDivision = itemUseDivision;
		}
		
		public int getSelectItemUseDivision()
		{
			return this.selectItemUseDivision;
		}
		
		public Integer getItemId()
		{
			return this.itemId;
		}
		
		public void setItemId(Integer itemId)
		{
			this.itemId = itemId;
		}
		
		public boolean equals(Object obj)
		{
			if (obj == null)
			{
				return false;
			}
			
			if (!(obj instanceof TableRecord))
			{
				return false;
			}
			
			TableRecord r = (TableRecord) obj;
			return this.selectItemUseDivision == r.getSelectItemUseDivision() && itemId.equals(r.getItemId());
		}
		
		public String toString()
		{
			switch (selectItemUseDivision)
			{
				case 1:
					return "ìXîÃóp";
				case 2:
					return "ã∆ñ±óp";
				default:
					return "";
			}
		}
	}

	private class RegisterCheckInVoucherPanelFocusTraversalPolicy extends FocusTraversalPolicy
	{
		/**
		 * aComponent ÇÃÇ†Ç∆Ç≈ÉtÉHÅ[ÉJÉXÇéÛÇØéÊÇÈ Component Çï‘ÇµÇ‹Ç∑ÅB
		 * aContainer ÇÕ aComponent ÇÃÉtÉHÅ[ÉJÉXÉTÉCÉNÉãÇÃÉãÅ[ÉgÇ‹ÇΩÇÕÉtÉHÅ[ÉJÉXÉgÉâÉoÅ[ÉTÉãÉ|ÉäÉVÅ[ÉvÉçÉoÉCÉ_Ç≈Ç»ÇØÇÍÇŒÇ»ÇËÇ‹ÇπÇÒÅB
		 * @param aContainer aComponent ÇÃÉtÉHÅ[ÉJÉXÉTÉCÉNÉãÇÃÉãÅ[ÉgÇ‹ÇΩÇÕÉtÉHÅ[ÉJÉXÉgÉâÉoÅ[ÉTÉãÉ|ÉäÉVÅ[ÉvÉçÉoÉCÉ_
		 * @param aComponent aContainer ÇÃÇ®ÇªÇÁÇ≠ä‘ê⁄ìIÇ»éqÅAÇ‹ÇΩÇÕ aContainer é©ëÃ
		 * @return aComponent ÇÃÇ†Ç∆Ç…ÉtÉHÅ[ÉJÉXÇéÛÇØéÊÇÈ ComponentÅBìKêÿÇ» Component Ç™å©Ç¬Ç©ÇÁÇ»Ç¢èÍçáÇÕ null
		 */
		public Component getComponentAfter(Container aContainer, Component aComponent)
		{
			if (aComponent.equals(shop))
			{
				return supplierNo;
			}
			else if (aComponent.equals(supplierNo))
			{
				return supplierName;
			}
			else if (aComponent.equals(supplierName))
			{
				return checkInDate;
			}
			else if (aComponent.equals(checkInDate))
			{
				return personInCd;
			}
			else if (aComponent.equals(personInCd))
			{
				return personInName;
			}
			else if (aComponent.equals(personInName))
			{
				return priceDown;
			}
			else if (aComponent.equals(priceDown))
			{
				return shop;
			}
			
			return shop;
		}
		
		/**
		 * aComponent ÇÃëOÇ…ÉtÉHÅ[ÉJÉXÇéÛÇØéÊÇÈ Component Çï‘ÇµÇ‹Ç∑ÅB
		 * aContainer ÇÕ aComponent ÇÃÉtÉHÅ[ÉJÉXÉTÉCÉNÉãÇÃÉãÅ[ÉgÇ‹ÇΩÇÕÉtÉHÅ[ÉJÉXÉgÉâÉoÅ[ÉTÉãÉ|ÉäÉVÅ[ÉvÉçÉoÉCÉ_Ç≈Ç»ÇØÇÍÇŒÇ»ÇËÇ‹ÇπÇÒÅB
		 * @param aContainer aComponent ÇÃÉtÉHÅ[ÉJÉXÉTÉCÉNÉãÇÃÉãÅ[ÉgÇ‹ÇΩÇÕÉtÉHÅ[ÉJÉXÉgÉâÉoÅ[ÉTÉãÉ|ÉäÉVÅ[ÉvÉçÉoÉCÉ_
		 * @param aComponent aContainer ÇÃÇ®ÇªÇÁÇ≠ä‘ê⁄ìIÇ»éqÅAÇ‹ÇΩÇÕ aContainer é©ëÃ
		 * @return aComponent ÇÃëOÇ…ÉtÉHÅ[ÉJÉXÇéÛÇØéÊÇÈ ComponentÅBìKêÿÇ» Component Ç™å©Ç¬Ç©ÇÁÇ»Ç¢èÍçáÇÕ null
		 */
		public Component getComponentBefore(Container aContainer, Component aComponent)
		{
			if (aComponent.equals(priceDown))
			{
				return personInName;
			}
			else if (aComponent.equals(personInName))
			{
				return personInCd;
			}
			else if (aComponent.equals(personInCd))
			{
				return checkInDate;
			}
			else if (aComponent.equals(checkInDate))
			{
				return supplierName;
			}
			else if (aComponent.equals(supplierName))
			{
				return supplierNo;
			}
			else if (aComponent.equals(supplierNo))
			{
				return shop;
			}
			
			return shop;
		}
		
		/**
		 * ÉgÉâÉoÅ[ÉTÉãÉTÉCÉNÉãÇÃç≈èâÇÃ Component Çï‘ÇµÇ‹Ç∑ÅB
		 * Ç±ÇÃÉÅÉ\ÉbÉhÇÕÅAèáï˚å¸ÇÃÉgÉâÉoÅ[ÉTÉãÇ™ÉâÉbÉvÇ∑ÇÈÇ∆Ç´Ç…ÅAéüÇ…ÉtÉHÅ[ÉJÉXÇ∑ÇÈ Component ÇîªíËÇ∑ÇÈÇΩÇﬂÇ…égópÇµÇ‹Ç∑ÅB
		 * @param aContainer êÊì™ÇÃ Component Çï‘Ç∑ÉtÉHÅ[ÉJÉXÉTÉCÉNÉãÇÃÉãÅ[ÉgÇ‹ÇΩÇÕÉtÉHÅ[ÉJÉXÉgÉâÉoÅ[ÉTÉãÉ|ÉäÉVÅ[ÉvÉçÉoÉCÉ_
		 * @return aContainer ÇÃÉgÉâÉoÅ[ÉTÉãÉTÉCÉNÉãÇÃêÊì™ÇÃ ComponetÅAÇ‹ÇΩÇÕìKêÿÇ» Component Ç™å©Ç¬Ç©ÇÁÇ»Ç¢èÍçáÇÕ null
		 */
		public Component getFirstComponent(Container aContainer)
		{
			return shop;
		}
		
		/**
		 * ÉgÉâÉoÅ[ÉTÉãÉTÉCÉNÉãÇÃç≈å„ÇÃ Component Çï‘ÇµÇ‹Ç∑ÅB
		 * Ç±ÇÃÉÅÉ\ÉbÉhÇÕÅAãtï˚å¸ÇÃÉgÉâÉoÅ[ÉTÉãÇ™ÉâÉbÉvÇ∑ÇÈÇ∆Ç´Ç…ÅAéüÇ…ÉtÉHÅ[ÉJÉXÇ∑ÇÈ Component ÇîªíËÇ∑ÇÈÇΩÇﬂÇ…égópÇµÇ‹Ç∑ÅB
		 * @param aContainer aContainer - ç≈å„ÇÃ Component Çï‘Ç∑ÉtÉHÅ[ÉJÉXÉTÉCÉNÉãÇÃÉãÅ[ÉgÇ‹ÇΩÇÕÉtÉHÅ[ÉJÉXÉgÉâÉoÅ[ÉTÉãÉ|ÉäÉVÅ[ÉvÉçÉoÉCÉ_
		 * @return aContainer ÇÃÉgÉâÉoÅ[ÉTÉãÉTÉCÉNÉãÇÃç≈å„ÇÃ ComponetÅAÇ‹ÇΩÇÕìKêÿÇ» Component Ç™å©Ç¬Ç©ÇÁÇ»Ç¢èÍçáÇÕ null
		 */
		public Component getLastComponent(Container aContainer)
		{
			return priceDown;
		}
		
		/**
		 * ÉtÉHÅ[ÉJÉXÇê›íËÇ∑ÇÈÉfÉtÉHÉãÉgÉRÉìÉ|Å[ÉlÉìÉgÇï‘ÇµÇ‹Ç∑ÅB
		 * aContainer ÇÉãÅ[ÉgÇ∆Ç∑ÇÈÉtÉHÅ[ÉJÉXÉgÉâÉoÅ[ÉTÉãÉTÉCÉNÉãÇ™êVÇµÇ≠äJénÇ≥ÇÍÇΩÇ∆Ç´Ç…ÅAÇ±ÇÃÉRÉìÉ|Å[ÉlÉìÉgÇ…ç≈èâÇ…ÉtÉHÅ[ÉJÉXÇ™ê›íËÇ≥ÇÍÇ‹Ç∑ÅB
		 * @param aContainer ÉfÉtÉHÉãÉgÇÃ Component Çï‘Ç∑ÉtÉHÅ[ÉJÉXÉTÉCÉNÉãÇÃÉãÅ[ÉgÇ‹ÇΩÇÕÉtÉHÅ[ÉJÉXÉgÉâÉoÅ[ÉTÉãÉ|ÉäÉVÅ[ÉvÉçÉoÉCÉ_
		 * @return aContainer ÇÃÉgÉâÉoÅ[ÉTÉãÉTÉCÉNÉãÇÃÉfÉtÉHÉãÉgÇÃ ComponetÅAÇ‹ÇΩÇÕìKêÿÇ» Component Ç™å©Ç¬Ç©ÇÁÇ»Ç¢èÍçáÇÕ null
		 */
		public Component getDefaultComponent(Container aContainer)
		{
			return shop;
		}
		
		/**
		 * ÉEÉBÉìÉhÉEÇ™ç≈èâÇ…ï\é¶Ç≥ÇÍÇΩÇ∆Ç´Ç…ÉtÉHÅ[ÉJÉXÇ™ê›íËÇ≥ÇÍÇÈÉRÉìÉ|Å[ÉlÉìÉgÇï‘ÇµÇ‹Ç∑ÅB
		 * show() Ç‹ÇΩÇÕ setVisible(true) ÇÃåƒÇ—èoÇµÇ≈àÍìxÉEÉBÉìÉhÉEÇ™ï\é¶Ç≥ÇÍÇÈÇ∆ÅA
		 * èâä˙âªÉRÉìÉ|Å[ÉlÉìÉgÇÕÇªÇÍà»ç~égópÇ≥ÇÍÇ‹ÇπÇÒÅB
		 * àÍìxï ÇÃÉEÉBÉìÉhÉEÇ…à⁄Ç¡ÇΩÉtÉHÅ[ÉJÉXÇ™çƒÇ—ê›íËÇ≥ÇÍÇΩèÍçáÅA
		 * Ç‹ÇΩÇÕÅAàÍìxîÒï\é¶èÛë‘Ç…Ç»Ç¡ÇΩÉEÉBÉìÉhÉEÇ™çƒÇ—ï\é¶Ç≥ÇÍÇΩèÍçáÇÕÅA
		 * ÇªÇÃÉEÉBÉìÉhÉEÇÃç≈å„Ç…ÉtÉHÅ[ÉJÉXÇ™ê›íËÇ≥ÇÍÇΩÉRÉìÉ|Å[ÉlÉìÉgÇ™ÉtÉHÅ[ÉJÉXèäóLé“Ç…Ç»ÇËÇ‹Ç∑ÅB
		 * Ç±ÇÃÉÅÉ\ÉbÉhÇÃÉfÉtÉHÉãÉgé¿ëïÇ≈ÇÕÉfÉtÉHÉãÉgÉRÉìÉ|Å[ÉlÉìÉgÇï‘ÇµÇ‹Ç∑ÅB
		 * @param window èâä˙ÉRÉìÉ|Å[ÉlÉìÉgÇ™ï‘Ç≥ÇÍÇÈÉEÉBÉìÉhÉE
		 * @return ç≈èâÇ…ÉEÉBÉìÉhÉEÇ™ï\é¶Ç≥ÇÍÇÈÇ∆Ç´Ç…ÉtÉHÅ[ÉJÉXê›íËÇ≥ÇÍÇÈÉRÉìÉ|Å[ÉlÉìÉgÅBìKêÿÇ»ÉRÉìÉ|Å[ÉlÉìÉgÇ™Ç»Ç¢èÍçáÇÕ null
		 */
		public Component getInitialComponent(Window window)
		{
			return shop;
		}
	}
        //IVS_LVTu start add 2015/09/30 Bug #43033
        private Long getTaxOffPrice(Integer price, double taxRate)
	{
		Long	taxOffValue		=	0l;
		Double temptaxOffValue ;
		
                temptaxOffValue	=	(price / (1 + taxRate));
                BigDecimal a = new BigDecimal(temptaxOffValue);
                a = a.setScale(3, RoundingMode.HALF_UP);
                taxOffValue = ((Double)Math.ceil(a.doubleValue())).longValue();
            
            return taxOffValue;
	}
        //IVS_LVTu end add 2015/09/30 Bug #43033
}



